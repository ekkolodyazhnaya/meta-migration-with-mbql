{
  "description": "Sum and Number of Transactions in OOR by group. \nWidget transactions only.",
  "archived": false,
  "view_count": 1,
  "collection_position": null,
  "dashcards": [
    {
      "size_x": 19,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2893,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "6Doi59vqsWdmbG9-ViBm2",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "By default the granularity is day, only transactions for the last 30 days are included. Data can be group by any parameter by top N (changable)\n"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 0
    },
    {
      "size_x": 12,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.833333333333334
                }
              }
            }
          },
          {
            "display_name": "TR",
            "field_ref": [
              "field",
              "TR",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "TR",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 29922.0,
                  "q1": 36771.0,
                  "q3": 95545.0,
                  "max": 102578.0,
                  "sd": 32172.02269519279,
                  "avg": 67455.5
                }
              }
            }
          },
          {
            "display_name": "PERCENT_TR",
            "field_ref": [
              "field",
              "PERCENT_TR",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "PERCENT_TR",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.0739302206639933,
                  "q1": 0.09085248793649146,
                  "q3": 0.236069211060131,
                  "max": 0.25344609903318976,
                  "sd": 0.0794894972616337,
                  "avg": 0.16666666666666666
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Top N Number of Transaction table - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "f13fa6f9-6c9c-2576-9a31-3284846a549f",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "a0826f3a-4548-48a4-b3df-737ca126eb03",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "950c0886-a7a7-6bb5-b951-6b4de1a8a22a",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "b8ff8c23-2162-138e-569e-c1dc2bdf11f0",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "09c5e2e8-d9c6-499f-860d-560daf9da0f9",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "25ce6c9c-9f69-8325-a601-3edd2a036e1e",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "432c648f-b216-47f6-ae3e-9e2b8d0a8b79",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "c9e442da-a656-d46e-6782-a3342e7e7b41",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "603d740b-fd2a-48e0-68a3-daa0ee9650d0",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "4f5f35a9-cb2c-4824-2011-97ac84f90344",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "7a27ad85-1eeb-46c0-48cb-f20376446bd6",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "a0afabd3-8ac2-3fec-15f6-ae14cba8e2b0",
                "name": "partner_name",
                "display-name": "Partner Widget",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "6dd9bd16-f5a5-4686-9250-16e1ef49a986",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "ae7b59cb-5d27-c65b-34f0-0634485ae20d",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "3b407c4d-8425-414b-8e37-df962a2d6230",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "9b2abb34-d33f-7c43-0ba4-92f1ad91ce92",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "a88eea71-3a68-4680-9df0-c78d996d2459",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "d4783ca5-2065-5f37-4760-e387f0be3c21",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "877d8ef9-e858-4a8a-bf3c-7565fe30d095",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "transaction_accepted": {
                "id": "e20eefe4-d528-d568-7196-7ecf253ada5d",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "type_operation": {
                "id": "908cf84f-1a5d-e413-cd33-57487f91d52c",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "antifraud_status": {
                "id": "21da1dfb-cfdf-4f59-77e7-7515cc757f6a",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "a5f1a3fc-363f-f3b1-cc22-a02d61e3777b",
                "name": "LOCATION_COUNTRY",
                "display-name": "\u0421ountry IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  875,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "608fd238-7748-472d-b548-5194ae295028",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}} \r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn <= {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.WIDGET_PARTNER_NAME\r\n                      , TRANSACTIONS.TYPE as type_operation\r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect top_n_parameter\r\n     , count(distinct id) as tr\r\n     , count(distinct id)/avg(tr_all) as percent_tr\r\n     \r\nfrom main_query\r\ninner join (select count(distinct id) as tr_all from main_query) as all_tr on 1=1\r\ngroup by 1\r\norder by 2 desc"
          }
        },
        "id": 3770,
        "parameter_mappings": [],
        "display": "table",
        "archived_directly": false,
        "entity_id": "h_XEPKwHTwpeT4pabhEPK",
        "collection_preview": true,
        "visualization_settings": {
          "table.column_formatting": [
            {
              "columns": [
                "TR"
              ],
              "type": "single",
              "operator": "=",
              "value": "",
              "color": "#509EE3",
              "highlight_row": false
            }
          ],
          "table.pivot_column": "TOP_N_PARAMETER",
          "table.cell_column": "TR",
          "series_settings": {
            "TR": {
              "axis": "left"
            }
          },
          "graph.dimensions": [
            "TOP_N_PARAMETER"
          ],
          "column_settings": {
            "[\"name\",\"TR\"]": {
              "number_style": "decimal",
              "show_mini_bar": true
            },
            "[\"name\",\"PERCENT_TR\"]": {
              "number_style": "percent"
            }
          },
          "graph.metrics": [
            "TR"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f13fa6f9-6c9c-2576-9a31-3284846a549f",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "a0826f3a-4548-48a4-b3df-737ca126eb03",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "950c0886-a7a7-6bb5-b951-6b4de1a8a22a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "b8ff8c23-2162-138e-569e-c1dc2bdf11f0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "09c5e2e8-d9c6-499f-860d-560daf9da0f9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "25ce6c9c-9f69-8325-a601-3edd2a036e1e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "432c648f-b216-47f6-ae3e-9e2b8d0a8b79",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "c9e442da-a656-d46e-6782-a3342e7e7b41",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "603d740b-fd2a-48e0-68a3-daa0ee9650d0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "4f5f35a9-cb2c-4824-2011-97ac84f90344",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "7a27ad85-1eeb-46c0-48cb-f20376446bd6",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "a0afabd3-8ac2-3fec-15f6-ae14cba8e2b0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Widget",
            "slug": "partner_name"
          },
          {
            "id": "6dd9bd16-f5a5-4686-9250-16e1ef49a986",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "ae7b59cb-5d27-c65b-34f0-0634485ae20d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "3b407c4d-8425-414b-8e37-df962a2d6230",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "9b2abb34-d33f-7c43-0ba4-92f1ad91ce92",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "a88eea71-3a68-4680-9df0-c78d996d2459",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "d4783ca5-2065-5f37-4760-e387f0be3c21",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "877d8ef9-e858-4a8a-bf3c-7565fe30d095",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "e20eefe4-d528-d568-7196-7ecf253ada5d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "required": false
          },
          {
            "id": "908cf84f-1a5d-e413-cd33-57487f91d52c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "21da1dfb-cfdf-4f59-77e7-7515cc757f6a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "a5f1a3fc-363f-f3b1-cc22-a02d61e3777b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "\u0421ountry IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "608fd238-7748-472d-b548-5194ae295028",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2894,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3770,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3770,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3770,
      "entity_id": "gOekGa2jKMBN47iBbKjaC",
      "visualization_settings": {},
      "size_y": 5,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 32
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2895,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "Kd__yEUyxnvReLB1K7qVi",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "Number of Accepted Transaction",
        "text.align_vertical": "middle",
        "text.align_horizontal": "center"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 19
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2896,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "hghs_4qaSFA7mtJg0YIcI",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "Turnover",
        "text.align_vertical": "middle",
        "text.align_horizontal": "center"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 1
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "TURNOVER",
            "field_ref": [
              "field",
              "TURNOVER",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "TURNOVER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 82013.48382460054,
                  "q1": 201720.95436463857,
                  "q3": 694485.5332256899,
                  "max": 1033471.2049529814,
                  "sd": 273962.4244721422,
                  "avg": 419443.4005483792
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Turnover - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "d4f8187d-705d-dc50-f477-bb90ec489c08",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "bea3cadd-fa86-4341-bc1a-2ce6b75e51d9",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "62958889-857c-d3b2-d889-207a0a2b33c6",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "3dedb151-884c-f8c1-9281-6cd2664e9063",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "ef0daa69-9304-42f2-83ea-002ae9d740ba",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "db88ac4c-3d66-178a-6c0d-c9cda5afdf4d",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "c76c81c6-f974-4479-8e8c-bde871fb7737",
                "display-name": "Is Aft",
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_GEO": {
                "id": "4daebdf9-1050-9bad-f98d-e95cbc3d93b1",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "4e701c08-5e45-d37d-695f-e5dabf097805",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "2239253e-bcd2-4616-9e6c-ada887a3edd6",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "ca0a7260-ea6c-641b-2f9b-ceae59fd194a",
                "name": "top_n",
                "display-name": "Top N",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "f06dbc00-3f6f-c445-95ef-27779246c502",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "d7979d8b-ee55-b24c-fc25-fcbcdc2bad43",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "92e16fc3-a07e-870b-62c0-e9e5f636e691",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "94ae1d78-40ad-4f69-8212-65d51b5e58b6",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "46c05421-cc30-e51f-a032-b589a6cad70d",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "f8b0f687-2164-47a1-8bb5-a2fffe1da899",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "12ea305a-7a27-0bec-2a1e-e40ddb05662f",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "a7aaf14b-3b59-43c9-a804-734e9efc127f",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "a58cbf6b-e1e4-8c7b-a0fb-14c458b06af1",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "ef547088-3139-4fd1-912f-d28dbde6dbc3",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  true
                ],
                "required": true
              },
              "type_operation": {
                "id": "6f53207d-b8f0-7c6e-7e7f-ef5fa615f445",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "LOCATION_COUNTRY": {
                "id": "23dad7cc-474f-9348-36a9-21b856900f50",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "96a218b1-3966-4a54-86c7-9b5ba7a99586",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FIAT_AMOUNT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} \r\n        and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} \r\n        and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_topN\r\n     , sum(TURNOVER_EUR) as Turnover\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1,3 desc"
          }
        },
        "id": 3784,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "uIwas2UZxPbi-iC3Oj8Up",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "EUR",
          "graph.show_values": true,
          "graph.x_axis.title_text": "DT",
          "graph.label_value_frequency": "all",
          "graph.metrics": [
            "TURNOVER"
          ],
          "graph.label_value_formatting": "auto",
          "column_settings": {
            "[\"name\",\"TURNOVER\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "stackable.stack_type": "normalized"
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "d4f8187d-705d-dc50-f477-bb90ec489c08",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "bea3cadd-fa86-4341-bc1a-2ce6b75e51d9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "62958889-857c-d3b2-d889-207a0a2b33c6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "3dedb151-884c-f8c1-9281-6cd2664e9063",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "ef0daa69-9304-42f2-83ea-002ae9d740ba",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "db88ac4c-3d66-178a-6c0d-c9cda5afdf4d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "c76c81c6-f974-4479-8e8c-bde871fb7737",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "4daebdf9-1050-9bad-f98d-e95cbc3d93b1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "4e701c08-5e45-d37d-695f-e5dabf097805",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "2239253e-bcd2-4616-9e6c-ada887a3edd6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "ca0a7260-ea6c-641b-2f9b-ceae59fd194a",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "f06dbc00-3f6f-c445-95ef-27779246c502",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "d7979d8b-ee55-b24c-fc25-fcbcdc2bad43",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "92e16fc3-a07e-870b-62c0-e9e5f636e691",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "94ae1d78-40ad-4f69-8212-65d51b5e58b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "46c05421-cc30-e51f-a032-b589a6cad70d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "f8b0f687-2164-47a1-8bb5-a2fffe1da899",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "12ea305a-7a27-0bec-2a1e-e40ddb05662f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "a7aaf14b-3b59-43c9-a804-734e9efc127f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "a58cbf6b-e1e4-8c7b-a0fb-14c458b06af1",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "ef547088-3139-4fd1-912f-d28dbde6dbc3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "default": [
              true
            ],
            "required": true
          },
          {
            "id": "6f53207d-b8f0-7c6e-7e7f-ef5fa615f445",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "23dad7cc-474f-9348-36a9-21b856900f50",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "96a218b1-3966-4a54-86c7-9b5ba7a99586",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2897,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3784,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3784,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3784,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3784,
      "entity_id": "AXpWRhpOaGpqPbE60TKlW",
      "visualization_settings": {
        "graph.y_axis.title_text": "EUR",
        "graph.show_values": true,
        "graph.x_axis.title_text": "DT",
        "graph.y_axis.labels_enabled": true,
        "card.title": "Turnover, absolute value",
        "graph.label_value_frequency": "all",
        "graph.metrics": [
          "TURNOVER"
        ],
        "graph.y_axis.axis_enabled": false,
        "graph.label_value_formatting": "auto",
        "graph.y_axis.auto_range": true,
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "stackable.stack_type": "stacked"
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 2
    },
    {
      "size_x": 13,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.0
                }
              }
            }
          },
          {
            "display_name": "SUM_TRANSACTIONS",
            "field_ref": [
              "field",
              "SUM_TRANSACTIONS",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "SUM_TRANSACTIONS",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 3433897.0,
                  "q1": 4630810.0,
                  "q3": 18886137.0,
                  "max": 21634773.0,
                  "sd": 7769251.564508989,
                  "avg": 10464397.833333334
                }
              }
            }
          },
          {
            "display_name": "PERCENT",
            "field_ref": [
              "field",
              "PERCENT",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "PERCENT",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.054691740478124244,
                  "q1": 0.07375500080029755,
                  "q3": 0.3007998751418506,
                  "max": 0.3445774484066751,
                  "sd": 0.12374102219170093,
                  "avg": 0.16666666666666666
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Top N Turnover - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "acc901dc-fde5-c8f1-84ec-dc0da44e4f4c",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "98bd5b8e-1361-47eb-b0c1-59ad6dd6d374",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "9faa765c-ef8c-1536-fcf0-b923dff4faf3",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "de68779a-fa8e-0dd8-d1f5-a9c1e8862309",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "a63517c3-61f1-4a40-b22f-3aa1716e15ca",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "b9f3870f-43dd-dfd8-f168-7ba94966543d",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "61b89845-83e1-49b3-9638-ce984f47d03c",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "25f9a5f2-4c72-aa20-8e11-b9cccf40d5e5",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "3c3b892b-93e5-1cbe-490c-fcdb83dd43b0",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "3997b3a0-c340-1da5-c6c0-56ecf2981195",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Group by parameter",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "dee96f44-ac37-bc86-dadf-13f385309bbb",
                "name": "top_n",
                "display-name": "Top N",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "43154b45-a62e-7c49-b8e4-430c02484169",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "8842585a-27fd-ec2c-64dc-867ea263f8b5",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "f9343425-0816-d9f9-fe7c-b4cf67447cd4",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "c1e5275f-ab84-4f54-a08f-8896659b90f2",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "6260f2b5-eb08-085f-5242-d3b4134442a5",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "4bf468e4-d6dc-4727-8e78-3914104af631",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "bd09ace9-d499-202b-6118-7a38feff2061",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "5d1e7fdd-6466-48f5-8e94-e25430849970",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "transaction_accepted": {
                "id": "39aa40b0-9a14-b88d-39f5-6034f1794437",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  true
                ],
                "required": true
              },
              "type_operation": {
                "id": "f3e99d41-407f-acf8-8acc-caa128e150c3",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "f1e88499-f657-187d-09bb-0827a825119e",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "4572038b-e394-4911-a746-dd9545aef2b9",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name    \r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n        \r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FIAT_AMOUNT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn <= {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.FIAT_AMOUNT_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name    \r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      ) \r\nselect top_n_parameter\r\n     , round(sum(FIAT_AMOUNT_EUR)) as sum_transactions\r\n     , sum(FIAT_AMOUNT_EUR)/avg(sum_all_transaction) as percent\r\nfrom main_query\r\ninner join (select sum(FIAT_AMOUNT_EUR) as sum_all_transaction from main_query) as all_tr on 1=1\r\ngroup by 1\r\norder by 2 desc"
          }
        },
        "id": 3797,
        "parameter_mappings": [],
        "display": "table",
        "archived_directly": false,
        "entity_id": "9BDVykAZIEhf651E5WbDO",
        "collection_preview": true,
        "visualization_settings": {
          "table.pivot_column": "TOP_N_PARAMETER",
          "table.cell_column": "SUM_TRANSACTIONS",
          "column_settings": {
            "[\"name\",\"PERCENT\"]": {
              "number_style": "percent",
              "column_title": "Share of Turnover, %"
            },
            "[\"name\",\"SUM_TRANSACTIONS\"]": {
              "number_style": "currency",
              "show_mini_bar": true,
              "column_title": "Turnover"
            },
            "[\"name\",\"TOP_N_PARAMETER\"]": {
              "column_title": "Chosen Parameter"
            }
          }
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "acc901dc-fde5-c8f1-84ec-dc0da44e4f4c",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "98bd5b8e-1361-47eb-b0c1-59ad6dd6d374",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "9faa765c-ef8c-1536-fcf0-b923dff4faf3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "de68779a-fa8e-0dd8-d1f5-a9c1e8862309",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "a63517c3-61f1-4a40-b22f-3aa1716e15ca",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "b9f3870f-43dd-dfd8-f168-7ba94966543d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "61b89845-83e1-49b3-9638-ce984f47d03c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "25f9a5f2-4c72-aa20-8e11-b9cccf40d5e5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3c3b892b-93e5-1cbe-490c-fcdb83dd43b0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "3997b3a0-c340-1da5-c6c0-56ecf2981195",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Group by parameter",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "dee96f44-ac37-bc86-dadf-13f385309bbb",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "43154b45-a62e-7c49-b8e4-430c02484169",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "8842585a-27fd-ec2c-64dc-867ea263f8b5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "f9343425-0816-d9f9-fe7c-b4cf67447cd4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "c1e5275f-ab84-4f54-a08f-8896659b90f2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "6260f2b5-eb08-085f-5242-d3b4134442a5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "4bf468e4-d6dc-4727-8e78-3914104af631",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "bd09ace9-d499-202b-6118-7a38feff2061",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "5d1e7fdd-6466-48f5-8e94-e25430849970",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "39aa40b0-9a14-b88d-39f5-6034f1794437",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "default": [
              true
            ],
            "required": true
          },
          {
            "id": "f3e99d41-407f-acf8-8acc-caa128e150c3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "f1e88499-f657-187d-09bb-0827a825119e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "4572038b-e394-4911-a746-dd9545aef2b9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2898,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3797,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3797,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3797,
      "entity_id": "o9DY40t4hZf3_B3k18GpU",
      "visualization_settings": {
        "table.pivot_column": "TOP_N_PARAMETER",
        "table.cell_column": "SUM_TRANSACTIONS",
        "card.title": "Top N Turnover EUR",
        "column_settings": {
          "[\"name\",\"PERCENT\"]": {
            "number_style": "percent",
            "column_title": "Share of Turnover, %"
          },
          "[\"name\",\"SUM_TRANSACTIONS\"]": {
            "number_style": "currency",
            "show_mini_bar": true,
            "column_title": "Turnover"
          },
          "[\"name\",\"TOP_N_PARAMETER\"]": {
            "column_title": "Chosen Parameter"
          }
        }
      },
      "size_y": 5,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 14
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2899,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "bxa2ZuD2WmjLySbalLzM6",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "Acceptance rate",
        "text.align_vertical": "middle",
        "text.align_horizontal": "center"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 37
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "TR",
            "field_ref": [
              "field",
              "TR",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "TR",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.3048128342245989,
                  "q1": 0.5597217177496273,
                  "q3": 0.6392249151901266,
                  "max": 0.9066344993968637,
                  "sd": 0.11189271744350299,
                  "avg": 0.6296700290829784
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Acceptance Rate - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "4eb2c5f1-b806-07fb-3aec-f9101ec37a67",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "d87f4a74-62a7-4e66-ba59-adb9cac50904",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "d5af87aa-d6e6-f90d-11c8-1937a9dab3f5",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "0b8acc04-6265-3fdc-7961-7925344c5e7d",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "29bbf02b-3ca9-4e78-9335-4ae675cfd121",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "d55b734d-c44c-6db7-de41-4e4371bf161b",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "76f85301-fa11-4e9b-be04-21b34f3b0810",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "168894f1-361a-7cae-7fe6-968702ce79e8",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "0e651d69-c0c3-330a-befb-4bfdb433d6ac",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "418df98d-5846-1163-4f76-168c4605161d",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Parameter groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "c3adc608-9013-34ae-30df-636b6e35d019",
                "name": "top_n",
                "display-name": "Top N",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "4e10c765-b9cb-0d26-839d-6938157df04d",
                "name": "partner_name",
                "display-name": "Partner Widget",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "2bacdd61-9975-6952-4906-e477ea61f89c",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "ddfff366-d62f-e41e-f919-61415d7faa3b",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "a80a96a3-0a42-4fa7-b762-1933c5d7421a",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "bc922bcd-1acb-908f-d450-b81f0f0c4be3",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "5d43bff6-587c-4309-a2f0-8ad79460bf79",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "none",
                "options": null
              },
              "pay_system": {
                "id": "de57843d-1619-c343-30c4-1aa613cf5187",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "5123e8cd-62dd-4b00-a675-5db7a402f20c",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "769d01d7-4afc-1e3f-8cb8-bfb7729eb325",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "id": "85503309-a79d-9b5c-cf10-88ed79576487",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "antifraud_status": {
                "id": "b94beb93-1a82-981f-ff33-02792ed04767",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "933a91e7-2ff3-510e-b396-bf8302999d47",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "066a02a5-bfad-45b3-a749-f8c5d06d69a5",
                "display-name": "Retry Exclude",
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/="
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and\r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS\r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , count(distinct case when is_confirmed then id end)/count(distinct id) as tr\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3799,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "oiHy12xawq09cou0dVmNp",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "Acceptance Rate",
          "graph.show_values": true,
          "table.cell_column": "TR",
          "graph.x_axis.title_text": "Transaction Date",
          "graph.metrics": [
            "TR"
          ],
          "graph.label_value_formatting": "compact",
          "table.pivot_column": "TOP_N_PARAMETER",
          "column_settings": {
            "[\"name\",\"TR\"]": {
              "number_style": "percent"
            }
          },
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "4eb2c5f1-b806-07fb-3aec-f9101ec37a67",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days"
          },
          {
            "id": "d87f4a74-62a7-4e66-ba59-adb9cac50904",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "d5af87aa-d6e6-f90d-11c8-1937a9dab3f5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "0b8acc04-6265-3fdc-7961-7925344c5e7d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "29bbf02b-3ca9-4e78-9335-4ae675cfd121",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "d55b734d-c44c-6db7-de41-4e4371bf161b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "76f85301-fa11-4e9b-be04-21b34f3b0810",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "168894f1-361a-7cae-7fe6-968702ce79e8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "0e651d69-c0c3-330a-befb-4bfdb433d6ac",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "418df98d-5846-1163-4f76-168c4605161d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Parameter groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "c3adc608-9013-34ae-30df-636b6e35d019",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "4e10c765-b9cb-0d26-839d-6938157df04d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Widget",
            "slug": "partner_name"
          },
          {
            "id": "2bacdd61-9975-6952-4906-e477ea61f89c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "ddfff366-d62f-e41e-f919-61415d7faa3b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "a80a96a3-0a42-4fa7-b762-1933c5d7421a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "bc922bcd-1acb-908f-d450-b81f0f0c4be3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "de57843d-1619-c343-30c4-1aa613cf5187",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "5123e8cd-62dd-4b00-a675-5db7a402f20c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "769d01d7-4afc-1e3f-8cb8-bfb7729eb325",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "85503309-a79d-9b5c-cf10-88ed79576487",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "b94beb93-1a82-981f-ff33-02792ed04767",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "933a91e7-2ff3-510e-b396-bf8302999d47",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "066a02a5-bfad-45b3-a749-f8c5d06d69a5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2900,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3799,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3799,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3799,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3799,
      "entity_id": "fqJFrQqj6H-9cQdaFJrQp",
      "visualization_settings": {
        "graph.y_axis.title_text": "Acceptance Rate",
        "graph.show_values": true,
        "table.cell_column": "TR",
        "graph.x_axis.title_text": "Transaction Date",
        "graph.y_axis.scale": "linear",
        "graph.label_value_frequency": "fit",
        "graph.metrics": [
          "TR"
        ],
        "graph.y_axis.axis_enabled": false,
        "graph.label_value_formatting": "compact",
        "table.pivot_column": "TOP_N_PARAMETER",
        "column_settings": {
          "[\"name\",\"TR\"]": {
            "number_style": "percent"
          }
        },
        "series_settings": {
          "others": {
            "line.interpolate": "linear",
            "line.marker_enabled": true,
            "line.missing": "none"
          },
          "onramper": {
            "line.marker_enabled": true
          },
          "MercuryoWidget": {
            "line.marker_enabled": true
          },
          "TrustWallet": {
            "line.marker_enabled": true
          },
          "Huobi": {
            "line.marker_enabled": true
          }
        },
        "graph.dimensions": [
          "CREATED_AT",
          "TOP_N_PARAMETER"
        ]
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 38
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2901,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "TZsVunmrop-bFUCAy-7Lw",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "GMV",
        "text.align_horizontal": "center",
        "text.align_vertical": "middle"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 49
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.0
                }
              }
            }
          },
          {
            "display_name": "GMV",
            "field_ref": [
              "field",
              "GMV",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "GMV",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 1322.870922009554,
                  "q1": 3670.6750466763556,
                  "q3": 10742.177114150138,
                  "max": 27315.288200736173,
                  "sd": 5000.753483873731,
                  "avg": 7958.308893709536
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "GMV  - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "8438e99c-30c3-5207-9115-6125fd393d5f",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": null
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "37466e68-fec3-4fb5-9dac-4e740c0da321",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "2149f349-47b8-b24d-b97c-590b092186de",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "42d083b6-705e-cb1b-7418-e5a06196e0b1",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "face58b8-0d6f-4295-9edb-a6b1d8b90dce",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "c26826ca-704a-4cb0-6760-47c47f95085f",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "a66ece70-6746-4f74-87c8-0e47e047c1b1",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "f42f36bb-b55c-e0df-14f1-1a2b085a20b6",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "e1d99e23-67b6-b9fd-f30e-957e76edd920",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "d76a676c-e0a2-99c4-1d0e-478633994a4b",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "76660208-77b4-452a-9949-0c615e7f0fca",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "03bee95d-7321-8a2c-9e72-faaffea4dba1",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "7a6da7f5-481a-259a-2dd5-b3b88ae2f0d0",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "fd41bbf5-c5e8-facb-518b-3b60e4012543",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "99e37c2c-8060-41a5-ad28-d7902afe72bb",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "8830b5ec-f7de-74b2-4b40-6127b0777590",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "57bb9df5-1cb4-4b33-bcdc-378262d2dd2b",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "abd458f8-2890-8725-5d99-9a88adf68a0c",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "41f33725-0f5a-4e32-96fa-d0596e3e3da3",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "9fd1bea2-2265-a192-dad9-0c538541f98d",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "default": "day",
                "required": true
              },
              "transaction_accepted": {
                "id": "54ff4bfb-adb0-2916-fdfc-d37497ddef9b",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "type_operation": {
                "id": "1f4fd6a6-75ee-bdec-8384-42446f349fcd",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "a2caf222-79e7-b4ec-d25e-a40ffa304e9a",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "e8438495-dcb3-4eac-965b-aea2947dca69",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.gmv_eur) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.gmv_eur\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and  {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(gmv_eur) as GMV\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3794,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "zcwkKS10HVDp-x-pkm_Z3",
        "collection_preview": true,
        "visualization_settings": {
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.label_value_frequency": "all",
          "graph.y_axis.title_text": "EUR",
          "graph.y_axis.auto_range": true,
          "graph.metrics": [
            "GMV"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "8438e99c-30c3-5207-9115-6125fd393d5f",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT"
          },
          {
            "id": "37466e68-fec3-4fb5-9dac-4e740c0da321",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "2149f349-47b8-b24d-b97c-590b092186de",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "42d083b6-705e-cb1b-7418-e5a06196e0b1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "face58b8-0d6f-4295-9edb-a6b1d8b90dce",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "c26826ca-704a-4cb0-6760-47c47f95085f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "a66ece70-6746-4f74-87c8-0e47e047c1b1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "f42f36bb-b55c-e0df-14f1-1a2b085a20b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "e1d99e23-67b6-b9fd-f30e-957e76edd920",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "d76a676c-e0a2-99c4-1d0e-478633994a4b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "76660208-77b4-452a-9949-0c615e7f0fca",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "03bee95d-7321-8a2c-9e72-faaffea4dba1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "7a6da7f5-481a-259a-2dd5-b3b88ae2f0d0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "fd41bbf5-c5e8-facb-518b-3b60e4012543",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "99e37c2c-8060-41a5-ad28-d7902afe72bb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "8830b5ec-f7de-74b2-4b40-6127b0777590",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "57bb9df5-1cb4-4b33-bcdc-378262d2dd2b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "abd458f8-2890-8725-5d99-9a88adf68a0c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "41f33725-0f5a-4e32-96fa-d0596e3e3da3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "9fd1bea2-2265-a192-dad9-0c538541f98d",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "54ff4bfb-adb0-2916-fdfc-d37497ddef9b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "1f4fd6a6-75ee-bdec-8384-42446f349fcd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "a2caf222-79e7-b4ec-d25e-a40ffa304e9a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "e8438495-dcb3-4eac-965b-aea2947dca69",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2902,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3794,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3794,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3794,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3794,
      "entity_id": "8oiCxisBN_4nZp53S1oHB",
      "visualization_settings": {
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "stackable.stack_type": "stacked",
        "graph.show_values": true,
        "graph.label_value_frequency": "all",
        "graph.y_axis.title_text": "EUR",
        "graph.y_axis.auto_range": true,
        "graph.y_axis.axis_enabled": false,
        "graph.metrics": [
          "GMV"
        ]
      },
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 50
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 11.333333333333334
                }
              }
            }
          },
          {
            "display_name": "GMV",
            "field_ref": [
              "field",
              "GMV",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "GMV",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 180,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 88.4413587157,
                  "q1": 3310.7455392656307,
                  "q3": 9424.420774156835,
                  "max": 25882.177416580187,
                  "sd": 4361.13825346002,
                  "avg": 6631.924078091283
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "GMV,  percent - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "41215a11-b6e0-c7aa-a8f0-4755bbbb0e11",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "849e8a07-54e2-4fc7-81e7-86915b94d008",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "0718139c-330e-f3be-cc9a-1d1f60ac3092",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "145f8614-a95c-3c5e-d2e4-c448cbc33cb2",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "2290f2fa-e93e-4219-9aea-29f8898d7b78",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "12d478d3-e42b-3a6e-1d3e-c251d752f431",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "96731be0-bc39-4f0e-89ca-b8a758dbf730",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "b79fa546-669f-cc44-3285-9a273c2f6477",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "4778cc0c-abc1-7be4-472a-04c2b6e1b808",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "0a5569ab-71d0-f9c1-c51c-8480de26170a",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "dc2f4bd0-0114-29b9-15f8-019963f32a20",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "2b08e63a-f487-82c8-bfb2-3ebfd6f87c26",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "b6f8c1a4-5b7c-bea7-57f0-2b7090ed0045",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "0186d234-50c6-bd9f-a8c2-2acce595c953",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "a3399c1d-da23-435e-a102-09e1d6cc51c8",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "867d67b9-c46a-9e43-0765-f3742cad70a0",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "1fbde92f-5150-4229-a025-f15667bd7286",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "b0129423-a52c-0d28-c33a-1d4037278fbb",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "785a8a5d-080d-455a-b464-03e236784b9e",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "c9505a5b-4e8c-09d9-8fd1-b97fc65fc24c",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "89d801a9-5090-96a7-3108-5cd7739bcdb0",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "type_operation": {
                "id": "21291e51-2042-6366-b830-95ba88c8a4db",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "28ba9276-2b21-939f-8c1c-2e1eddb99ad7",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "1bc072b3-c20b-4afc-ada9-0ae6047c0297",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.GMV_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and  {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn <= {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.GMV_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(GMV_EUR) as GMV\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3795,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "V9G4WvnluwVe0eyZy2FTb",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "normalized",
          "graph.show_goal": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.y_axis.title_text": "GMV",
          "graph.metrics": [
            "GMV"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "41215a11-b6e0-c7aa-a8f0-4755bbbb0e11",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "849e8a07-54e2-4fc7-81e7-86915b94d008",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "0718139c-330e-f3be-cc9a-1d1f60ac3092",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "145f8614-a95c-3c5e-d2e4-c448cbc33cb2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "2290f2fa-e93e-4219-9aea-29f8898d7b78",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "12d478d3-e42b-3a6e-1d3e-c251d752f431",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "96731be0-bc39-4f0e-89ca-b8a758dbf730",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "b79fa546-669f-cc44-3285-9a273c2f6477",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "4778cc0c-abc1-7be4-472a-04c2b6e1b808",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "0a5569ab-71d0-f9c1-c51c-8480de26170a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "dc2f4bd0-0114-29b9-15f8-019963f32a20",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "2b08e63a-f487-82c8-bfb2-3ebfd6f87c26",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "b6f8c1a4-5b7c-bea7-57f0-2b7090ed0045",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "0186d234-50c6-bd9f-a8c2-2acce595c953",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "a3399c1d-da23-435e-a102-09e1d6cc51c8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "867d67b9-c46a-9e43-0765-f3742cad70a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "1fbde92f-5150-4229-a025-f15667bd7286",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "b0129423-a52c-0d28-c33a-1d4037278fbb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "785a8a5d-080d-455a-b464-03e236784b9e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "c9505a5b-4e8c-09d9-8fd1-b97fc65fc24c",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "89d801a9-5090-96a7-3108-5cd7739bcdb0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "21291e51-2042-6366-b830-95ba88c8a4db",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "28ba9276-2b21-939f-8c1c-2e1eddb99ad7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "1bc072b3-c20b-4afc-ada9-0ae6047c0297",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2903,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3795,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3795,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3795,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3795,
      "entity_id": "SPQLwKYtw5IyD7AicD3-A",
      "visualization_settings": {
        "stackable.stack_type": "normalized",
        "graph.show_goal": false,
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "graph.y_axis.title_text": "EUR, %",
        "graph.y_axis.axis_enabled": false,
        "graph.metrics": [
          "GMV"
        ]
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 57
    },
    {
      "size_x": 8,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 11.333333333333334
                }
              }
            }
          },
          {
            "display_name": "SUM_TRANSACTIONS",
            "field_ref": [
              "field",
              "SUM_TRANSACTIONS",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "SUM_TRANSACTIONS",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 87489.0,
                  "q1": 91041.0,
                  "q3": 309286.0,
                  "max": 323725.0,
                  "sd": 111423.06068613744,
                  "avg": 198957.66666666666
                }
              }
            }
          },
          {
            "display_name": "PERCENT",
            "field_ref": [
              "field",
              "PERCENT",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "PERCENT",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.07328981563661092,
                  "q1": 0.07626475402667224,
                  "q3": 0.2590886600911467,
                  "max": 0.2711843171126295,
                  "sd": 0.09333908647084288,
                  "avg": 0.16666666666666666
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "GMV Top N - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "3134b440-3336-a7e7-f3f8-e6a25715c195",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "41b1ece1-61be-4452-adf3-31c258907997",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "60ee9ad5-034e-4304-1705-c1b86877b629",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "db96c7d3-7783-0af9-f782-deecf58edc0b",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "11bf7934-6b79-4dfd-8fe4-58cedf689b9d",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "6eb99905-b5b8-b1cc-f97e-11b67abb89ef",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "77880e11-53da-4d31-ae0b-ef408d684e3e",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "0a389ab9-b419-aa0a-61a7-5322c4b57f7b",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "0dedfaa2-f932-b8f1-4194-7206e7414539",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "0bea1ddb-6b35-8588-72ea-ba056411f6df",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ]
              },
              "top_n": {
                "id": "fe9a07e9-683f-f11b-2565-d97e840c03d4",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "cab4d649-c3cc-2166-d74b-0c1b7e8295a9",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "4778e9b0-409f-80e7-afe5-27168013526f",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "4ae45158-8890-80a7-53df-b0e18bf0924d",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "35de6d36-5fec-4a56-b985-420d6ad9206e",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "efb1d30f-2719-4145-23c9-8d840f0caf78",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "dc536f97-18ee-480b-97cb-5bb91c3006ad",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "6af504d2-a391-085c-6aab-37c9eb49dd8b",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "61a726bc-0d2f-43bf-8d4a-e1a2867566ce",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550050,
                  null
                ],
                "widget-type": "string/="
              },
              "transaction_accepted": {
                "id": "1b82ad85-18c9-6356-d7a8-37623cda93da",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "type_operation": {
                "id": "700a8a98-c520-cf6f-b5cb-447480ee93bb",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "fa62c2f9-6dfd-70cc-8e99-51900967b7a7",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "6535f82c-6525-4838-a2b6-52906190a9af",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name    \r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n        \r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.GMV_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1 \r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn <= {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.GMV_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name    \r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect top_n_parameter\r\n     , round(sum(GMV_EUR)) as sum_transactions\r\n     , sum(GMV_EUR)/avg(sum_all_transaction) as percent\r\nfrom main_query\r\ninner join (select sum(GMV_EUR) as sum_all_transaction from main_query) as all_tr on 1=1\r\ngroup by 1\r\norder by 2 desc"
          }
        },
        "id": 3777,
        "parameter_mappings": [],
        "display": "table",
        "archived_directly": false,
        "entity_id": "CF54zAuV3vCjp4Yi3ROtL",
        "collection_preview": true,
        "visualization_settings": {
          "table.pivot_column": "TOP_N_PARAMETER",
          "table.cell_column": "SUM_TRANSACTIONS",
          "column_settings": {
            "[\"name\",\"PERCENT\"]": {
              "number_style": "percent"
            }
          }
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "3134b440-3336-a7e7-f3f8-e6a25715c195",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "41b1ece1-61be-4452-adf3-31c258907997",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "60ee9ad5-034e-4304-1705-c1b86877b629",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "db96c7d3-7783-0af9-f782-deecf58edc0b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "11bf7934-6b79-4dfd-8fe4-58cedf689b9d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "6eb99905-b5b8-b1cc-f97e-11b67abb89ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "77880e11-53da-4d31-ae0b-ef408d684e3e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "0a389ab9-b419-aa0a-61a7-5322c4b57f7b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "0dedfaa2-f932-b8f1-4194-7206e7414539",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "0bea1ddb-6b35-8588-72ea-ba056411f6df",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ]
          },
          {
            "id": "fe9a07e9-683f-f11b-2565-d97e840c03d4",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "cab4d649-c3cc-2166-d74b-0c1b7e8295a9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "4778e9b0-409f-80e7-afe5-27168013526f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "4ae45158-8890-80a7-53df-b0e18bf0924d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "35de6d36-5fec-4a56-b985-420d6ad9206e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "efb1d30f-2719-4145-23c9-8d840f0caf78",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "dc536f97-18ee-480b-97cb-5bb91c3006ad",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "6af504d2-a391-085c-6aab-37c9eb49dd8b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "61a726bc-0d2f-43bf-8d4a-e1a2867566ce",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "1b82ad85-18c9-6356-d7a8-37623cda93da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "700a8a98-c520-cf6f-b5cb-447480ee93bb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "fa62c2f9-6dfd-70cc-8e99-51900967b7a7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "6535f82c-6525-4838-a2b6-52906190a9af",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2904,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3777,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3777,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3777,
      "entity_id": "PfFmcfuj9lFqOK3JSbbfu",
      "visualization_settings": {},
      "size_y": 5,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 63
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "SHARE_GMV",
            "field_ref": [
              "field",
              "SHARE_GMV",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_GMV",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": -0.01111055830615802,
                  "q1": 0.009843941532692082,
                  "q3": 0.027114754442548877,
                  "max": 0.06819659983319365,
                  "sd": 0.021054009860955993,
                  "avg": 0.020740454845123022
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "OOR share GMV from Turnover - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "29eb68c2-d801-1605-a23d-06d83afed156",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": null
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "1242fb76-9f7b-4ed4-b63f-65b1274d0017",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "0e12e2f5-40b7-0328-4811-3be6b8a6f578",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "c6c9c823-9860-db09-1075-80abfba4467a",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "ba47a592-b539-4736-bd12-e637dc6d55f4",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "fa85ce5b-07cc-baf9-c78b-af5f9d3e2584",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "8f6a7413-7733-4a74-b3b6-700662471431",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "8dc731e5-d266-94db-45f0-f9ca52f6ebc3",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "eef59106-25e8-00b1-e1f1-1e6024a1ed60",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "7064ad5c-013d-fa14-fc66-b77860d12dcd",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "b142786a-9207-f005-f229-c8a62f602e7f",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "f3d52acb-cdba-ea42-0a21-8b2e92d5b58f",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "5eaccc42-717f-84d1-43eb-663d27c3061f",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "74851fe6-9ed5-d7a3-897f-5fc652e5d56f",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "76b153e9-f011-4e22-be31-7c9759c9f879",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "f0f2b3fc-d420-ff91-93d9-25ceaf1849f4",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "c2abe049-e2e8-48e9-8ac7-4a7b47f2ff50",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "b5f31ce9-e228-1f23-b10b-8fc091456143",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "a5b2a6f0-5b44-4f45-8c12-a9dd9f156792",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "0a34a985-c206-a20c-956c-fffbb221b2a5",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "id": "5371bef5-186c-0d25-6810-29e2edd19b55",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "e4395660-edf9-1b03-1480-8140e429f286",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "3e3302a5-6c35-4a91-903d-3d34ab127637",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.TURNOVER_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.CONFIRMED and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n                      , TRANSACTIONS.GMV_EUR\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.CONFIRMED and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , case when sum(TURNOVER_EUR) != 0\r\n     then sum(GMV_EUR)/sum(TURNOVER_EUR) end as share_GMV\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3774,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "Uz-pto75rdRxCOe2u0MkJ",
        "collection_preview": true,
        "visualization_settings": {
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ],
          "graph.show_values": true,
          "graph.y_axis.title_text": "Gmv / Turnover",
          "column_settings": {
            "[\"name\",\"SHARE_GMV\"]": {
              "number_style": "percent"
            }
          },
          "graph.metrics": [
            "SHARE_GMV"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "29eb68c2-d801-1605-a23d-06d83afed156",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT"
          },
          {
            "id": "1242fb76-9f7b-4ed4-b63f-65b1274d0017",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "0e12e2f5-40b7-0328-4811-3be6b8a6f578",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "c6c9c823-9860-db09-1075-80abfba4467a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "ba47a592-b539-4736-bd12-e637dc6d55f4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fa85ce5b-07cc-baf9-c78b-af5f9d3e2584",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "8f6a7413-7733-4a74-b3b6-700662471431",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "8dc731e5-d266-94db-45f0-f9ca52f6ebc3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "eef59106-25e8-00b1-e1f1-1e6024a1ed60",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "7064ad5c-013d-fa14-fc66-b77860d12dcd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "b142786a-9207-f005-f229-c8a62f602e7f",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "f3d52acb-cdba-ea42-0a21-8b2e92d5b58f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "5eaccc42-717f-84d1-43eb-663d27c3061f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "74851fe6-9ed5-d7a3-897f-5fc652e5d56f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "76b153e9-f011-4e22-be31-7c9759c9f879",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "f0f2b3fc-d420-ff91-93d9-25ceaf1849f4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "c2abe049-e2e8-48e9-8ac7-4a7b47f2ff50",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "b5f31ce9-e228-1f23-b10b-8fc091456143",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "a5b2a6f0-5b44-4f45-8c12-a9dd9f156792",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "0a34a985-c206-a20c-956c-fffbb221b2a5",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "5371bef5-186c-0d25-6810-29e2edd19b55",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "e4395660-edf9-1b03-1480-8140e429f286",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "3e3302a5-6c35-4a91-903d-3d34ab127637",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2905,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3774,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3774,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3774,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3774,
      "entity_id": "Vgp_WKjCQUYDnmbxm_rwh",
      "visualization_settings": {
        "graph.dimensions": [
          "CREATED_AT",
          "TOP_N_PARAMETER"
        ],
        "graph.show_values": true,
        "graph.y_axis.title_text": "Gmv / Turnover",
        "graph.y_axis.axis_enabled": false,
        "column_settings": {
          "[\"name\",\"SHARE_GMV\"]": {
            "number_style": "percent"
          }
        },
        "graph.metrics": [
          "SHARE_GMV"
        ]
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 69
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2906,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "p7ONs0bZbqsPfTMxAaYfj",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "GMV/Turnover"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 68
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "GMV_EUR",
            "field_ref": [
              "field",
              "GMV_EUR",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "GMV_EUR",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 22230.443934730814,
                  "q1": 33095.114644015484,
                  "q3": 44325.32221614672,
                  "max": 76914.90230920144,
                  "sd": 12173.090520118274,
                  "avg": 40061.36772480938
                }
              }
            }
          },
          {
            "display_name": "GMV_EUR_NO_FX_MARKUP",
            "field_ref": [
              "field",
              "GMV_EUR_NO_FX_MARKUP",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "GMV_EUR_NO_FX_MARKUP",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 1,
                "nil%": 1.0
              },
              "type": {
                "type/Number": {
                  "min": null,
                  "q1": null,
                  "q3": null,
                  "max": null,
                  "sd": null,
                  "avg": null
                }
              }
            }
          },
          {
            "display_name": "GMV_EUR_FX_MARKUP",
            "field_ref": [
              "field",
              "GMV_EUR_FX_MARKUP",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "GMV_EUR_FX_MARKUP",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 2615.3811366891696,
                  "q1": 3688.608703550423,
                  "q3": 6012.612050818149,
                  "max": 8744.04830575196,
                  "sd": 1695.9914009216418,
                  "avg": 5088.61250354759
                }
              }
            }
          },
          {
            "display_name": "SHARE_GMV_FX_MARKUP",
            "field_ref": [
              "field",
              "SHARE_GMV_FX_MARKUP",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_GMV_FX_MARKUP",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.07902277700856412,
                  "q1": 0.10571288587514868,
                  "q3": 0.15916933509801978,
                  "max": 0.23818579686480165,
                  "sd": 0.039123656147323854,
                  "avg": 0.1304222176213774
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Distribution GMV with FX mark up and without - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "c6af4564-7718-384a-a196-d9c99c1f037e",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "79a8ff7e-b04e-4c5b-9757-f9236bb2159b",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "a69719ee-263b-e889-6103-382368cf971a",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "38d8476c-c9e3-7522-824d-a574f2b0f1ad",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "1bd87994-181b-49a3-8d51-1b10b533d3ef",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "0ab7f05b-6419-bd4c-3289-c711503cabc4",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "fa9deb44-b894-4869-a10a-7de8bc4d229f",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "bde32592-4b1d-2ce1-cb61-48b79cf7910e",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "87856eba-0fe2-25a9-608e-a14551dd17b6",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "partner_name": {
                "id": "f0d768eb-7979-fe2d-6490-8bcba5baa9f6",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "e224047a-85dc-4b36-f5cb-0965058d7540",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "46975a03-ee96-49a5-85af-bd2137a43733",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "f381b2e8-1ae8-4bbe-b779-5ec926e003ce",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "3aad97d2-0172-8727-c239-589c8cade0c4",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "c1178600-9e46-4f75-afa5-e5731b34f962",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "f082c4e0-7e31-2da5-f365-5cbde57a7799",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "bd0120c4-be2b-4ca9-b2fd-aa83740bfb1d",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550050,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "1aa16b31-df82-2834-564d-8886c31305bd",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "id": "be482918-dd85-9ed2-4649-a48472027810",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "LOCATION_COUNTRY": {
                "id": "02a0f0d7-7dec-1c92-6db8-54e149630419",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "8aa4090c-c819-469a-9adf-2f6ff5b76f78",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH \r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.id\r\n                      , TRANSACTIONS.GMV_EUR\r\n                      , CASE WHEN TRANSACTIONS.FEE_FX_EUR = 0 \r\n                      THEN TRANSACTIONS.GMV_EUR END AS GMV_EUR_no_FX_markup\r\n                      , CASE WHEN TRANSACTIONS.FEE_FX_EUR != 0 \r\n                      THEN TRANSACTIONS.GMV_EUR END AS GMV_EUR_FX_markup\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n     \r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.CONFIRMED and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , sum(GMV_EUR) AS GMV_EUR\r\n      , sum(GMV_EUR_no_FX_markup) AS GMV_EUR_no_FX_markup\r\n      , sum(GMV_EUR_FX_markup) AS GMV_EUR_FX_markup\r\n      , sum(GMV_EUR_FX_markup)/sum(GMV_EUR) as share_GMV_FX_markup\r\nfrom main_query\r\ngroup by 1\r\norder by 1"
          }
        },
        "id": 3796,
        "parameter_mappings": [],
        "display": "combo",
        "archived_directly": false,
        "entity_id": "jpjpq_cdI3aYFCt9UZwI4",
        "collection_preview": true,
        "visualization_settings": {
          "graph.dimensions": [
            "CREATED_AT"
          ],
          "series_settings": {
            "SHARE_GMV_FX_MARKUP": {
              "display": "line",
              "show_series_values": true
            },
            "GMV_EUR_NO_FX_MARKUP": {
              "display": "bar",
              "show_series_values": true
            },
            "GMV_EUR_FX_MARKUP": {
              "display": "bar",
              "show_series_values": true
            }
          },
          "column_settings": {
            "[\"name\",\"SHARE_GMV_FX_MARKUP\"]": {
              "number_style": "percent"
            },
            "[\"name\",\"GMV_EUR_NO_FX_MARKUP\"]": {
              "number_style": "currency",
              "decimals": 0
            },
            "[\"name\",\"GMV_EUR_FX_MARKUP\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "GMV_EUR_NO_FX_MARKUP",
            "GMV_EUR_FX_MARKUP",
            "SHARE_GMV_FX_MARKUP"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "c6af4564-7718-384a-a196-d9c99c1f037e",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "79a8ff7e-b04e-4c5b-9757-f9236bb2159b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "a69719ee-263b-e889-6103-382368cf971a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "38d8476c-c9e3-7522-824d-a574f2b0f1ad",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "1bd87994-181b-49a3-8d51-1b10b533d3ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "0ab7f05b-6419-bd4c-3289-c711503cabc4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "fa9deb44-b894-4869-a10a-7de8bc4d229f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "bde32592-4b1d-2ce1-cb61-48b79cf7910e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "87856eba-0fe2-25a9-608e-a14551dd17b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "f0d768eb-7979-fe2d-6490-8bcba5baa9f6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "e224047a-85dc-4b36-f5cb-0965058d7540",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "46975a03-ee96-49a5-85af-bd2137a43733",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "f381b2e8-1ae8-4bbe-b779-5ec926e003ce",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "3aad97d2-0172-8727-c239-589c8cade0c4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "c1178600-9e46-4f75-afa5-e5731b34f962",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "f082c4e0-7e31-2da5-f365-5cbde57a7799",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "bd0120c4-be2b-4ca9-b2fd-aa83740bfb1d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "1aa16b31-df82-2834-564d-8886c31305bd",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "be482918-dd85-9ed2-4649-a48472027810",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "02a0f0d7-7dec-1c92-6db8-54e149630419",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "8aa4090c-c819-469a-9adf-2f6ff5b76f78",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2907,
      "parameter_mappings": [
        {
          "parameter_id": "c432bf53",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3796,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3796,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3796,
      "entity_id": "CoFp05GB4NyqssB1CgtDj",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 75
    },
    {
      "size_x": 11,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "COUNT_TRANSACTIONS",
            "field_ref": [
              "field",
              "COUNT_TRANSACTIONS",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "COUNT_TRANSACTIONS",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 36771.0,
                  "q1": 46758.0,
                  "q3": 108300.25,
                  "max": 125467.0,
                  "sd": 36853.4151239746,
                  "avg": 80946.6
                }
              }
            }
          },
          {
            "display_name": "ACCEPTANCE_RATE",
            "field_ref": [
              "field",
              "ACCEPTANCE_RATE",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "ACCEPTANCE_RATE",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.5486641325899068,
                  "q1": 0.5553744968465452,
                  "q3": 0.6852635964867578,
                  "max": 0.84212993343958,
                  "sd": 0.11968538602163097,
                  "avg": 0.6370485362793165
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Acceptance rate by parameter OOR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "7585d334-6b09-d92a-b6fb-806b77a3e2ef",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "1973511b-72fb-47d6-b2c8-fff197964984",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "ff647060-248a-f2ce-c97e-60469fce18a0",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "f89e6012-bfb7-12a4-a4fa-29c0e1276f45",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "91f797d5-82d6-40e2-a1b4-cadf2de86c97",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "38596044-7fd4-b5dd-bb15-86d990077229",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "e36cf8ce-06d3-4dfb-bbe3-3277732642dc",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "4bc10471-2522-7128-3176-7218d23f0f23",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "2b572923-5ee3-1e38-173a-6ed1f6130cfc",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "91d219eb-e6da-42b3-dd2d-855d6f1eaa1a",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "8945fcc7-71d7-a94b-75a3-f18e3075ba69",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "13eaf5a4-6d9c-8b8b-f762-59ec9d4ab23e",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "71249121-bd43-e078-e53f-265a2467136d",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "dd88a6d6-c67c-1a55-43f2-9b99e1472064",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "1bf98649-c2de-4120-80d2-345c91bafb80",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "b3025720-8a42-194c-4d66-1d02abe55dd8",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "00833667-fe3a-44d3-9fc3-e9e84e1d1926",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "none",
                "options": null
              },
              "pay_system": {
                "id": "6a6b6112-61cd-74d2-9273-b67c094b473f",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "87467aeb-33ab-4c16-a37a-261fa3972705",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "id": "42885d91-fafb-374b-c032-a9af94ed14c7",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "antifraud_status": {
                "id": "b0dd67d3-12df-aeb9-438e-d4c32825795e",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "061aee33-a7e1-8669-8c12-45b883b5cb90",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "ed325bde-7834-496b-9943-5eaba7d8304e",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}} and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect top_n_parameter\r\n     , count(distinct case when is_confirmed then id end) as count_transactions\r\n     , count(distinct case when is_confirmed then id end)/count(distinct id) as acceptance_rate\r\nfrom main_query\r\ngroup by 1\r\norder by 2 desc"
          }
        },
        "id": 3785,
        "parameter_mappings": [],
        "display": "table",
        "archived_directly": false,
        "entity_id": "QOK9g_bhcik7kld0IXzZv",
        "collection_preview": true,
        "visualization_settings": {
          "table.pivot_column": "TOP_N_PARAMETER",
          "table.cell_column": "COUNT_TRANSACTIONS",
          "column_settings": {
            "[\"name\",\"ACCEPTANCE_RATE\"]": {
              "number_style": "percent"
            }
          }
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "7585d334-6b09-d92a-b6fb-806b77a3e2ef",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "1973511b-72fb-47d6-b2c8-fff197964984",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "ff647060-248a-f2ce-c97e-60469fce18a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "f89e6012-bfb7-12a4-a4fa-29c0e1276f45",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "91f797d5-82d6-40e2-a1b4-cadf2de86c97",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "38596044-7fd4-b5dd-bb15-86d990077229",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "e36cf8ce-06d3-4dfb-bbe3-3277732642dc",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "4bc10471-2522-7128-3176-7218d23f0f23",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "2b572923-5ee3-1e38-173a-6ed1f6130cfc",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "91d219eb-e6da-42b3-dd2d-855d6f1eaa1a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "8945fcc7-71d7-a94b-75a3-f18e3075ba69",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "13eaf5a4-6d9c-8b8b-f762-59ec9d4ab23e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "71249121-bd43-e078-e53f-265a2467136d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "dd88a6d6-c67c-1a55-43f2-9b99e1472064",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "1bf98649-c2de-4120-80d2-345c91bafb80",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "b3025720-8a42-194c-4d66-1d02abe55dd8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "6a6b6112-61cd-74d2-9273-b67c094b473f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "87467aeb-33ab-4c16-a37a-261fa3972705",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "42885d91-fafb-374b-c032-a9af94ed14c7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation"
          },
          {
            "id": "b0dd67d3-12df-aeb9-438e-d4c32825795e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "061aee33-a7e1-8669-8c12-45b883b5cb90",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "ed325bde-7834-496b-9943-5eaba7d8304e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2908,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3785,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3785,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3785,
      "entity_id": "_E2rg8h_IeyKHsSeKQ3Cd",
      "visualization_settings": {},
      "size_y": 5,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 44
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "query_average_duration": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2909,
      "parameter_mappings": [],
      "card_id": null,
      "entity_id": "FoeIRsd814i9QEeNzSdkN",
      "visualization_settings": {
        "virtual_card": {
          "name": null,
          "display": "text",
          "visualization_settings": {},
          "dataset_query": {},
          "archived": false
        },
        "text": "Revenue EUR",
        "text.align_horizontal": "center"
      },
      "size_y": 1,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 82
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.0
                }
              }
            }
          },
          {
            "display_name": "REVENUE",
            "field_ref": [
              "field",
              "REVENUE",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "REVENUE",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 2891.3897257922,
                  "q1": 7166.755475050956,
                  "q3": 25205.20917937639,
                  "max": 40140.149382018506,
                  "sd": 9976.714631634633,
                  "avg": 15886.92393201145
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Revenue EUR OOR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "b45c2404-ed0e-9fda-e9b3-89bef42c1cbf",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "1dc34735-03eb-44dc-ad01-ed9866527c82",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "85216c8e-53ce-77e4-0436-be99050680c5",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "bff7e18e-061c-bebc-aaf4-ac5e0b8e98a0",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "25d9a808-be11-4063-86f0-4caef43c1e48",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "0acc31cd-2a71-0fbe-78c2-04c90c55a200",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "4ca8b8bb-8a76-4202-bcea-68b9eb3aa8ad",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "e73947f4-1b81-41f9-b328-256db177773e",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "0e312c5e-ad91-a8ad-62a7-502da819228f",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "fda9b8a3-d55a-34ca-0cbf-23494f24ea24",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "cf1a847b-ec8d-ce46-c64c-d615f89ff5eb",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "6b4229b2-3095-e98b-1467-3ed2dbcaae29",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "e1de7546-db8a-e352-f602-941089ed828e",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "0cac9405-cebf-ad56-f014-696f31a8d070",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "01a68a5f-75a2-42dc-9e35-e6182a090faf",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "1bf03ca6-9c19-6931-eb69-80e2940071ac",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "fd9d37b3-dde8-4ea9-b6f0-321d8e949063",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "2dd525b4-e41a-0f16-439f-b60f811e11f3",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "7379defe-1d82-4395-9c79-74236f5c806d",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "e9c37508-8ebe-b42e-0279-13bb8f3a5a11",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "id": "bda935be-d774-8738-ea9a-49b3d1ffbeed",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "LOCATION_COUNTRY": {
                "id": "83c15fdb-3fe3-95b8-b08f-2c6e3bcb00cd",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "05fa9416-4a3b-4ad5-bd93-2c3b9d4b1780",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.gmv_eur) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.revenue_eur\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(revenue_eur) as Revenue\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3775,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "EeBPqX89xDCvtg2GN53YM",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"REVENUE\"]": {
              "number_style": "currency"
            }
          },
          "graph.metrics": [
            "REVENUE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "b45c2404-ed0e-9fda-e9b3-89bef42c1cbf",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "1dc34735-03eb-44dc-ad01-ed9866527c82",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "85216c8e-53ce-77e4-0436-be99050680c5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "bff7e18e-061c-bebc-aaf4-ac5e0b8e98a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "25d9a808-be11-4063-86f0-4caef43c1e48",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "0acc31cd-2a71-0fbe-78c2-04c90c55a200",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "4ca8b8bb-8a76-4202-bcea-68b9eb3aa8ad",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "e73947f4-1b81-41f9-b328-256db177773e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "0e312c5e-ad91-a8ad-62a7-502da819228f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "fda9b8a3-d55a-34ca-0cbf-23494f24ea24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "cf1a847b-ec8d-ce46-c64c-d615f89ff5eb",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6b4229b2-3095-e98b-1467-3ed2dbcaae29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "e1de7546-db8a-e352-f602-941089ed828e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "0cac9405-cebf-ad56-f014-696f31a8d070",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "01a68a5f-75a2-42dc-9e35-e6182a090faf",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "1bf03ca6-9c19-6931-eb69-80e2940071ac",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "fd9d37b3-dde8-4ea9-b6f0-321d8e949063",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "2dd525b4-e41a-0f16-439f-b60f811e11f3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "7379defe-1d82-4395-9c79-74236f5c806d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "e9c37508-8ebe-b42e-0279-13bb8f3a5a11",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "bda935be-d774-8738-ea9a-49b3d1ffbeed",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "83c15fdb-3fe3-95b8-b08f-2c6e3bcb00cd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "05fa9416-4a3b-4ad5-bd93-2c3b9d4b1780",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2910,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3775,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3775,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3775,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3775,
      "entity_id": "oSTNdCs4112CXu9OMtFZi",
      "visualization_settings": {
        "stackable.stack_type": "stacked",
        "graph.show_values": true,
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "graph.y_axis.axis_enabled": false,
        "column_settings": {
          "[\"name\",\"REVENUE\"]": {
            "number_style": "currency"
          }
        },
        "graph.metrics": [
          "REVENUE"
        ]
      },
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 83
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "field_ref": [
              "field",
              "NUMBER_OF_ACCEPANCE_TRANSACTION",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 148,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 57.0,
                  "q1": 1338.3333333333333,
                  "q3": 3809.6666666666665,
                  "max": 6466.0,
                  "sd": 1484.101132511276,
                  "avg": 2698.22
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Number of Transactions - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "cf6f9ae2-2e55-3a7d-2eb5-02157208c4ab",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "5b83f2ab-e834-470a-ad5e-a895204e9017",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "32f584ef-7ecb-8ee6-5bfd-54a52ec824f8",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "3f4151ea-ce24-8f5c-904d-870aa87ea6e3",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "608b0faa-b0ec-4819-a6cb-f6267c293669",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "b0763666-8e21-7a52-0345-de9801434cf3",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "084925f7-4570-4eb4-ab09-40f24649a26c",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "16b53fbb-cc24-cad2-651f-ef15504052f9",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "652f0d81-e8e1-3340-949d-667d0bc69768",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "ed37e598-8dd7-441f-3af1-835de42f25c7",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Parameter for group (single value)",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ]
              },
              "top_n": {
                "id": "4777dbf1-fce9-8e76-1319-eb04d74b2adf",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "50e855b6-0f37-411b-2bcd-363c7ef0d333",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "crypto_currency": {
                "id": "e3d8fde0-bd85-cd39-5058-ceff552d80a3",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "7e22ec38-d5e7-b528-a0f4-915fa1ebcee1",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "ba7b1767-d94f-4548-bdf1-7a24393a018e",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "f737153b-179d-59ef-7fdc-2d8f4d6c4ddb",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "dfbd8786-e565-4cea-a4b5-91a8f7a08b17",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "ce638e37-710e-1c71-4a96-77f144f3d9d5",
                "name": "pay_system",
                "display-name": "Pay system (mobile_pay)",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "9bc29c8b-9864-4b0b-943e-a716ba1ce0e9",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "6e0ea944-5bae-d87b-1dc9-aabc535e01af",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "a3f9982e-6d22-dd79-126f-515ea0775336",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "type_operation": {
                "id": "8656a0ce-8b7a-c056-f495-6e35be0f9225",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "antifraud_status": {
                "id": "3ab52220-8c63-d2fe-f050-067d5f498a46",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "87bafbfd-6331-fa08-e251-03980daf4505",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "f1885f9f-6e70-4fa8-b0a6-4653b8600823",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.WIDGET_PARTNER_NAME\r\n                      , TRANSACTIONS.TYPE as type_operation\r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , count(distinct id) as Number_of_Accepance_Transaction\r\nfrom main_query\r\ngroup by 1,2\r\norder by 3"
          }
        },
        "id": 3782,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "yXNYsdSJwBTRR4ruBHc5M",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "Number of Transaction",
          "graph.show_values": true,
          "graph.x_axis.title_text": "DT",
          "graph.y_axis.scale": "linear",
          "graph.y_axis.auto_split": true,
          "graph.metrics": [
            "NUMBER_OF_ACCEPANCE_TRANSACTION"
          ],
          "graph.y_axis.auto_range": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "stackable.stack_type": "stacked"
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "cf6f9ae2-2e55-3a7d-2eb5-02157208c4ab",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "5b83f2ab-e834-470a-ad5e-a895204e9017",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "32f584ef-7ecb-8ee6-5bfd-54a52ec824f8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "3f4151ea-ce24-8f5c-904d-870aa87ea6e3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "608b0faa-b0ec-4819-a6cb-f6267c293669",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "b0763666-8e21-7a52-0345-de9801434cf3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "084925f7-4570-4eb4-ab09-40f24649a26c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "16b53fbb-cc24-cad2-651f-ef15504052f9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "652f0d81-e8e1-3340-949d-667d0bc69768",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "ed37e598-8dd7-441f-3af1-835de42f25c7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Parameter for group (single value)",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ]
          },
          {
            "id": "4777dbf1-fce9-8e76-1319-eb04d74b2adf",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "50e855b6-0f37-411b-2bcd-363c7ef0d333",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name",
            "required": false
          },
          {
            "id": "e3d8fde0-bd85-cd39-5058-ceff552d80a3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "7e22ec38-d5e7-b528-a0f4-915fa1ebcee1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "ba7b1767-d94f-4548-bdf1-7a24393a018e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "f737153b-179d-59ef-7fdc-2d8f4d6c4ddb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "dfbd8786-e565-4cea-a4b5-91a8f7a08b17",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "ce638e37-710e-1c71-4a96-77f144f3d9d5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system (mobile_pay)",
            "slug": "pay_system",
            "required": false
          },
          {
            "id": "9bc29c8b-9864-4b0b-943e-a716ba1ce0e9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "6e0ea944-5bae-d87b-1dc9-aabc535e01af",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "a3f9982e-6d22-dd79-126f-515ea0775336",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "required": false
          },
          {
            "id": "8656a0ce-8b7a-c056-f495-6e35be0f9225",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "3ab52220-8c63-d2fe-f050-067d5f498a46",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "87bafbfd-6331-fa08-e251-03980daf4505",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "f1885f9f-6e70-4fa8-b0a6-4653b8600823",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2911,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3782,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3782,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3782,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3782,
      "entity_id": "9_T912spe8Ytm2OAnuXjT",
      "visualization_settings": {
        "graph.y_axis.title_text": "Number of Transaction",
        "graph.show_values": true,
        "stackable.stack_display": "bar",
        "graph.x_axis.title_text": "DT",
        "graph.y_axis.scale": "linear",
        "graph.y_axis.auto_split": true,
        "graph.metrics": [
          "NUMBER_OF_ACCEPANCE_TRANSACTION"
        ],
        "graph.y_axis.axis_enabled": false,
        "graph.y_axis.auto_range": true,
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "stackable.stack_type": "stacked"
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 20
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "TURNOVER",
            "field_ref": [
              "field",
              "TURNOVER",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "TURNOVER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 82013.48382460054,
                  "q1": 201720.95436463857,
                  "q3": 694485.5332256899,
                  "max": 1033471.2049529814,
                  "sd": 273962.37395281746,
                  "avg": 419443.4005483792
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Turnover EUR relative value - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "e8273c09-285f-cc40-1dc9-c2d5c42f097e",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "a24f835a-285f-4676-8247-cbace7b77ee3",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "b054efed-59bf-5b8d-7ede-aad8dd2e5bf6",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "id": "6c311b99-9789-2764-fa8a-0b1b6182daff",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "3290569f-f67e-4504-857c-a5ec330461c2",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "739b92af-04ed-f58d-39c4-5058450aa362",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "f1aac7e9-cd38-4320-bb55-3728d9c10344",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "3671eddc-9e10-9e66-d45a-561197cd6485",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "id": "23cc4bab-2abb-07b1-b2e3-7c1cccac3e35",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "9f8b8541-0c19-9ced-e273-db291ce763b8",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "id": "55f0505e-921d-fabd-331d-cf81c22e718e",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "7788ae5f-272a-d157-6f04-ef51caf1ffa3",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "id": "d14d4a94-7218-b600-5935-97af419e10a5",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "id": "3bc79edd-c7ef-b2bf-249f-80ec7573b783",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "7e73b98a-53c7-479d-aeb1-04acde9ecd36",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "442cadeb-3f9a-1832-dd86-7922c1bcab65",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "328d6b7e-641a-4642-a142-68211fc0ae01",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "0b1cba02-c0fe-8bd1-8821-dd88dae6f69b",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "5496dbb5-05fd-4fbb-b5bd-42cf961d2f15",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "973f1689-0ab4-f8cf-65bf-e6b4d8f97241",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "187e1a7d-36d3-94c5-eaeb-301a9ec1346a",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "default": [
                  true
                ],
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "type_operation": {
                "id": "78733c9b-a672-5dba-0c83-49c4a32ae2a1",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "default": [
                  "sell",
                  "fiat_buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "buy"
                ],
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "LOCATION_COUNTRY": {
                "id": "5d35bf5d-c875-a88f-3984-5d8affc04f23",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "facd0ec0-cc86-4fd7-8d2f-41f1ef325d14",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FIAT_AMOUNT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_topN\r\n     , sum(TURNOVER_EUR) as Turnover\r\nfrom main_query\r\ngroup by 1,2\r\norder by 3"
          }
        },
        "id": 3780,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "elejSVURJmTs16sH9_qoi",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "normalized",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.metrics": [
            "TURNOVER"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "e8273c09-285f-cc40-1dc9-c2d5c42f097e",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "a24f835a-285f-4676-8247-cbace7b77ee3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "b054efed-59bf-5b8d-7ede-aad8dd2e5bf6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "6c311b99-9789-2764-fa8a-0b1b6182daff",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "3290569f-f67e-4504-857c-a5ec330461c2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "739b92af-04ed-f58d-39c4-5058450aa362",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "f1aac7e9-cd38-4320-bb55-3728d9c10344",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "3671eddc-9e10-9e66-d45a-561197cd6485",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "23cc4bab-2abb-07b1-b2e3-7c1cccac3e35",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "9f8b8541-0c19-9ced-e273-db291ce763b8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true,
            "values_query_type": "list"
          },
          {
            "id": "55f0505e-921d-fabd-331d-cf81c22e718e",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "7788ae5f-272a-d157-6f04-ef51caf1ffa3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "d14d4a94-7218-b600-5935-97af419e10a5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "3bc79edd-c7ef-b2bf-249f-80ec7573b783",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "7e73b98a-53c7-479d-aeb1-04acde9ecd36",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "442cadeb-3f9a-1832-dd86-7922c1bcab65",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "328d6b7e-641a-4642-a142-68211fc0ae01",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "0b1cba02-c0fe-8bd1-8821-dd88dae6f69b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "5496dbb5-05fd-4fbb-b5bd-42cf961d2f15",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "973f1689-0ab4-f8cf-65bf-e6b4d8f97241",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "187e1a7d-36d3-94c5-eaeb-301a9ec1346a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "default": [
              true
            ],
            "required": true
          },
          {
            "id": "78733c9b-a672-5dba-0c83-49c4a32ae2a1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "sell",
              "fiat_buy",
              "buy_acquirer",
              "mobile_pay",
              "buy"
            ],
            "required": false
          },
          {
            "id": "5d35bf5d-c875-a88f-3984-5d8affc04f23",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "facd0ec0-cc86-4fd7-8d2f-41f1ef325d14",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2912,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3780,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3780,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3780,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3780,
      "entity_id": "n3VR0Dcu3bee3N_wLzKAi",
      "visualization_settings": {
        "stackable.stack_type": "normalized",
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "graph.y_axis.axis_enabled": false,
        "graph.metrics": [
          "TURNOVER"
        ]
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 8
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "field_ref": [
              "field",
              "NUMBER_OF_ACCEPANCE_TRANSACTION",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 148,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 57.0,
                  "q1": 1338.3333333333333,
                  "q3": 3809.6666666666665,
                  "max": 6466.0,
                  "sd": 1484.101132511276,
                  "avg": 2698.22
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Number of OOR transaction relative value - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "7170c742-aa10-f559-2f51-e5485ba2e386",
                "name": "CREATED_AT",
                "display-name": "Created at",
                "type": "dimension",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "773a8e64-5997-4ee0-8c62-501c183f631d",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "b395cd0c-34ba-e036-4dbf-a80e2b90204e",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "id": "80f6c18e-f709-122b-2853-7b46598f1f5d",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "bd7704fa-9a94-4a7e-b22b-46e41941f91c",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "b7c7d768-a9ba-83e9-0280-3aa263811961",
                "name": "vendor_name",
                "display-name": "Vendor name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "69c6ac09-df6e-4db9-99f6-9d2041442479",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "b3d9f30e-cbbc-c278-56a2-e3c2dd674058",
                "name": "LOCATION_GEO",
                "display-name": "Location geo",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "id": "55094041-80d2-e9d8-6b73-3518b1809abf",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "31e17847-c32f-034d-c0e5-f729a2832545",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Transaction columns groupby",
                "type": "dimension",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "id": "278515f6-eb7e-07d9-829d-2a45046aefdf",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "d2833e25-4424-c6f8-9d8f-11484b698e82",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "id": "9d175e1f-a943-2e8b-a53b-19a53e2bb40a",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "id": "968c94f5-de03-04cf-6dce-9b6d9a6a131c",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "e2b85434-70b5-41ae-8be6-f70fcb1ee1a9",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "fc7e8841-8802-1eeb-4672-77ec256b5a9c",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "fdf86014-6090-4fa2-98c2-418b06df0602",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "952bdef9-8c18-af91-352e-80edbb7d2741",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "f830e8a3-48c6-4bc1-bc10-2e1399c1871e",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "20ef451e-3825-c3b4-61e5-a1fb2d8e4fcd",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "dd7a09b5-1c4e-da1b-159c-31aed509411b",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "type_operation": {
                "id": "aa5da994-7aed-ed44-4df2-d2b93a815ac0",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "default": [
                  "sell",
                  "fiat_buy",
                  "buy_acquirer",
                  "buy",
                  "mobile_pay"
                ],
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "antifraud_status": {
                "id": "cce97cec-5ccb-5202-5534-ec937b6e1eb3",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "bd4ccea1-4083-ea17-eb76-a89949c4d116",
                "name": "LOCATION_COUNTRY",
                "display-name": "Location country",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "d6f7eaad-edaf-41d6-b5cd-92ded812fc88",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n        left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.WIDGET_PARTNER_NAME\r\n                      , TRANSACTIONS.TYPE as type_operation\r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}}  and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , count(distinct id) as Number_of_Accepance_Transaction\r\nfrom main_query\r\ngroup by 1,2\r\norder by 3"
          }
        },
        "id": 3778,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "8yCoLOC7jjUxMEpeRtUAt",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "normalized",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.series_order_dimension": null,
          "graph.series_order": null,
          "graph.metrics": [
            "NUMBER_OF_ACCEPANCE_TRANSACTION"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "7170c742-aa10-f559-2f51-e5485ba2e386",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created at",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "773a8e64-5997-4ee0-8c62-501c183f631d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "b395cd0c-34ba-e036-4dbf-a80e2b90204e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "80f6c18e-f709-122b-2853-7b46598f1f5d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "bd7704fa-9a94-4a7e-b22b-46e41941f91c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "b7c7d768-a9ba-83e9-0280-3aa263811961",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor name",
            "slug": "vendor_name"
          },
          {
            "id": "69c6ac09-df6e-4db9-99f6-9d2041442479",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "b3d9f30e-cbbc-c278-56a2-e3c2dd674058",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "55094041-80d2-e9d8-6b73-3518b1809abf",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "31e17847-c32f-034d-c0e5-f729a2832545",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction columns groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "278515f6-eb7e-07d9-829d-2a45046aefdf",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "d2833e25-4424-c6f8-9d8f-11484b698e82",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name"
          },
          {
            "id": "9d175e1f-a943-2e8b-a53b-19a53e2bb40a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "968c94f5-de03-04cf-6dce-9b6d9a6a131c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "e2b85434-70b5-41ae-8be6-f70fcb1ee1a9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "fc7e8841-8802-1eeb-4672-77ec256b5a9c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "fdf86014-6090-4fa2-98c2-418b06df0602",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "952bdef9-8c18-af91-352e-80edbb7d2741",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "f830e8a3-48c6-4bc1-bc10-2e1399c1871e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "20ef451e-3825-c3b4-61e5-a1fb2d8e4fcd",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "dd7a09b5-1c4e-da1b-159c-31aed509411b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "required": false
          },
          {
            "id": "aa5da994-7aed-ed44-4df2-d2b93a815ac0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "sell",
              "fiat_buy",
              "buy_acquirer",
              "buy",
              "mobile_pay"
            ],
            "required": true
          },
          {
            "id": "cce97cec-5ccb-5202-5534-ec937b6e1eb3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "bd4ccea1-4083-ea17-eb76-a89949c4d116",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "d6f7eaad-edaf-41d6-b5cd-92ded812fc88",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2913,
      "parameter_mappings": [
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3778,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3778,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3778,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3778,
      "entity_id": "FqsATB0jxv-Dxzv4K-RM3",
      "visualization_settings": {
        "stackable.stack_type": "normalized",
        "graph.dimensions": [
          "DT",
          "PARAMETER_TOPN"
        ],
        "graph.y_axis.axis_enabled": false,
        "graph.metrics": [
          "NUMBER_OF_ACCEPANCE_TRANSACTION"
        ]
      },
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 26
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.0
                }
              }
            }
          },
          {
            "display_name": "FEE_BLOCKCHAIN_EUR",
            "field_ref": [
              "field",
              "FEE_BLOCKCHAIN_EUR",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "FEE_BLOCKCHAIN_EUR",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 16.720996649873943,
                  "q1": 65.69958386106845,
                  "q3": 250.8893299646911,
                  "max": 828.8126907608469,
                  "sd": 158.2883623348266,
                  "avg": 185.49591043641283
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Network fee EUR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "c1bbfa96-1786-4c3d-b7c6-3a3cac5bcbdd",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "1203745b-75f6-4794-ab4e-4aed25195e91",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "e17500e9-6c07-4461-9b0b-6a9d8139ea3a",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "3a09d986-9878-4d21-8eb3-ed955c61bf06",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "3b8c0a14-a047-47b2-8a98-7f9ab5f23c79",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "7ccdf032-032b-404e-9881-66556654aa86",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "1c90c551-3e85-442b-91a2-286a28e8f4c9",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "87296f5c-7cfe-46a2-b0fc-a972227d98d1",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "174c329e-3267-490c-8c07-328169500f59",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "953b1a36-e14b-4621-8209-3db6d1d89c2c",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/="
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "f4ac3871-c8b3-4f09-b146-c367c1022c01",
                "display-name": "Top N",
                "required": true,
                "default": "5"
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "893ec135-645e-4b61-9893-84ddfe01f25a",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "3736ebc0-e7e3-433e-b7a3-4dca25889448",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "714da4fc-914c-4b7c-827d-b4fe35ece8ff",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "21328472-b13e-459a-9db9-8a5b19e3466f",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "f8f27505-7ff2-472f-8954-06b9b086025d",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "4702d97a-a013-4088-8a25-dcfb01515a5c",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "1e075f27-5d57-41e7-ab74-78daf5bf6d2f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "67a59506-da15-477b-be56-4ace12b1b027",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "d82bfd21-0570-4b4c-bbd8-49aa0c3a5198",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "e5a9c9ed-9f65-4546-8445-dc0cd9a54671",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "f1409ec7-d1f5-4bb5-9687-a554cb144c98",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "3f0c336b-45f0-48ae-abcf-984868350a13",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FEE_BLOCKCHAIN_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.FEE_BLOCKCHAIN_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}}  and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(FEE_BLOCKCHAIN_EUR) as FEE_BLOCKCHAIN_EUR\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3802,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "QTskDKSDd4Wn1KvG8h6lA",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"FEE_BLOCKCHAIN_EUR\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "FEE_BLOCKCHAIN_EUR"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "c1bbfa96-1786-4c3d-b7c6-3a3cac5bcbdd",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "1203745b-75f6-4794-ab4e-4aed25195e91",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "e17500e9-6c07-4461-9b0b-6a9d8139ea3a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "3a09d986-9878-4d21-8eb3-ed955c61bf06",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "3b8c0a14-a047-47b2-8a98-7f9ab5f23c79",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "7ccdf032-032b-404e-9881-66556654aa86",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "1c90c551-3e85-442b-91a2-286a28e8f4c9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "87296f5c-7cfe-46a2-b0fc-a972227d98d1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "174c329e-3267-490c-8c07-328169500f59",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "953b1a36-e14b-4621-8209-3db6d1d89c2c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ]
          },
          {
            "id": "f4ac3871-c8b3-4f09-b146-c367c1022c01",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "893ec135-645e-4b61-9893-84ddfe01f25a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "3736ebc0-e7e3-433e-b7a3-4dca25889448",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "714da4fc-914c-4b7c-827d-b4fe35ece8ff",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "21328472-b13e-459a-9db9-8a5b19e3466f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "f8f27505-7ff2-472f-8954-06b9b086025d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "4702d97a-a013-4088-8a25-dcfb01515a5c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "1e075f27-5d57-41e7-ab74-78daf5bf6d2f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "67a59506-da15-477b-be56-4ace12b1b027",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "d82bfd21-0570-4b4c-bbd8-49aa0c3a5198",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "e5a9c9ed-9f65-4546-8445-dc0cd9a54671",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "f1409ec7-d1f5-4bb5-9687-a554cb144c98",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "3f0c336b-45f0-48ae-abcf-984868350a13",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2914,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3802,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3802,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3802,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3802,
      "entity_id": "TEfqQn7cqbiIYuIcEafH5",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 125
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.0
                }
              }
            }
          },
          {
            "display_name": "COMMISSION_REVENUE",
            "field_ref": [
              "field",
              "COMMISSION_REVENUE",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "COMMISSION_REVENUE",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 2667.1923314841,
                  "q1": 7001.149353045514,
                  "q3": 25026.80133034622,
                  "max": 44040.77506944406,
                  "sd": 10895.419898736953,
                  "avg": 16155.781464519489
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Commission revenue EUR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "28e3b0b1-9d52-4b1a-b2a1-cba985beaf1a",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "f766fd27-dede-4757-ba80-15dc60d84efb",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "586b1207-54ca-4d2c-8ab3-f35fcf8ede05",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "9d6ed375-769e-4063-bbb9-093c3f0752eb",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "209e2879-31a2-4aee-9aab-a91620794aa4",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "52b65ac6-4b90-4ebf-afc8-e388edaaca30",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "338a6b75-d0bc-47b5-bd5d-50ecf06a71f2",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "6ec11915-4df5-4703-b7c0-235bdee6763a",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "d3e74b3f-e2be-4dc4-a0b5-532d3603f9a1",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "d1a7bbdb-699f-4638-95db-6c6861588c18",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "c2a05f6c-5a54-42d2-ac77-4a50c4d4de25",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "4d1ae136-f26a-4715-9ba6-23d4b719f1df",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "1a2a35f3-1b72-42e0-9bd9-9811b6bc26c7",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "14f02b04-b83f-4717-917c-5d6dfce60965",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "91499dcc-052d-4d15-ab10-75b0ee2855df",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "7870cbb9-2f21-4c04-965f-206b6e614956",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "9a8c4277-d7b2-41ab-803d-30f929b0a6d5",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "4e92a00f-5fd6-4d4d-8074-eecdee36ddb2",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "8ee73014-a382-4e56-aa8e-4b495dbf57ae",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "45c50e70-4ef3-4682-822e-d1e0538fd49a",
                "display-name": "Granularity",
                "default": "day",
                "required": true
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "7440502b-9d51-4df5-a1bb-ca8b32a3062e",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "8d1e35c8-9b70-4ce6-b463-4f83ca723fc0",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "f3b3b559-5405-4d71-bfb8-3aa4d81c3600",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FEE_BLOCKCHAIN_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.FEE_MERCURIO_FIAT_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(FEE_MERCURIO_FIAT_EUR) as Commission_revenue\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3788,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "MZCYTl39l_8Lz-fZZJ95n",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"COMMISSION_REVENUE\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "COMMISSION_REVENUE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "28e3b0b1-9d52-4b1a-b2a1-cba985beaf1a",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "f766fd27-dede-4757-ba80-15dc60d84efb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "586b1207-54ca-4d2c-8ab3-f35fcf8ede05",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "9d6ed375-769e-4063-bbb9-093c3f0752eb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "209e2879-31a2-4aee-9aab-a91620794aa4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "52b65ac6-4b90-4ebf-afc8-e388edaaca30",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "338a6b75-d0bc-47b5-bd5d-50ecf06a71f2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "6ec11915-4df5-4703-b7c0-235bdee6763a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "d3e74b3f-e2be-4dc4-a0b5-532d3603f9a1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "d1a7bbdb-699f-4638-95db-6c6861588c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "c2a05f6c-5a54-42d2-ac77-4a50c4d4de25",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "4d1ae136-f26a-4715-9ba6-23d4b719f1df",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "1a2a35f3-1b72-42e0-9bd9-9811b6bc26c7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "14f02b04-b83f-4717-917c-5d6dfce60965",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "91499dcc-052d-4d15-ab10-75b0ee2855df",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "7870cbb9-2f21-4c04-965f-206b6e614956",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "9a8c4277-d7b2-41ab-803d-30f929b0a6d5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "4e92a00f-5fd6-4d4d-8074-eecdee36ddb2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "8ee73014-a382-4e56-aa8e-4b495dbf57ae",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "45c50e70-4ef3-4682-822e-d1e0538fd49a",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "7440502b-9d51-4df5-a1bb-ca8b32a3062e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "8d1e35c8-9b70-4ce6-b463-4f83ca723fc0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "f3b3b559-5405-4d71-bfb8-3aa4d81c3600",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2915,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3788,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3788,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3788,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3788,
      "entity_id": "2fY92eAlgjNvsNqb5q6kI",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 98
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 13.4
                }
              }
            }
          },
          {
            "display_name": "MARK_UP_REVENUE",
            "field_ref": [
              "field",
              "MARK_UP_REVENUE",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "MARK_UP_REVENUE",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": -16484.3890530098,
                  "q1": 84.34406331215312,
                  "q3": 1641.0793923518122,
                  "max": 6505.2389393963995,
                  "sd": 5865.1336642413125,
                  "avg": -1089.908277637486
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Mark up revenue - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "88b44f85-fa04-4652-91f6-6690ee092fe5",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "5fac2dec-b249-4724-9a25-f45e2f79e8e4",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "35f9af3b-6b5e-4438-be9d-c8fda9b88479",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "9d572741-ba57-4934-9ac8-159b2675bab3",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "861da5cd-3e9e-4fe4-baf8-95c78a135ed7",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "afdd1b2b-a3d3-46f9-9fa1-aacc82b824af",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "d72ccd35-5434-4130-b7a4-e5a1fceed213",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "56741ec0-f95d-4f68-8996-343063348e0f",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "920dba74-3fed-4d85-a0a5-fc8c5c600cc5",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "438bcbd6-f983-4ec6-ba3b-75be5a56279e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "b7e9a5b9-6f3e-4a8f-84ed-3564d206e308",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "80a372b7-8f9f-42f0-8861-f34cadab3070",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "38a9a1c9-55e3-4d80-97db-a84be43aea41",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "59d3746d-f51c-43e1-91b3-b3b62819d6f8",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "df5b3452-e868-46d4-8a02-1f986c38e5e5",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "d91a2711-2fe9-462d-85a7-e3aaaeaedfea",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "1a83eee2-c8b5-49e8-97e9-0281b1e032aa",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "332973d8-ba8d-483a-9b07-fc251987814f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "5f3e0e0e-32f8-499f-8410-b45b3539f6ed",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "bfc0de06-b1d7-4f51-9b3a-4c5cb8733d65",
                "display-name": "Granularity",
                "default": "day",
                "required": true
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "21061579-d367-4c81-a847-b8eec1745325",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "25960a2c-1352-42ab-befc-391cee5fe04d",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "a002e1ca-b692-4fde-a52b-3a915525aa7e",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FEE_RATIO_RATES_FIAT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.FEE_RATIO_RATES_FIAT_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(FEE_RATIO_RATES_FIAT_EUR) as Mark_up_revenue\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3790,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "i4o37lAvQZPzD6RsoScUA",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.show_values": true,
          "column_settings": {
            "[\"name\",\"MARK_UP_REVENUE\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "MARK_UP_REVENUE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "88b44f85-fa04-4652-91f6-6690ee092fe5",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "5fac2dec-b249-4724-9a25-f45e2f79e8e4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "35f9af3b-6b5e-4438-be9d-c8fda9b88479",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "9d572741-ba57-4934-9ac8-159b2675bab3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "861da5cd-3e9e-4fe4-baf8-95c78a135ed7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "afdd1b2b-a3d3-46f9-9fa1-aacc82b824af",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "d72ccd35-5434-4130-b7a4-e5a1fceed213",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "56741ec0-f95d-4f68-8996-343063348e0f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "920dba74-3fed-4d85-a0a5-fc8c5c600cc5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "438bcbd6-f983-4ec6-ba3b-75be5a56279e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "b7e9a5b9-6f3e-4a8f-84ed-3564d206e308",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "80a372b7-8f9f-42f0-8861-f34cadab3070",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "38a9a1c9-55e3-4d80-97db-a84be43aea41",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "59d3746d-f51c-43e1-91b3-b3b62819d6f8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "df5b3452-e868-46d4-8a02-1f986c38e5e5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "d91a2711-2fe9-462d-85a7-e3aaaeaedfea",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "1a83eee2-c8b5-49e8-97e9-0281b1e032aa",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "332973d8-ba8d-483a-9b07-fc251987814f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "5f3e0e0e-32f8-499f-8410-b45b3539f6ed",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "bfc0de06-b1d7-4f51-9b3a-4c5cb8733d65",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "21061579-d367-4c81-a847-b8eec1745325",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "25960a2c-1352-42ab-befc-391cee5fe04d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "a002e1ca-b692-4fde-a52b-3a915525aa7e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2916,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3790,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3790,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3790,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3790,
      "entity_id": "2RT9PTQaB6K3aR6aT9OEu",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 105
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 8.4
                }
              }
            }
          },
          {
            "display_name": "FX_MARK_UP_REVENUE",
            "field_ref": [
              "field",
              "FX_MARK_UP_REVENUE",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "FX_MARK_UP_REVENUE",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 3.5500000000000114,
                  "q1": 97.49456552640002,
                  "q3": 489.154756897075,
                  "max": 1544.9682053874963,
                  "sd": 303.94341490935864,
                  "avg": 326.21027859771937
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "FX Mark up Revenue - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "a4970644-64b7-40df-b731-4faf5d8e1a38",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "1f876e21-2594-4431-bafa-8dbb5f91f3a3",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "c7cf43c6-593a-4155-a632-240b89c9f663",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "f9db590e-bd90-4149-a325-5be47415fc43",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "8451f025-6652-460b-a318-dab9a4e4fd65",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "eb4acfb1-13dc-4666-8199-c3ee2ee4ca3b",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "83719511-aff8-4ded-89a2-68d5eab78204",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "4cb82799-7231-41a6-8779-b1de95c60116",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "6b594205-da90-4e86-8210-35eedca06e10",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "ad561d23-cf95-4878-b090-62b7a3dd0c5a",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "e04e2a17-c26f-49a6-b03e-d1925ab94d61",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "1dd16a5a-4b28-445d-81c1-40a3e332aff7",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "00f78a0b-3432-4533-bb8e-b35a9a142a6e",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "e3f66d56-c5bb-4b4c-a8c1-89b97abc9ae5",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "28ec2d8d-e9fc-49c9-b07f-cddff3c55f45",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "d28e4b0a-fd4e-4444-964b-9fb415b883fa",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "d7434197-7c6b-4489-ac7d-c38e2e263f8b",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "43e3814f-455f-4c0f-b9c0-dafc3d45d09c",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "3cc3fc5f-0450-4ac7-8b4b-8e411345c99f",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550050,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "e023fd12-e995-4c90-872b-8a92a04f5e53",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "12b49938-501c-4a21-97b8-149f2b18eff8",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "38323300-b717-4af3-8674-62be7c68f369",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "84455a0e-7c98-4941-bd54-5fca6c102f7b",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(zeroifnull(TRANSACTIONS.FEE_FX_EUR)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.FEE_FX_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}}  and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(FEE_FX_EUR) as FX_Mark_up_revenue\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3781,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "mVz-c3LLHGyqS_b0e5aRX",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"FX_MARK_UP_REVENUE\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "FX_MARK_UP_REVENUE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "a4970644-64b7-40df-b731-4faf5d8e1a38",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "1f876e21-2594-4431-bafa-8dbb5f91f3a3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "c7cf43c6-593a-4155-a632-240b89c9f663",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "f9db590e-bd90-4149-a325-5be47415fc43",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "8451f025-6652-460b-a318-dab9a4e4fd65",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "eb4acfb1-13dc-4666-8199-c3ee2ee4ca3b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "83719511-aff8-4ded-89a2-68d5eab78204",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "4cb82799-7231-41a6-8779-b1de95c60116",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "6b594205-da90-4e86-8210-35eedca06e10",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "ad561d23-cf95-4878-b090-62b7a3dd0c5a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "e04e2a17-c26f-49a6-b03e-d1925ab94d61",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "1dd16a5a-4b28-445d-81c1-40a3e332aff7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "00f78a0b-3432-4533-bb8e-b35a9a142a6e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "e3f66d56-c5bb-4b4c-a8c1-89b97abc9ae5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "28ec2d8d-e9fc-49c9-b07f-cddff3c55f45",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "d28e4b0a-fd4e-4444-964b-9fb415b883fa",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "d7434197-7c6b-4489-ac7d-c38e2e263f8b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "43e3814f-455f-4c0f-b9c0-dafc3d45d09c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "3cc3fc5f-0450-4ac7-8b4b-8e411345c99f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "e023fd12-e995-4c90-872b-8a92a04f5e53",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "12b49938-501c-4a21-97b8-149f2b18eff8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "38323300-b717-4af3-8674-62be7c68f369",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "84455a0e-7c98-4941-bd54-5fca6c102f7b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2917,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3781,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3781,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3781,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3781,
      "entity_id": "nfH1tH0eyiJVH4YhpTZgZ",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 112
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "SHARE_TRANSACTION_FEE_MIN",
            "field_ref": [
              "field",
              "SHARE_TRANSACTION_FEE_MIN",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_TRANSACTION_FEE_MIN",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 121,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.0,
                  "q1": 0.007375195601981194,
                  "q3": 0.020901659728485886,
                  "max": 0.8448660714285714,
                  "sd": 0.321292696925567,
                  "avg": 0.17039883862705327
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Share transactions with fee min (by transactions) - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "ec16029c-5331-4651-a1f5-72e80622f1c7",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "0327dc30-c99e-4ed6-8d79-3cf2cf0c1b84",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "d33d5f4d-e292-4ae9-ae23-f7eee0dd10d4",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "d0d40d35-8801-4254-9fc2-e585be60063d",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "55b13de9-1ce5-4f8d-8c02-8f8b7e1aebae",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "6006a583-12e3-470e-9885-8732c0677ebc",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "71d6955e-f452-424d-b317-8fbff5872b39",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "163eb3ea-0589-4253-a399-865a65fa0080",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "05391a2d-394e-48e8-abb7-934c07012227",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "26764abd-ff86-405e-ae44-b388bfb7c2e6",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "dc28498f-9af8-400e-b372-a36fc5c3b15f",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "b305093f-e33f-4008-bbbc-f527b039cf4b",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "e39b0d7c-0450-4abe-b5e3-610747728337",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "71914a26-5975-4456-92d8-2794fa0f6845",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "bc43a830-8de4-413d-8988-eca86fb4d595",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "01a2f080-5d74-410b-9754-8c96cbf5cd75",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "1a9610eb-6abb-4921-a242-e300075933f5",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "792b32e8-ad21-49b6-9654-fa57ea0467bc",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "738596b6-0287-4d14-95ed-0bebf68750c3",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "0fd29d18-5fc1-4324-b3f3-534ea121f3d2",
                "display-name": "Granularity",
                "default": "day",
                "required": true
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "00fe533b-3838-4ef1-8bce-949dc0c67e75",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "3120b9be-b05c-49e2-aa15-dd1a4f36e3af",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "577ff442-5493-4ba1-9d34-ee450d0ea3b2",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and TRANSACTIONS.CONFIRMED and {{flag_is_recurring}} and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , round(TRANSACTIONS.fee_min,2) = round((TRANSACTIONS.FEE_TOTAL_FIAT - TRANSACTIONS.FEE_NETWORK_REVENUE_FIAT),2) AS is_fee_min\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and TRANSACTIONS.CONFIRMED and {{flag_is_recurring}} and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , count(distinct case when is_fee_min then id end)/count(distinct id) as share_transaction_fee_min\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3768,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "M-HdJrDIkade917JJMKCn",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "Percent transaction with fee min",
          "graph.show_values": true,
          "graph.x_axis.labels_enabled": true,
          "graph.series_order_dimension": null,
          "graph.y_axis.labels_enabled": true,
          "graph.y_axis.auto_split": true,
          "graph.metrics": [
            "SHARE_TRANSACTION_FEE_MIN"
          ],
          "graph.series_order": null,
          "column_settings": {
            "[\"name\",\"SHARE_TRANSACTION_FEE_MIN\"]": {
              "number_style": "percent",
              "decimals": 1
            }
          },
          "series_settings": {
            "COUNT_TRANSACTIONS": {
              "display": "bar",
              "title": "Count accepted transactions"
            },
            "SHARE_TRANSACTION_FEE_MIN": {
              "title": "Share transactions with fee min"
            }
          },
          "graph.y_axis.auto_range": true,
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "ec16029c-5331-4651-a1f5-72e80622f1c7",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "0327dc30-c99e-4ed6-8d79-3cf2cf0c1b84",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "d33d5f4d-e292-4ae9-ae23-f7eee0dd10d4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "d0d40d35-8801-4254-9fc2-e585be60063d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "55b13de9-1ce5-4f8d-8c02-8f8b7e1aebae",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "6006a583-12e3-470e-9885-8732c0677ebc",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "71d6955e-f452-424d-b317-8fbff5872b39",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "163eb3ea-0589-4253-a399-865a65fa0080",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "05391a2d-394e-48e8-abb7-934c07012227",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "26764abd-ff86-405e-ae44-b388bfb7c2e6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "dc28498f-9af8-400e-b372-a36fc5c3b15f",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "b305093f-e33f-4008-bbbc-f527b039cf4b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "e39b0d7c-0450-4abe-b5e3-610747728337",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "71914a26-5975-4456-92d8-2794fa0f6845",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "bc43a830-8de4-413d-8988-eca86fb4d595",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "01a2f080-5d74-410b-9754-8c96cbf5cd75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "1a9610eb-6abb-4921-a242-e300075933f5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "792b32e8-ad21-49b6-9654-fa57ea0467bc",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "738596b6-0287-4d14-95ed-0bebf68750c3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "0fd29d18-5fc1-4324-b3f3-534ea121f3d2",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "00fe533b-3838-4ef1-8bce-949dc0c67e75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "3120b9be-b05c-49e2-aa15-dd1a4f36e3af",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "577ff442-5493-4ba1-9d34-ee450d0ea3b2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2918,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3768,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3768,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3768,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3768,
      "entity_id": "bZbCe-pqfor5XE1IS0WG2",
      "visualization_settings": {},
      "size_y": 8,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 139
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "SHARE_TRANSACTION_FEE_MIN",
            "field_ref": [
              "field",
              "SHARE_TRANSACTION_FEE_MIN",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_TRANSACTION_FEE_MIN",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.000515676598625046,
                  "q1": 0.002617166674929085,
                  "q3": 0.018045470910677916,
                  "max": 0.8680709240117859,
                  "sd": 0.3214130094532728,
                  "avg": 0.16604876241573457
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Share transaction with fee min (by Amount EUR) - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "22dcabeb-5727-4a89-8a9f-bf847cd2e1e8",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "f4d1d8c5-9e6e-4e17-aa68-2074208bd807",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "0cb96944-4ad0-4e72-9af3-4b83c4541e1e",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "3296633b-3151-4c8a-be2f-320e356303d5",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "3abd299f-47cd-49a9-baa3-29b1de054472",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "7b4446ae-3a9e-4bd5-b21f-1c59b6376d78",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "27b9b37c-b50c-4160-96bc-022571a7b53a",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7ae73675-cd15-4813-97d7-a5578aca2713",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "f09dc47e-ceee-496f-ad53-490c849cf5b7",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "142e46e3-12df-4338-bb7b-afeeb69e163e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "cd0a6f1b-321d-43e4-a1c2-01cd4dacffe6",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "d7baa5c7-d96f-4dfa-ae6d-711e16123969",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "75051127-37af-4a38-95e3-8b5d353a0cda",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "d586fc57-399e-4990-a5ee-23bfe00ae2fa",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "07bd0721-efbb-4161-9ee2-fd896a911c94",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "75aa4769-dd7d-403d-8919-000cfb2c451e",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "940bce43-ad10-4ba7-835d-3580d48f7244",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "68062284-cfee-4e88-8229-33438bef672b",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "32c8e416-f982-416d-9ccc-4574401ccc40",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "141270c7-1146-46a6-a04e-07f151292af6",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "962167aa-508c-4082-a7a1-5005dcc4c70f",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "9f6359e5-5a2c-4e49-84cd-4a09a477bf84",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "5eeb0ae2-d99f-441e-90de-5b90847b2182",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.turnover_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and TRANSACTIONS.CONFIRMED and {{flag_is_recurring}} and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , round(TRANSACTIONS.fee_min,2) = round((TRANSACTIONS.FEE_TOTAL_FIAT - TRANSACTIONS.FEE_NETWORK_REVENUE_FIAT),2) AS is_fee_min\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.turnover_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and TRANSACTIONS.CONFIRMED and {{flag_is_recurring}} and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and \r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , sum( case when is_fee_min then turnover_EUR end)/sum(turnover_EUR) as share_transaction_fee_min\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3787,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "06d4uE4yPWqIxEAWFtH9H",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "graph.y_axis.title_text": "Percent transaction with fee min",
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ],
          "column_settings": {
            "[\"name\",\"SHARE_TRANSACTION_FEE_MIN\"]": {
              "number_style": "percent",
              "decimals": 1
            }
          },
          "graph.metrics": [
            "SHARE_TRANSACTION_FEE_MIN"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "22dcabeb-5727-4a89-8a9f-bf847cd2e1e8",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "f4d1d8c5-9e6e-4e17-aa68-2074208bd807",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "0cb96944-4ad0-4e72-9af3-4b83c4541e1e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "3296633b-3151-4c8a-be2f-320e356303d5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "3abd299f-47cd-49a9-baa3-29b1de054472",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "7b4446ae-3a9e-4bd5-b21f-1c59b6376d78",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "27b9b37c-b50c-4160-96bc-022571a7b53a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7ae73675-cd15-4813-97d7-a5578aca2713",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "f09dc47e-ceee-496f-ad53-490c849cf5b7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "142e46e3-12df-4338-bb7b-afeeb69e163e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "cd0a6f1b-321d-43e4-a1c2-01cd4dacffe6",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "d7baa5c7-d96f-4dfa-ae6d-711e16123969",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "75051127-37af-4a38-95e3-8b5d353a0cda",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "d586fc57-399e-4990-a5ee-23bfe00ae2fa",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "07bd0721-efbb-4161-9ee2-fd896a911c94",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "75aa4769-dd7d-403d-8919-000cfb2c451e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "940bce43-ad10-4ba7-835d-3580d48f7244",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "68062284-cfee-4e88-8229-33438bef672b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "32c8e416-f982-416d-9ccc-4574401ccc40",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "141270c7-1146-46a6-a04e-07f151292af6",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "962167aa-508c-4082-a7a1-5005dcc4c70f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "9f6359e5-5a2c-4e49-84cd-4a09a477bf84",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "5eeb0ae2-d99f-441e-90de-5b90847b2182",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2919,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3787,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3787,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3787,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3787,
      "entity_id": "6Kz-aieaVAZaLELrJ3j53",
      "visualization_settings": {},
      "size_y": 8,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 147
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "GROUP_FAILED_REASON",
            "field_ref": [
              "field",
              "GROUP_FAILED_REASON",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "GROUP_FAILED_REASON",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 19,
                "nil%": 0.0528169014084507
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 20.218309859154928
                }
              }
            }
          },
          {
            "display_name": "NUMBER_OF_FAILED_TRANSACTION",
            "field_ref": [
              "field",
              "NUMBER_OF_FAILED_TRANSACTION",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "NUMBER_OF_FAILED_TRANSACTION",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 387,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 1.0,
                  "q1": 74.30142374408395,
                  "q3": 672.9557372826292,
                  "max": 1542.0,
                  "sd": 424.4809574013527,
                  "avg": 413.27640845070425
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Group failed reason - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": 7401,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "4d8e5245-bb4c-42c0-bc8d-98ba9bd5eb03",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": false
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "3ea7dc37-4807-4dab-92bd-056901fdf56a",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "ef69f4c1-83d2-4b65-bbd7-cfba0a62cf29",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "de531471-9176-4e74-b575-da58b349bcc6",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "bb76b7eb-4826-4215-8290-55aee6cfbf4f",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "2159d088-b8b5-4141-b821-af0225b005d9",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "bd16c787-9729-4f17-b102-a8558fd0f43a",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "2556b187-174c-4813-8c7e-8bac2ed27b52",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "4763446e-dfd6-427e-8a5c-6923e124cd4e",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "b9048f77-9a97-46a1-a0ea-b2e8a0c2371d",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "bd7b2f5b-1b15-40a2-b3cf-499ccffc79cb",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "dde0608b-c079-4e68-aa6c-783097c0ffa9",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "a21ae56d-2591-4e01-9fa2-d576a442b541",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "55b17ea8-dae3-4ff5-950e-d85045aa6cd3",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "a4905252-3b32-446a-96c8-4ad3f78ea0b6",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "1774c172-f562-4699-806c-ea7124f77137",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "eccbaf63-b362-44a4-b21f-bff923b0dd65",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "547dd44d-8744-4091-9536-1d4cbb292964",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "285a30c7-5138-4eca-b86e-03bde68bf9df",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "57be060b-045a-4db4-a4c8-923d162f8e06",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "a43d5ac8-796a-42c0-a0fa-cd51319c7b77",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH \r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.GROUP_FAILED_REASON\r\n                      , TRANSACTIONS.id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and TRANSACTIONs.status_main in ('Error', 'Cancelled') and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , GROUP_FAILED_REASON\r\n     , count(distinct id) as Number_of_Failed_Transaction\r\nfrom main_query\r\ngroup by 1,2\r\norder by 3"
          }
        },
        "id": 3791,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "ZhgVJ6wKHzOSKeBTfiHcN",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.dimensions": [
            "DT",
            "GROUP_FAILED_REASON"
          ],
          "graph.show_values": true,
          "graph.metrics": [
            "NUMBER_OF_FAILED_TRANSACTION"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "4d8e5245-bb4c-42c0-bc8d-98ba9bd5eb03",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "required": false
          },
          {
            "id": "3ea7dc37-4807-4dab-92bd-056901fdf56a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "ef69f4c1-83d2-4b65-bbd7-cfba0a62cf29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "de531471-9176-4e74-b575-da58b349bcc6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "bb76b7eb-4826-4215-8290-55aee6cfbf4f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "2159d088-b8b5-4141-b821-af0225b005d9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "bd16c787-9729-4f17-b102-a8558fd0f43a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "2556b187-174c-4813-8c7e-8bac2ed27b52",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "4763446e-dfd6-427e-8a5c-6923e124cd4e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "b9048f77-9a97-46a1-a0ea-b2e8a0c2371d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "bd7b2f5b-1b15-40a2-b3cf-499ccffc79cb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "dde0608b-c079-4e68-aa6c-783097c0ffa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "a21ae56d-2591-4e01-9fa2-d576a442b541",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "55b17ea8-dae3-4ff5-950e-d85045aa6cd3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "a4905252-3b32-446a-96c8-4ad3f78ea0b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "1774c172-f562-4699-806c-ea7124f77137",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "eccbaf63-b362-44a4-b21f-bff923b0dd65",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "547dd44d-8744-4091-9536-1d4cbb292964",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "285a30c7-5138-4eca-b86e-03bde68bf9df",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "57be060b-045a-4db4-a4c8-923d162f8e06",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "a43d5ac8-796a-42c0-a0fa-cd51319c7b77",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2920,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3791,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3791,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3791,
      "entity_id": "9c6yIggkPrQgiVRlaZpTB",
      "visualization_settings": {},
      "size_y": 8,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 155
    },
    {
      "size_x": 20,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "COUNT_USERS",
            "field_ref": [
              "field",
              "COUNT_USERS",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "COUNT_USERS",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 6205.0,
                  "q1": 7611.0,
                  "q3": 9425.0,
                  "max": 11286.0,
                  "sd": 1216.4912630608771,
                  "avg": 8615.2
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Count users - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": 5416,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "76cc514b-1e22-47ec-82cd-d8b39be4b4c1",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "323e788c-b423-458d-ad4a-f449ac099599",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "a6151d52-e2c5-4647-b4bb-5d9f3d583dea",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "d6d28949-805a-48ed-a05a-12e35136a0e1",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "f6389a08-df47-4d1a-8e6e-f8b925359418",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "26c00f7a-7e3f-444d-8d81-a3213338c40a",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "63736afc-ef56-40ab-92cb-a7156e71cc81",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7c61a76b-35af-4c7b-a550-3c1b5a027d1a",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "c67e1008-bb8e-486e-8f12-845b717ab66d",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "ffafafe0-7083-49cf-81a1-0f272498ffe3",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "e4c7a3cb-a71a-49be-a2d7-a1e916e1ed4f",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "b8bf1b2d-739f-48c2-b048-8fd57f3607ec",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "df6fa722-9d01-480b-b95a-4b3bcdd0e8a2",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "d50ae258-3618-4d88-9046-37a6d6abe221",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "b620e1c1-96a1-4b2c-bdaf-0e44d04d91c1",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "5420d2d5-3b4e-4ed1-9ae1-f358aefabb9d",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "9494cf93-73a1-466e-b971-7cdc15609ef1",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "0623213b-1c80-4ac0-85ec-46912376d086",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "fa89f97b-92d9-4f74-bf91-eb652282745b",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "a555c8a5-7ce7-4050-835b-ae8881d100e0",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "confirmed": {
                "type": "dimension",
                "name": "confirmed",
                "id": "066f27d7-2ffb-4a08-8095-a4a09a1bd62d",
                "display-name": "Confirmed",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "4094ff2e-dd00-4453-acb0-d4dcbfa66cc0",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH \r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.user_id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n                \r\n      where SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{confirmed}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n     , count(distinct user_id) as Count_users\r\nfrom main_query\r\ngroup by 1\r\norder by 1"
          }
        },
        "id": 3789,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "6-l7eiHNS0FyZFe6x0y1t",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "graph.dimensions": [
            "DT"
          ],
          "graph.metrics": [
            "COUNT_USERS"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "76cc514b-1e22-47ec-82cd-d8b39be4b4c1",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "323e788c-b423-458d-ad4a-f449ac099599",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "a6151d52-e2c5-4647-b4bb-5d9f3d583dea",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "d6d28949-805a-48ed-a05a-12e35136a0e1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "f6389a08-df47-4d1a-8e6e-f8b925359418",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "26c00f7a-7e3f-444d-8d81-a3213338c40a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "63736afc-ef56-40ab-92cb-a7156e71cc81",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7c61a76b-35af-4c7b-a550-3c1b5a027d1a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "c67e1008-bb8e-486e-8f12-845b717ab66d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "ffafafe0-7083-49cf-81a1-0f272498ffe3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "e4c7a3cb-a71a-49be-a2d7-a1e916e1ed4f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "b8bf1b2d-739f-48c2-b048-8fd57f3607ec",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "df6fa722-9d01-480b-b95a-4b3bcdd0e8a2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "d50ae258-3618-4d88-9046-37a6d6abe221",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "b620e1c1-96a1-4b2c-bdaf-0e44d04d91c1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "5420d2d5-3b4e-4ed1-9ae1-f358aefabb9d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "9494cf93-73a1-466e-b971-7cdc15609ef1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "0623213b-1c80-4ac0-85ec-46912376d086",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "fa89f97b-92d9-4f74-bf91-eb652282745b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "a555c8a5-7ce7-4050-835b-ae8881d100e0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "066f27d7-2ffb-4a08-8095-a4a09a1bd62d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "confirmed"
              ]
            ],
            "name": "Confirmed",
            "slug": "confirmed"
          },
          {
            "id": "4094ff2e-dd00-4453-acb0-d4dcbfa66cc0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2921,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3789,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "confirmed"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3789,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3789,
      "entity_id": "S60DZ0ZIdw_MGDx1WnuXt",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 163
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.0
                }
              }
            }
          },
          {
            "display_name": "SHARE_NETWORK_FEE",
            "field_ref": [
              "field",
              "SHARE_NETWORK_FEE",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_NETWORK_FEE",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.00010346739747660101,
                  "q1": 0.00028947266421292266,
                  "q3": 0.000638184803424261,
                  "max": 0.0010082815772574705,
                  "sd": 0.00022315380052686628,
                  "avg": 0.0004892911003339318
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Share Network Fee to Turnover - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "e3a6afbe-49c5-4c63-8395-7180e076a63c",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "eda8b972-182d-4427-8540-5f30d1714d52",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4bb066b6-defb-4332-a3fc-fcf0d84209cc",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fe47630-552c-43d6-9cdb-a203d8730d93",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "4560dc99-31db-46f3-99b1-e52f082e6d16",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "98a00deb-dffe-4d86-ace2-cd67464235fe",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "88bd2671-2347-4846-bea8-2dddde1f5b0a",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "4e35d7a3-7688-4b3d-8c77-fca279e6fd66",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "8ef3f252-958e-49c3-bbf2-1abc259d9290",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "a942cd43-b27d-4b26-8890-a51a8a807b57",
                "display-name": "Transaction Columns Groupby",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/="
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "4c1f4f09-f3dd-44dc-b467-fc444817b947",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "927b2c82-37ca-49a3-b4e9-835d559ed24f",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "2eb8f080-6280-46eb-aee2-f167609232aa",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "4edcbe60-784b-4b0e-b3e0-bdc2b64af69a",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "6f2af204-d7cb-4181-a1f7-53e73efa900b",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "54c7d6e7-3925-4115-99f4-c011e51b83d4",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "e906e306-2be0-4f8a-a424-d2174b06ed81",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "423c76a8-de2a-493b-88f4-2a262b9c5220",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "17400717-eeb2-468f-b1ae-c3005150f8dd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "9f9c9914-dba1-4f75-8ca4-a9fbc2c9f98d",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "24d7b405-d9fb-41c1-bfec-2b12caee4530",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "090228e6-802f-4d35-bea1-a648b3bf3233",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "68e9a01e-5073-47ef-b3d5-95e009f5c584",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FEE_BLOCKCHAIN_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.CONFIRMED and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n                      , TRANSACTIONS.FEE_BLOCKCHAIN_EUR\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.CONFIRMED and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , case when sum(TURNOVER_EUR) != 0\r\n     then sum(FEE_BLOCKCHAIN_EUR)/sum(TURNOVER_EUR) end as share_network_fee\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3783,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "OaFWGv14QzwUCu9VTB6Hj",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ],
          "column_settings": {
            "[\"name\",\"SHARE_GMV\"]": {
              "number_style": "percent"
            },
            "[\"name\",\"SHARE_NETWORK_FEE\"]": {
              "number_style": "percent"
            }
          },
          "graph.metrics": [
            "SHARE_NETWORK_FEE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "e3a6afbe-49c5-4c63-8395-7180e076a63c",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "eda8b972-182d-4427-8540-5f30d1714d52",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4bb066b6-defb-4332-a3fc-fcf0d84209cc",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fe47630-552c-43d6-9cdb-a203d8730d93",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "4560dc99-31db-46f3-99b1-e52f082e6d16",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "98a00deb-dffe-4d86-ace2-cd67464235fe",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "88bd2671-2347-4846-bea8-2dddde1f5b0a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "4e35d7a3-7688-4b3d-8c77-fca279e6fd66",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "8ef3f252-958e-49c3-bbf2-1abc259d9290",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "a942cd43-b27d-4b26-8890-a51a8a807b57",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY"
          },
          {
            "id": "4c1f4f09-f3dd-44dc-b467-fc444817b947",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "927b2c82-37ca-49a3-b4e9-835d559ed24f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "2eb8f080-6280-46eb-aee2-f167609232aa",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "4edcbe60-784b-4b0e-b3e0-bdc2b64af69a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "6f2af204-d7cb-4181-a1f7-53e73efa900b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "54c7d6e7-3925-4115-99f4-c011e51b83d4",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "e906e306-2be0-4f8a-a424-d2174b06ed81",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "423c76a8-de2a-493b-88f4-2a262b9c5220",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "17400717-eeb2-468f-b1ae-c3005150f8dd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "9f9c9914-dba1-4f75-8ca4-a9fbc2c9f98d",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "24d7b405-d9fb-41c1-bfec-2b12caee4530",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "090228e6-802f-4d35-bea1-a648b3bf3233",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "68e9a01e-5073-47ef-b3d5-95e009f5c584",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2922,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3783,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3783,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3783,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3783,
      "entity_id": "p3cA-bLqwio45z88Rwu6H",
      "visualization_settings": {},
      "size_y": 7,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 132
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "SHARE_REVENUE",
            "field_ref": [
              "field",
              "SHARE_REVENUE",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "SHARE_REVENUE",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.007987221514954948,
                  "q1": 0.029722118813906913,
                  "q3": 0.04409635458671133,
                  "max": 0.07828188689749611,
                  "sd": 0.02016045397568572,
                  "avg": 0.03914334299863342
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Revenue Turnover share OOR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "6a275f17-5407-4bc2-a3d2-7d9e7fd7d397",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "4d074075-d98c-42a6-8946-4bce84ba3b27",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "ec9e6d3d-cda8-4567-95e2-055268fbcbb5",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "16a961bf-8110-40e7-9d2b-0c24543d5417",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "ed7a83d7-4a57-404e-b88e-cfb52f88c7b2",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "3469cfbd-7b79-4881-a128-88d7f0f2d113",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "be45538a-3a09-4166-ac53-b81261ce7c15",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "ad7697fa-8687-4bba-9206-fc8e1329890f",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "ff926e9a-e77a-47ff-b4dc-293f6a8ee348",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "c3e2f772-55a6-4d86-9c1b-f05427173cf8",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "ab52dded-fda7-4a81-8752-8a3d293f3fe0",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "4f808c0d-8f0a-456b-9f0c-05f4af58f768",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "8efdd68e-55b4-4416-a2f7-1cf47e128e2f",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "6cd272cd-00ac-498d-b80f-35a6dd49e6a0",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "d08c94fb-c029-46d1-84c2-38419b7e9957",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "66604d10-4050-4039-ace2-6e4a0c7a28e0",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "0ede47a5-d4fb-4022-9cb8-6da5d241f674",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "d7cfdf66-b4a4-4326-b4ab-75e3a7f17948",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "abd775f6-ef1b-4f2d-96cd-85dcb293d743",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "10fb569d-6b44-457f-b76b-7d9751073b47",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "5bbce824-dc25-4324-8f37-2df12c849845",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "6c09d4a8-3070-4566-9e80-20846f093262",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "14a23736-b6ec-4e41-b92f-02c22fbbb107",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.TURNOVER_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.CONFIRMED and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n                      , TRANSACTIONS.REVENUE_EUR\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.CONFIRMED and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , case when sum(TURNOVER_EUR) != 0\r\n     then sum(REVENUE_EUR)/sum(TURNOVER_EUR) end as share_Revenue\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3798,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "zeS-CYB3GfL2RXWaB-FkW",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "graph.y_axis.title_text": "Revenue to Turnover",
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ],
          "column_settings": {
            "[\"name\",\"SHARE_REVENUE\"]": {
              "number_style": "percent",
              "decimals": 1
            }
          },
          "graph.metrics": [
            "SHARE_REVENUE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "6a275f17-5407-4bc2-a3d2-7d9e7fd7d397",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "4d074075-d98c-42a6-8946-4bce84ba3b27",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "ec9e6d3d-cda8-4567-95e2-055268fbcbb5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "16a961bf-8110-40e7-9d2b-0c24543d5417",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "ed7a83d7-4a57-404e-b88e-cfb52f88c7b2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "3469cfbd-7b79-4881-a128-88d7f0f2d113",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "be45538a-3a09-4166-ac53-b81261ce7c15",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "ad7697fa-8687-4bba-9206-fc8e1329890f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "ff926e9a-e77a-47ff-b4dc-293f6a8ee348",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "c3e2f772-55a6-4d86-9c1b-f05427173cf8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "ab52dded-fda7-4a81-8752-8a3d293f3fe0",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "4f808c0d-8f0a-456b-9f0c-05f4af58f768",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "8efdd68e-55b4-4416-a2f7-1cf47e128e2f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "6cd272cd-00ac-498d-b80f-35a6dd49e6a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "d08c94fb-c029-46d1-84c2-38419b7e9957",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "66604d10-4050-4039-ace2-6e4a0c7a28e0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "0ede47a5-d4fb-4022-9cb8-6da5d241f674",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "d7cfdf66-b4a4-4326-b4ab-75e3a7f17948",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "abd775f6-ef1b-4f2d-96cd-85dcb293d743",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "10fb569d-6b44-457f-b76b-7d9751073b47",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "5bbce824-dc25-4324-8f37-2df12c849845",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "6c09d4a8-3070-4566-9e80-20846f093262",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "14a23736-b6ec-4e41-b92f-02c22fbbb107",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2923,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3798,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3798,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3798,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3798,
      "entity_id": "L5f6P2OSuyFu_lvq4QdoL",
      "visualization_settings": {},
      "size_y": 8,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 90
    },
    {
      "size_x": 4,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "COUNT_USERS",
            "field_ref": [
              "field",
              "COUNT_USERS",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "COUNT_USERS",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 1,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 123389.0,
                  "q1": 123389.0,
                  "q3": 123389.0,
                  "max": 123389.0,
                  "sd": null,
                  "avg": 123389.0
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Count users number - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": 3133,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "4a62390f-369c-4aa5-8217-fee4203904d1",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "0ff01e69-e666-44b1-a3cb-c0fabeaeecc1",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "26b735bc-092e-42f7-bb07-a7348fb5c3ce",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "1d777961-1e08-4c6d-bdf0-f6ae6c3696fd",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "dc005c55-43ea-42cc-91d0-71e89737de7c",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "8684453a-2f40-49d0-81ac-b28ef645c55c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "debcc168-a508-4c64-ade6-17e04216ec21",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "1d7dc8c9-550f-4438-a1d0-ec80ce409084",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "c1ac4abc-8cb7-491f-927c-ad6f417cfa23",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  755,
                  null
                ],
                "widget-type": "string/="
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "5a3d2779-94d9-4a7d-b3d0-23b116258450",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "4dd96c17-5863-438d-b299-ee9d1fb8bb54",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "f4a7688e-9103-4db5-8b60-e92d89508d33",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "88e1166c-ff37-4568-ae75-79aaec566e1b",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "7bec2ac1-29f3-4e72-a608-dfb1c4195d3f",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "ad37079f-a1f0-4c74-8be9-eb1e8d63eb53",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "df8e1ae6-a5a4-42b1-9e8d-8b0ee0440234",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "7969be52-7777-4114-88d3-67d56d78d88a",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "e31dd354-fbf0-4e83-ba14-b7b2551c702d",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "5d3e23e4-28d7-441a-9823-60d5bd99396b",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "confirmed": {
                "type": "dimension",
                "name": "confirmed",
                "id": "5a0f8035-92bc-4e7c-bd43-83fbfc26ef2b",
                "display-name": "Confirmed",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "a857eeb1-53cc-4624-8539-4bb4023686b8",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH \r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.user_id\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n                \r\n      where SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{confirmed}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect count(distinct user_id) as Count_users\r\nfrom main_query"
          }
        },
        "id": 3769,
        "parameter_mappings": [],
        "display": "scalar",
        "archived_directly": false,
        "entity_id": "kq8R9BQqZ_kIxr1A4TBhS",
        "collection_preview": true,
        "visualization_settings": {},
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "4a62390f-369c-4aa5-8217-fee4203904d1",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "0ff01e69-e666-44b1-a3cb-c0fabeaeecc1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "26b735bc-092e-42f7-bb07-a7348fb5c3ce",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "1d777961-1e08-4c6d-bdf0-f6ae6c3696fd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "dc005c55-43ea-42cc-91d0-71e89737de7c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "8684453a-2f40-49d0-81ac-b28ef645c55c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "debcc168-a508-4c64-ade6-17e04216ec21",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "1d7dc8c9-550f-4438-a1d0-ec80ce409084",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "c1ac4abc-8cb7-491f-927c-ad6f417cfa23",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "5a3d2779-94d9-4a7d-b3d0-23b116258450",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "4dd96c17-5863-438d-b299-ee9d1fb8bb54",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "f4a7688e-9103-4db5-8b60-e92d89508d33",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "88e1166c-ff37-4568-ae75-79aaec566e1b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "7bec2ac1-29f3-4e72-a608-dfb1c4195d3f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "ad37079f-a1f0-4c74-8be9-eb1e8d63eb53",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "df8e1ae6-a5a4-42b1-9e8d-8b0ee0440234",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "7969be52-7777-4114-88d3-67d56d78d88a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "e31dd354-fbf0-4e83-ba14-b7b2551c702d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "5d3e23e4-28d7-441a-9823-60d5bd99396b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "5a0f8035-92bc-4e7c-bd43-83fbfc26ef2b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "confirmed"
              ]
            ],
            "name": "Confirmed",
            "slug": "confirmed"
          },
          {
            "id": "a857eeb1-53cc-4624-8539-4bb4023686b8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 20,
      "id": 2924,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "confirmed"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3769,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3769,
      "entity_id": "VJiK4yjZ4mfK6R9ujP2XG",
      "visualization_settings": {},
      "size_y": 4,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 163
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 8.4
                }
              }
            }
          },
          {
            "display_name": "SLIPPAGE_DISCOUNT_EUR",
            "field_ref": [
              "field",
              "SLIPPAGE_DISCOUNT_EUR",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "SLIPPAGE_DISCOUNT_EUR",
            "semantic_type": "type/Discount",
            "fingerprint": {
              "global": {
                "distinct-count": 31,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.0,
                  "q1": 0.0,
                  "q3": 0.9340521166709072,
                  "max": 34.4278522312,
                  "sd": 8.392289156443619,
                  "avg": 3.598019001922628
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Slippage discount EUR - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "a4970644-64b7-40df-b731-4faf5d8e1a38",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "a7deec68-a2ef-44bd-85b8-98985af15ef2",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "c7cf43c6-593a-4155-a632-240b89c9f663",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "f9db590e-bd90-4149-a325-5be47415fc43",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "dba0d50b-20a9-4c7d-bd80-f484dcf78511",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "eb4acfb1-13dc-4666-8199-c3ee2ee4ca3b",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "65b3c761-080e-4c2f-bc8e-45cfadadd9ee",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "4cb82799-7231-41a6-8779-b1de95c60116",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "6b594205-da90-4e86-8210-35eedca06e10",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "ad561d23-cf95-4878-b090-62b7a3dd0c5a",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Partner Widget"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "e04e2a17-c26f-49a6-b03e-d1925ab94d61",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "1dd16a5a-4b28-445d-81c1-40a3e332aff7",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "00f78a0b-3432-4533-bb8e-b35a9a142a6e",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "e3f66d56-c5bb-4b4c-a8c1-89b97abc9ae5",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "07c717d4-1496-48a6-a8f8-73a10d3a9c37",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "d28e4b0a-fd4e-4444-964b-9fb415b883fa",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "a28415cc-225c-4bd1-b1f2-f1b3529de572",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "43e3814f-455f-4c0f-b9c0-dafc3d45d09c",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "3cc3fc5f-0450-4ac7-8b4b-8e411345c99f",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550050,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "e023fd12-e995-4c90-872b-8a92a04f5e53",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "12b49938-501c-4a21-97b8-149f2b18eff8",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "38323300-b717-4af3-8674-62be7c68f369",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "55740b4d-29e5-4e15-84fd-4924810599e7",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(zeroifnull(TRANSACTIONS.FEE_FX_EUR)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and TRANSACTIONS.confirmed and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.SLIPPAGE_DISCOUNT_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.confirmed and TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}}  and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , sum(SLIPPAGE_DISCOUNT_EUR) as SLIPPAGE_DISCOUNT_EUR\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1, 3 desc"
          }
        },
        "id": 3786,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "rOY2wiHr2DKNHK7B-X3c6",
        "collection_preview": true,
        "visualization_settings": {
          "stackable.stack_type": "stacked",
          "graph.show_values": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.label_value_formatting": "auto",
          "graph.label_value_frequency": "fit",
          "column_settings": {
            "[\"name\",\"FX_MARK_UP_REVENUE\"]": {
              "number_style": "currency",
              "decimals": 0
            },
            "[\"name\",\"SLIPPAGE_DISCOUNT_EUR\"]": {
              "prefix": "\u20ac "
            }
          },
          "graph.metrics": [
            "SLIPPAGE_DISCOUNT_EUR"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "a4970644-64b7-40df-b731-4faf5d8e1a38",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "a7deec68-a2ef-44bd-85b8-98985af15ef2",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "c7cf43c6-593a-4155-a632-240b89c9f663",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "f9db590e-bd90-4149-a325-5be47415fc43",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "dba0d50b-20a9-4c7d-bd80-f484dcf78511",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "eb4acfb1-13dc-4666-8199-c3ee2ee4ca3b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "65b3c761-080e-4c2f-bc8e-45cfadadd9ee",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "4cb82799-7231-41a6-8779-b1de95c60116",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "6b594205-da90-4e86-8210-35eedca06e10",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "ad561d23-cf95-4878-b090-62b7a3dd0c5a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "e04e2a17-c26f-49a6-b03e-d1925ab94d61",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "1dd16a5a-4b28-445d-81c1-40a3e332aff7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "00f78a0b-3432-4533-bb8e-b35a9a142a6e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "e3f66d56-c5bb-4b4c-a8c1-89b97abc9ae5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "07c717d4-1496-48a6-a8f8-73a10d3a9c37",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "d28e4b0a-fd4e-4444-964b-9fb415b883fa",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "a28415cc-225c-4bd1-b1f2-f1b3529de572",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "43e3814f-455f-4c0f-b9c0-dafc3d45d09c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "3cc3fc5f-0450-4ac7-8b4b-8e411345c99f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "e023fd12-e995-4c90-872b-8a92a04f5e53",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "12b49938-501c-4a21-97b8-149f2b18eff8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "38323300-b717-4af3-8674-62be7c68f369",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "55740b4d-29e5-4e15-84fd-4924810599e7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2925,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3786,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3786,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3786,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3786,
      "entity_id": "6V0uVRd8Xw6LbAQoaQqnb",
      "visualization_settings": {},
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 119
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 235,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 17,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-02-24T00:00:00Z",
                  "latest": "2025-06-16T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 10,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.096153846153847
                }
              }
            }
          },
          {
            "display_name": "AVG_BILL",
            "field_ref": [
              "field",
              "AVG_BILL",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "AVG_BILL",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 156,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 28.0,
                  "q1": 204.70998012412943,
                  "q3": 441.9055864285818,
                  "max": 4469.41,
                  "sd": 505.33890750256325,
                  "avg": 422.04626758953253
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Average bill OOR transaction - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": 1162,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
                "display-name": "Created At",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "83709647-089b-4390-b965-55393b391b75",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Accepted Transaction"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "82668fce-f949-4039-84c5-c4713fe48488",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "6e88aeb5-62ae-41de-bea8-b054f2b2cbdd",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "type": "dimension",
                "name": "transaction_accepted",
                "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
                "display-name": "Transaction Accepted",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "80057293-bae9-4787-9c9e-515eda94fa29",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FIAT_AMOUNT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_topN\r\n     , avg(TURNOVER_EUR) as avg_bill\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1,3 desc"
          }
        },
        "id": 3800,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "K4ymutx6L71Ys1kbR03MX",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "stackable.stack_type": null,
          "graph.y_axis.title_text": "Average bill",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"AVG_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "AVG_BILL"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "83709647-089b-4390-b965-55393b391b75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Accepted Transaction"
            ],
            "required": true
          },
          {
            "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "82668fce-f949-4039-84c5-c4713fe48488",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "6e88aeb5-62ae-41de-bea8-b054f2b2cbdd",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction Accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "80057293-bae9-4787-9c9e-515eda94fa29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2926,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3800,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3800,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3800,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3800,
      "entity_id": "FbOXftsRoN4Kd4Wd1mAYY",
      "visualization_settings": {},
      "size_y": 9,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 0
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 235,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 17,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-02-24T00:00:00Z",
                  "latest": "2025-06-16T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 10,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 9.096153846153847
                }
              }
            }
          },
          {
            "display_name": "MEDIAN_BILL",
            "field_ref": [
              "field",
              "MEDIAN_BILL",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "MEDIAN_BILL",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 155,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 28.0,
                  "q1": 90.85535417047888,
                  "q3": 249.5057148077294,
                  "max": 4469.41,
                  "sd": 547.7267428181326,
                  "avg": 285.1200772009202
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Median bill OOR transaction - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
                "display-name": "Created At",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "528206aa-e8af-4818-b0cb-0aa65eb77cce",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "6d20b73f-c227-4e85-a239-9848292810b8",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "58ae43e5-44d5-4f17-a55c-67c91634429e",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Accepted Transaction"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "2f60d2a7-658e-4a17-a3e2-a402f51ccd90",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "82668fce-f949-4039-84c5-c4713fe48488",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "207fb567-57dc-4210-a1bf-0a74fd827913",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "6e88aeb5-62ae-41de-bea8-b054f2b2cbdd",
                "display-name": "Granularity",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "type": "dimension",
                "name": "transaction_accepted",
                "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
                "display-name": "Transaction Accepted",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "3a9b5de5-d2e1-4706-840b-e5bb33773465",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by sum(TRANSACTIONS.FIAT_AMOUNT_EUR) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.TURNOVER_EUR\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_topN\r\n     , median(TURNOVER_EUR) as median_bill\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1,3 desc"
          }
        },
        "id": 3801,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "j2IDO1HUzQ3nvRmgTYBqc",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "stackable.stack_type": null,
          "graph.y_axis.title_text": "Median bill",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"AVG_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            },
            "[\"name\",\"MEDIAN_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "MEDIAN_BILL"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "528206aa-e8af-4818-b0cb-0aa65eb77cce",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "6d20b73f-c227-4e85-a239-9848292810b8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "58ae43e5-44d5-4f17-a55c-67c91634429e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Accepted Transaction"
            ],
            "required": true
          },
          {
            "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "2f60d2a7-658e-4a17-a3e2-a402f51ccd90",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "82668fce-f949-4039-84c5-c4713fe48488",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "207fb567-57dc-4210-a1bf-0a74fd827913",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "6e88aeb5-62ae-41de-bea8-b054f2b2cbdd",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction Accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "3a9b5de5-d2e1-4706-840b-e5bb33773465",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2927,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3801,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3801,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3801,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3801,
      "entity_id": "S8wlbjxaWSymxHK7Eyia2",
      "visualization_settings": {},
      "size_y": 9,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 9
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 12.6
                }
              }
            }
          },
          {
            "display_name": "AR",
            "field_ref": [
              "field",
              "AR",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "AR",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 150,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.4189189189189189,
                  "q1": 0.6987349757246687,
                  "q3": 0.7488163237351146,
                  "max": 0.9855358316896778,
                  "sd": 0.09619278009172488,
                  "avg": 0.753417890965378
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Acceptance Rate by user - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "4eb2c5f1-b806-07fb-3aec-f9101ec37a67",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "d87f4a74-62a7-4e66-ba59-adb9cac50904",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "d5af87aa-d6e6-f90d-11c8-1937a9dab3f5",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "0b8acc04-6265-3fdc-7961-7925344c5e7d",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "29bbf02b-3ca9-4e78-9335-4ae675cfd121",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "d55b734d-c44c-6db7-de41-4e4371bf161b",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "4d15371d-857a-4030-a0bf-86bd3f05a3e5",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "168894f1-361a-7cae-7fe6-968702ce79e8",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "0e651d69-c0c3-330a-befb-4bfdb433d6ac",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "418df98d-5846-1163-4f76-168c4605161d",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Parameter groupby",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ],
                "required": true
              },
              "top_n": {
                "id": "c3adc608-9013-34ae-30df-636b6e35d019",
                "name": "top_n",
                "display-name": "Top N",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "4e10c765-b9cb-0d26-839d-6938157df04d",
                "name": "partner_name",
                "display-name": "Partner Widget",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "crypto_currency": {
                "id": "2bacdd61-9975-6952-4906-e477ea61f89c",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "ddfff366-d62f-e41e-f919-61415d7faa3b",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "a80a96a3-0a42-4fa7-b762-1933c5d7421a",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "bc922bcd-1acb-908f-d450-b81f0f0c4be3",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "e1912842-1ee4-4185-9c09-768a74e2d7b0",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "none",
                "options": null
              },
              "pay_system": {
                "id": "de57843d-1619-c343-30c4-1aa613cf5187",
                "name": "pay_system",
                "display-name": "Pay system",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "5123e8cd-62dd-4b00-a675-5db7a402f20c",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "769d01d7-4afc-1e3f-8cb8-bfb7729eb325",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "type_operation": {
                "id": "85503309-a79d-9b5c-cf10-88ed79576487",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "antifraud_status": {
                "id": "b94beb93-1a82-981f-ff33-02792ed04767",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "933a91e7-2ff3-510e-b396-bf8302999d47",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "066a02a5-bfad-45b3-a749-f8c5d06d69a5",
                "display-name": "Retry Exclude",
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/="
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(*) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and\r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.user_id\r\n      from mart.TRANSACTIONS\r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\r\n      , top_n_parameter\r\n     , count(distinct case when is_confirmed then user_id end)/count(distinct user_id) as AR\r\nfrom main_query\r\ngroup by 1,2\r\norder by 1"
          }
        },
        "id": 3771,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "T17qpchK7uvcrMbHR1NyY",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "Acceptance Rate",
          "graph.show_values": true,
          "table.cell_column": "TR",
          "graph.x_axis.title_text": "Transaction Date",
          "graph.metrics": [
            "AR"
          ],
          "graph.label_value_formatting": "compact",
          "table.pivot_column": "TOP_N_PARAMETER",
          "column_settings": {
            "[\"name\",\"TR\"]": {
              "number_style": "percent"
            },
            "[\"name\",\"AR\"]": {
              "number_style": "percent"
            }
          },
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "4eb2c5f1-b806-07fb-3aec-f9101ec37a67",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days"
          },
          {
            "id": "d87f4a74-62a7-4e66-ba59-adb9cac50904",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "d5af87aa-d6e6-f90d-11c8-1937a9dab3f5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "0b8acc04-6265-3fdc-7961-7925344c5e7d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "29bbf02b-3ca9-4e78-9335-4ae675cfd121",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "d55b734d-c44c-6db7-de41-4e4371bf161b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "4d15371d-857a-4030-a0bf-86bd3f05a3e5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "168894f1-361a-7cae-7fe6-968702ce79e8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "0e651d69-c0c3-330a-befb-4bfdb433d6ac",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "418df98d-5846-1163-4f76-168c4605161d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Parameter groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "c3adc608-9013-34ae-30df-636b6e35d019",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "4e10c765-b9cb-0d26-839d-6938157df04d",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Widget",
            "slug": "partner_name"
          },
          {
            "id": "2bacdd61-9975-6952-4906-e477ea61f89c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "ddfff366-d62f-e41e-f919-61415d7faa3b",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "a80a96a3-0a42-4fa7-b762-1933c5d7421a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "bc922bcd-1acb-908f-d450-b81f0f0c4be3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "de57843d-1619-c343-30c4-1aa613cf5187",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system",
            "slug": "pay_system"
          },
          {
            "id": "5123e8cd-62dd-4b00-a675-5db7a402f20c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "769d01d7-4afc-1e3f-8cb8-bfb7729eb325",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "85503309-a79d-9b5c-cf10-88ed79576487",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "b94beb93-1a82-981f-ff33-02792ed04767",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "933a91e7-2ff3-510e-b396-bf8302999d47",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "066a02a5-bfad-45b3-a749-f8c5d06d69a5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2928,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3771,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3771,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3771,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3771,
      "entity_id": "ubmMfvNz63gE_MFz8QsUy",
      "visualization_settings": {},
      "size_y": 9,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 176
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 236,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 17,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-02-24T00:00:00Z",
                  "latest": "2025-06-16T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "END_TO_END_SUCCESS_RATE",
            "field_ref": [
              "field",
              "END_TO_END_SUCCESS_RATE",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "END_TO_END_SUCCESS_RATE",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 17,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.13722198369502342,
                  "q1": 0.1640967576321425,
                  "q3": 0.193865819198702,
                  "max": 0.2005856462114874,
                  "sd": 0.01888721986923733,
                  "avg": 0.17959093365551942
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "End-to-end Success Rate - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "b27b0290-21b2-499c-81a8-b5e8a836985b",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  1700,
                  null
                ],
                "widget-type": "date/month-year"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "7ab25607-fa61-46fa-a21f-73156cd856a0",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  587330,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "46fe437b-50c8-4b85-b433-803d2fd6f111",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  1692,
                  null
                ],
                "widget-type": "string/="
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6f454077-3168-4bc8-a9d5-d29ff1ed3345",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  1699,
                  null
                ],
                "widget-type": "string/contains",
                "options": {
                  "case-sensitive": false
                }
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "16bce3e9-90f4-445c-b776-c1172650f7e3",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  1703,
                  null
                ],
                "widget-type": "string/="
              },
              "granularity": {
                "type": "text",
                "name": "granularity",
                "id": "3b841987-a368-4852-8050-a1278a8e2fe1",
                "display-name": "Granularity",
                "default": "day"
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "7accc1be-d711-4446-9af9-1d8d0c74a950",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  587331,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "b94eaab4-77bb-4edd-8a0c-96c53e6359e5",
                "display-name": "Is Amount Based Selective",
                "dimension": [
                  "field",
                  587329,
                  null
                ],
                "widget-type": "string/="
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "aeda34af-bc58-42e2-9b4a-18f0e3e684f9",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  1686,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "f4ba5d09-b1c9-4dcd-85fb-73beb2ea9962",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  1694,
                  null
                ],
                "widget-type": "string/="
              }
            },
            "query": "select date_trunc({{granularity}}, CREATED_AT) as dt\n, count(case when T_CONFIRMED then 1 end)/count(1) AS End_to_end_Success_Rate\nfrom MART.CALCULATIONS_UNIQ\nwhere {{type_operation}} and {{partner_name}} and {{crypto_currency}} and {{fiat_currency}} and \n          {{pay_system}} and {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and\n          {{is_amount_based_selective}} and {{CREATED_AT}}\ngroup by 1"
          }
        },
        "id": 3792,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "JOuu1AHSSqUaV7-0E-tZv",
        "collection_preview": true,
        "visualization_settings": {
          "series_settings": {
            "END_TO_END_SUCCESS_RATE": {
              "title": "End-to-end Success Rate"
            }
          },
          "graph.show_values": true,
          "graph.dimensions": [
            "DT"
          ],
          "column_settings": {
            "[\"name\",\"END_TO_END_SUCCESS_RATE\"]": {
              "number_style": "percent",
              "decimals": 1
            }
          },
          "graph.metrics": [
            "END_TO_END_SUCCESS_RATE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "b27b0290-21b2-499c-81a8-b5e8a836985b",
            "type": "date/month-year",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "7ab25607-fa61-46fa-a21f-73156cd856a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "46fe437b-50c8-4b85-b433-803d2fd6f111",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "6f454077-3168-4bc8-a9d5-d29ff1ed3345",
            "type": "string/contains",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name",
            "options": {
              "case-sensitive": false
            }
          },
          {
            "id": "16bce3e9-90f4-445c-b776-c1172650f7e3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "3b841987-a368-4852-8050-a1278a8e2fe1",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "granularity"
              ]
            ],
            "name": "Granularity",
            "slug": "granularity",
            "default": "day"
          },
          {
            "id": "7accc1be-d711-4446-9af9-1d8d0c74a950",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "b94eaab4-77bb-4edd-8a0c-96c53e6359e5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "aeda34af-bc58-42e2-9b4a-18f0e3e684f9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "f4ba5d09-b1c9-4dcd-85fb-73beb2ea9962",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2929,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3792,
          "target": [
            "variable",
            [
              "template-tag",
              "granularity"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "a73cf623",
          "card_id": 3792,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3792,
      "entity_id": "j1dHI7qi55fbrStvZhjFb",
      "visualization_settings": {},
      "size_y": 10,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 0
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 236,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "CREATED_AT",
            "field_ref": [
              "field",
              "CREATED_AT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "CREATED_AT",
            "semantic_type": "type/CreationTimestamp",
            "fingerprint": {
              "global": {
                "distinct-count": 17,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-02-24T00:00:00Z",
                  "latest": "2025-06-16T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "TOP_N_PARAMETER",
            "field_ref": [
              "field",
              "TOP_N_PARAMETER",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "TOP_N_PARAMETER",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 10,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 8.582822085889571
                }
              }
            }
          },
          {
            "display_name": "END_TO_END_SUCCESS_RATE",
            "field_ref": [
              "field",
              "END_TO_END_SUCCESS_RATE",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "END_TO_END_SUCCESS_RATE",
            "semantic_type": "type/Share",
            "fingerprint": {
              "global": {
                "distinct-count": 162,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 0.0,
                  "q1": 0.1627641824127993,
                  "q3": 0.24585780591726022,
                  "max": 0.35644778804481153,
                  "sd": 0.0917159532923723,
                  "avg": 0.18885556554173247
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "End-to-end Success Rate by parameter - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "b27b0290-21b2-499c-81a8-b5e8a836985b",
                "display-name": "Created At",
                "dimension": [
                  "field",
                  1700,
                  null
                ],
                "widget-type": "date/month-year"
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "7ab25607-fa61-46fa-a21f-73156cd856a0",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  587330,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "46fe437b-50c8-4b85-b433-803d2fd6f111",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  1692,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "666c1ef7-f70a-47ad-9bce-84073c13524c",
                "display-name": "Transaction Columns Groupby",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true,
                "default": [
                  "Partner Widget"
                ]
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "8d79892e-02bb-4950-ae0e-a09e7d12dc7e",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6f454077-3168-4bc8-a9d5-d29ff1ed3345",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  1699,
                  null
                ],
                "widget-type": "string/contains",
                "options": {
                  "case-sensitive": false
                }
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "16bce3e9-90f4-445c-b776-c1172650f7e3",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  1703,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "7accc1be-d711-4446-9af9-1d8d0c74a950",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  587331,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "b94eaab4-77bb-4edd-8a0c-96c53e6359e5",
                "display-name": "Is Amount Based Selective",
                "dimension": [
                  "field",
                  587329,
                  null
                ],
                "widget-type": "string/="
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "aeda34af-bc58-42e2-9b4a-18f0e3e684f9",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  1686,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "e03b5060-7230-4288-ae96-03d12910a7d3",
                "display-name": "Granularity",
                "default": "day",
                "required": true
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "f4ba5d09-b1c9-4dcd-85fb-73beb2ea9962",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  1694,
                  null
                ],
                "widget-type": "string/="
              }
            },
            "query": "WITH group_by_parameter as (\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\n    ),\n     pre_top_n as (\n    select CASE \n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\n            THEN CALCULATIONS_UNIQ.PARTNER_NAME\n        WHEN group_by_parameter.parameter_group = 'Type operation'\n            THEN CALCULATIONS_UNIQ.TYPE\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\n            THEN CALCULATIONS_UNIQ.currency\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\n            THEN CALCULATIONS_UNIQ.fiat_currency\n        WHEN group_by_parameter.parameter_group = 'Country card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Brand card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Pay System'\n            THEN CALCULATIONS_UNIQ.PAYMENT_TYPE\n        WHEN group_by_parameter.parameter_group = 'Country IP'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Network'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Auth type'\n            THEN 'No data'\n            END AS GROUP_BY\n         , row_number() over (order by count(*) desc) as rn\n    from MART.CALCULATIONS_UNIQ\n    left join group_by_parameter on 1=1\n    where {{type_operation}} and {{partner_name}} and {{crypto_currency}} and {{fiat_currency}} and \n          {{pay_system}} and {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and\n          {{is_amount_based_selective}} and {{CREATED_AT}}\n    group by 1\n    order by 2 desc),\n     top_n as (\n         select GROUP_BY\n                , CASE WHEN rn < {{top_n}}\n                    THEN GROUP_BY\n                    ELSE 'others' END AS top_n_parameter\n         from pre_top_n\n     ),\n  main_query as (select CREATED_AT \n                      , T_CONFIRMED \n                      , top_n.top_n_parameter\n                      , id\n      from mart.CALCULATIONS_UNIQ\n      left join group_by_parameter on 1=1\n          left join top_n on top_n.GROUP_BY = CASE \n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\n            THEN CALCULATIONS_UNIQ.PARTNER_NAME\n        WHEN group_by_parameter.parameter_group = 'Type operation'\n            THEN CALCULATIONS_UNIQ.TYPE\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\n            THEN CALCULATIONS_UNIQ.currency\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\n            THEN CALCULATIONS_UNIQ.fiat_currency\n        WHEN group_by_parameter.parameter_group = 'Country card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Brand card'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Pay System'\n            THEN CALCULATIONS_UNIQ.PAYMENT_TYPE\n        WHEN group_by_parameter.parameter_group = 'Country IP'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Network'\n            THEN 'No data'\n        WHEN group_by_parameter.parameter_group = 'Auth type'\n            THEN 'No data'\n            END\nwhere {{type_operation}} and {{partner_name}} and {{crypto_currency}} and {{fiat_currency}} and \n          {{pay_system}} and {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and\n          {{is_amount_based_selective}} and {{CREATED_AT}}\n      ) \nselect date_trunc({{GRANULARITY}},CREATED_AT) as CREATED_AT\n      , top_n_parameter\n      , count(case when T_CONFIRMED then 1 end)/count(1) AS End_to_end_Success_Rate\nfrom main_query\ngroup by 1,2\norder by 1\n"
          }
        },
        "id": 3773,
        "parameter_mappings": [],
        "display": "line",
        "archived_directly": false,
        "entity_id": "6AkX1epBJ2fAxENShFGfg",
        "collection_preview": true,
        "visualization_settings": {
          "series_settings": {
            "END_TO_END_SUCCESS_RATE": {
              "title": "End-to-end Success Rate"
            }
          },
          "graph.show_values": true,
          "graph.dimensions": [
            "CREATED_AT",
            "TOP_N_PARAMETER"
          ],
          "column_settings": {
            "[\"name\",\"END_TO_END_SUCCESS_RATE\"]": {
              "number_style": "percent",
              "decimals": 1
            }
          },
          "graph.metrics": [
            "END_TO_END_SUCCESS_RATE"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "b27b0290-21b2-499c-81a8-b5e8a836985b",
            "type": "date/month-year",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT"
          },
          {
            "id": "7ab25607-fa61-46fa-a21f-73156cd856a0",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "46fe437b-50c8-4b85-b433-803d2fd6f111",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "666c1ef7-f70a-47ad-9bce-84073c13524c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ],
            "required": true
          },
          {
            "id": "8d79892e-02bb-4950-ae0e-a09e7d12dc7e",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6f454077-3168-4bc8-a9d5-d29ff1ed3345",
            "type": "string/contains",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name",
            "options": {
              "case-sensitive": false
            }
          },
          {
            "id": "16bce3e9-90f4-445c-b776-c1172650f7e3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "7accc1be-d711-4446-9af9-1d8d0c74a950",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "b94eaab4-77bb-4edd-8a0c-96c53e6359e5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "aeda34af-bc58-42e2-9b4a-18f0e3e684f9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "e03b5060-7230-4288-ae96-03d12910a7d3",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "f4ba5d09-b1c9-4dcd-85fb-73beb2ea9962",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2930,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "a73cf623",
          "card_id": 3773,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3773,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3773,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        }
      ],
      "card_id": 3773,
      "entity_id": "jBYgCWs1nQRnt6PZbAeVT",
      "visualization_settings": {},
      "size_y": 9,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 10
    },
    {
      "size_x": 20,
      "dashboard_tab_id": 234,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 1,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 30,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-05-19T00:00:00Z",
                  "latest": "2025-06-17T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 5,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 10.8
                }
              }
            }
          },
          {
            "display_name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "field_ref": [
              "field",
              "NUMBER_OF_ACCEPANCE_TRANSACTION",
              {
                "base-type": "type/Decimal"
              }
            ],
            "base_type": "type/Decimal",
            "effective_type": "type/Decimal",
            "name": "NUMBER_OF_ACCEPANCE_TRANSACTION",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 142,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 432.0,
                  "q1": 824.5555555555555,
                  "q3": 2242.3671353941736,
                  "max": 5648.0,
                  "sd": 1160.9419838677495,
                  "avg": 1727.56
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Users per group - Duplicate",
        "last_used_at": "2025-06-18T14:48:27.587866Z",
        "type": "question",
        "query_average_duration": 3952,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "id": "cf6f9ae2-2e55-3a7d-2eb5-02157208c4ab",
                "name": "CREATED_AT",
                "display-name": "Transaction Date",
                "type": "dimension",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "default": "past30days",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "5b83f2ab-e834-470a-ad5e-a895204e9017",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "id": "32f584ef-7ecb-8ee6-5bfd-54a52ec824f8",
                "name": "fiat_currency",
                "display-name": "Fiat currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "brand_card": {
                "id": "3f4151ea-ce24-8f5c-904d-870aa87ea6e3",
                "name": "brand_card",
                "display-name": "Brand card",
                "type": "dimension",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "608b0faa-b0ec-4819-a6cb-f6267c293669",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "id": "b0763666-8e21-7a52-0345-de9801434cf3",
                "name": "vendor_name",
                "display-name": "Acquirer",
                "type": "dimension",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "084925f7-4570-4eb4-ab09-40f24649a26c",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "id": "16b53fbb-cc24-cad2-651f-ef15504052f9",
                "name": "LOCATION_GEO",
                "display-name": "Geoscheme IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "country_card": {
                "id": "652f0d81-e8e1-3340-949d-667d0bc69768",
                "name": "country_card",
                "display-name": "Country card",
                "type": "dimension",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "id": "ed37e598-8dd7-441f-3af1-835de42f25c7",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "display-name": "Parameter for group (single value)",
                "type": "dimension",
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "Partner Widget"
                ]
              },
              "top_n": {
                "id": "4777dbf1-fce9-8e76-1319-eb04d74b2adf",
                "name": "top_n",
                "display-name": "Top n",
                "type": "number",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "id": "50e855b6-0f37-411b-2bcd-363c7ef0d333",
                "name": "partner_name",
                "display-name": "Partner name",
                "type": "dimension",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "crypto_currency": {
                "id": "e3d8fde0-bd85-cd39-5058-ceff552d80a3",
                "name": "crypto_currency",
                "display-name": "Crypto currency",
                "type": "dimension",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "network": {
                "id": "7e22ec38-d5e7-b528-a0f4-915fa1ebcee1",
                "name": "network",
                "display-name": "Network",
                "type": "dimension",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "ba7b1767-d94f-4548-bdf1-7a24393a018e",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "id": "f737153b-179d-59ef-7fdc-2d8f4d6c4ddb",
                "name": "CARD_GEOSCHEME",
                "display-name": "Card geoscheme",
                "type": "dimension",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "dfbd8786-e565-4cea-a4b5-91a8f7a08b17",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "id": "ce638e37-710e-1c71-4a96-77f144f3d9d5",
                "name": "pay_system",
                "display-name": "Pay system (mobile_pay)",
                "type": "dimension",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "9bc29c8b-9864-4b0b-943e-a716ba1ce0e9",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "id": "6e0ea944-5bae-d87b-1dc9-aabc535e01af",
                "name": "GRANULARITY",
                "display-name": "Granularity",
                "type": "text",
                "required": true,
                "default": "day"
              },
              "transaction_accepted": {
                "id": "a3f9982e-6d22-dd79-126f-515ea0775336",
                "name": "transaction_accepted",
                "display-name": "Transaction accepted",
                "type": "dimension",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/=",
                "required": false
              },
              "type_operation": {
                "id": "8656a0ce-8b7a-c056-f495-6e35be0f9225",
                "name": "type_operation",
                "display-name": "Type operation",
                "type": "dimension",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/=",
                "default": [
                  "buy",
                  "buy_acquirer",
                  "mobile_pay",
                  "sell"
                ],
                "required": true
              },
              "antifraud_status": {
                "id": "3ab52220-8c63-d2fe-f050-067d5f498a46",
                "name": "antifraud_status",
                "display-name": "Antifraud status",
                "type": "dimension",
                "dimension": [
                  "field",
                  536409,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "id": "87bafbfd-6331-fa08-e251-03980daf4505",
                "name": "LOCATION_COUNTRY",
                "display-name": "Country IP",
                "type": "dimension",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/=",
                "default": null
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "f1885f9f-6e70-4fa8-b0a6-4653b8600823",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(distinct(user_id)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select TRANSACTIONS.CREATED_AT \r\n                      , TRANSACTIONS.WIDGET_PARTNER_NAME\r\n                      , TRANSACTIONS.TYPE as type_operation\r\n                      , TRANSACTIONS.CONFIRMED as is_confirmed\r\n                      , top_n.top_n_parameter\r\n                      , TRANSACTIONS.id\r\n                      , TRANSACTIONS.USER_ID\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{antifraud_status}} and {{flag_is_recurring}}  and \r\n          {{is_user_based_selective}} and {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and\r\n          {{is_amount_based_selective}}  and {{is_aft}} \r\n      ) \r\nselect date_trunc({{GRANULARITY}},CREATED_AT) as DT\r\n      , top_n_parameter AS Parameter_TopN\r\n     , count(distinct(user_id)) as Number_of_Accepance_Transaction\r\nfrom main_query\r\ngroup by 1,2\r\norder by 3"
          }
        },
        "id": 3779,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "QZJwz-m_Q-FWq6xPDknv1",
        "collection_preview": true,
        "visualization_settings": {
          "graph.y_axis.title_text": "Number of users per group",
          "graph.show_values": true,
          "graph.x_axis.title_text": "DT",
          "graph.y_axis.scale": "linear",
          "graph.y_axis.auto_split": true,
          "graph.metrics": [
            "NUMBER_OF_ACCEPANCE_TRANSACTION"
          ],
          "graph.y_axis.auto_range": true,
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "stackable.stack_type": "stacked"
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "cf6f9ae2-2e55-3a7d-2eb5-02157208c4ab",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Transaction Date",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "5b83f2ab-e834-470a-ad5e-a895204e9017",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "32f584ef-7ecb-8ee6-5bfd-54a52ec824f8",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat currency",
            "slug": "fiat_currency"
          },
          {
            "id": "3f4151ea-ce24-8f5c-904d-870aa87ea6e3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand card",
            "slug": "brand_card"
          },
          {
            "id": "608b0faa-b0ec-4819-a6cb-f6267c293669",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "b0763666-8e21-7a52-0345-de9801434cf3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Acquirer",
            "slug": "vendor_name"
          },
          {
            "id": "084925f7-4570-4eb4-ab09-40f24649a26c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "16b53fbb-cc24-cad2-651f-ef15504052f9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Geoscheme IP",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "652f0d81-e8e1-3340-949d-667d0bc69768",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country card",
            "slug": "country_card"
          },
          {
            "id": "ed37e598-8dd7-441f-3af1-835de42f25c7",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Parameter for group (single value)",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Partner Widget"
            ]
          },
          {
            "id": "4777dbf1-fce9-8e76-1319-eb04d74b2adf",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top n",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "50e855b6-0f37-411b-2bcd-363c7ef0d333",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner name",
            "slug": "partner_name",
            "required": false
          },
          {
            "id": "e3d8fde0-bd85-cd39-5058-ceff552d80a3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto currency",
            "slug": "crypto_currency"
          },
          {
            "id": "7e22ec38-d5e7-b528-a0f4-915fa1ebcee1",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "ba7b1767-d94f-4548-bdf1-7a24393a018e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "f737153b-179d-59ef-7fdc-2d8f4d6c4ddb",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "dfbd8786-e565-4cea-a4b5-91a8f7a08b17",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "ce638e37-710e-1c71-4a96-77f144f3d9d5",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay system (mobile_pay)",
            "slug": "pay_system",
            "required": false
          },
          {
            "id": "9bc29c8b-9864-4b0b-943e-a716ba1ce0e9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "6e0ea944-5bae-d87b-1dc9-aabc535e01af",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY",
            "default": "day",
            "required": true
          },
          {
            "id": "a3f9982e-6d22-dd79-126f-515ea0775336",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction accepted",
            "slug": "transaction_accepted",
            "required": false
          },
          {
            "id": "8656a0ce-8b7a-c056-f495-6e35be0f9225",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type operation",
            "slug": "type_operation",
            "default": [
              "buy",
              "buy_acquirer",
              "mobile_pay",
              "sell"
            ],
            "required": true
          },
          {
            "id": "3ab52220-8c63-d2fe-f050-067d5f498a46",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "antifraud_status"
              ]
            ],
            "name": "Antifraud status",
            "slug": "antifraud_status"
          },
          {
            "id": "87bafbfd-6331-fa08-e251-03980daf4505",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Country IP",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "f1885f9f-6e70-4fa8-b0a6-4653b8600823",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2931,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3779,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3779,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3779,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3779,
      "entity_id": "Lah4k9EvagQVFRyswtbAk",
      "visualization_settings": {},
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 170
    },
    {
      "size_x": 24,
      "dashboard_tab_id": 237,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 3,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-03-01T00:00:00Z",
                  "latest": "2025-05-01T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 2,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 4.5
                }
              }
            }
          },
          {
            "display_name": "Median transactions per user",
            "field_ref": [
              "field",
              "Median transactions per user",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "Median transactions per user",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 1,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 1.0,
                  "q1": 1.0,
                  "q3": 1.0,
                  "max": 1.0,
                  "sd": 0.0,
                  "avg": 1.0
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Median transactions per user - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": 585,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
                "display-name": "Created At",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "83709647-089b-4390-b965-55393b391b75",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Accepted Transaction"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "82668fce-f949-4039-84c5-c4713fe48488",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
                "display-name": "Granularity"
              },
              "transaction_accepted": {
                "type": "dimension",
                "name": "transaction_accepted",
                "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
                "display-name": "Transaction Accepted",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "80057293-bae9-4787-9c9e-515eda94fa29",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(distinct(user_id)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select \r\n                        TRANSACTIONS.user_id\r\n                      , date_trunc({{GRANULARITY}},CREATED_AT) as DT \r\n                      , top_n.top_n_parameter\r\n                      , count(id) as txs \r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      group by 1, 2, 3\r\n      ) \r\nselect DT\r\n      , top_n_parameter AS Parameter_topN\r\n      , median(txs) as 'Median transactions per user'\r\nfrom main_query\r\ngroup by dt, top_n_parameter"
          }
        },
        "id": 3776,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "PHqotFFoQIzLDegKMSAD-",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "stackable.stack_type": null,
          "graph.y_axis.title_text": "Median number of transactions per user",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"AVG_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "Median transactions per user"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "83709647-089b-4390-b965-55393b391b75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Accepted Transaction"
            ],
            "required": true
          },
          {
            "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "82668fce-f949-4039-84c5-c4713fe48488",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY"
          },
          {
            "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction Accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "80057293-bae9-4787-9c9e-515eda94fa29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2932,
      "parameter_mappings": [
        {
          "parameter_id": "4af33822",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3776,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3776,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "27656f4c",
          "card_id": 3776,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3776,
      "entity_id": "dIU3S_nmfr-gSlHX0Z0N8",
      "visualization_settings": {},
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 6
    },
    {
      "size_x": 12,
      "dashboard_tab_id": 237,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 3,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-03-01T00:00:00Z",
                  "latest": "2025-05-01T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 2,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 4.5
                }
              }
            }
          },
          {
            "display_name": "Median revenue per user",
            "field_ref": [
              "field",
              "Median revenue per user",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "Median revenue per user",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 3.3216757852540195,
                  "q1": 3.38,
                  "q3": 3.43,
                  "max": 3.766717515867283,
                  "sd": 0.15863174259482768,
                  "avg": 3.45212564280355
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Median revenue per user - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": null,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
                "display-name": "Created At",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "83709647-089b-4390-b965-55393b391b75",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Accepted Transaction"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "82668fce-f949-4039-84c5-c4713fe48488",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
                "display-name": "Granularity"
              },
              "transaction_accepted": {
                "type": "dimension",
                "name": "transaction_accepted",
                "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
                "display-name": "Transaction Accepted",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "80057293-bae9-4787-9c9e-515eda94fa29",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(distinct(user_id)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select \r\n                        TRANSACTIONS.user_id\r\n                      , date_trunc({{GRANULARITY}},CREATED_AT) as DT \r\n                      , top_n.top_n_parameter\r\n                      , sum(REVENUE_EUR) as rvn\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      group by 1, 2, 3\r\n      ) \r\nselect DT\r\n      , top_n_parameter AS Parameter_topN\r\n      , median(rvn) as 'Median revenue per user'\r\nfrom main_query\r\ngroup by dt, top_n_parameter"
          }
        },
        "id": 3772,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "NOcIGT-PEj8oRMTNKNl0Q",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "stackable.stack_type": null,
          "graph.y_axis.title_text": "Median revenue",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "graph.y_axis.labels_enabled": true,
          "column_settings": {
            "[\"name\",\"AVG_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "Median revenue per user"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "83709647-089b-4390-b965-55393b391b75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Accepted Transaction"
            ],
            "required": true
          },
          {
            "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "82668fce-f949-4039-84c5-c4713fe48488",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY"
          },
          {
            "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction Accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "80057293-bae9-4787-9c9e-515eda94fa29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 0,
      "id": 2933,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3772,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3772,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3772,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3772,
      "entity_id": "oVw2B4JT-4HuoBodtgOnN",
      "visualization_settings": {},
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 0
    },
    {
      "size_x": 12,
      "dashboard_tab_id": 237,
      "series": [],
      "action_id": null,
      "collection_authority_level": null,
      "card": {
        "cache_invalidated_at": null,
        "description": null,
        "archived": false,
        "view_count": 0,
        "collection_position": null,
        "source_card_id": null,
        "table_id": null,
        "result_metadata": [
          {
            "display_name": "DT",
            "field_ref": [
              "field",
              "DT",
              {
                "base-type": "type/DateTime"
              }
            ],
            "base_type": "type/DateTime",
            "effective_type": "type/DateTime",
            "name": "DT",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 3,
                "nil%": 0.0
              },
              "type": {
                "type/DateTime": {
                  "earliest": "2025-03-01T00:00:00Z",
                  "latest": "2025-05-01T00:00:00Z"
                }
              }
            }
          },
          {
            "display_name": "PARAMETER_TOPN",
            "field_ref": [
              "field",
              "PARAMETER_TOPN",
              {
                "base-type": "type/Text"
              }
            ],
            "base_type": "type/Text",
            "effective_type": "type/Text",
            "name": "PARAMETER_TOPN",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 2,
                "nil%": 0.0
              },
              "type": {
                "type/Text": {
                  "percent-json": 0.0,
                  "percent-url": 0.0,
                  "percent-email": 0.0,
                  "percent-state": 0.0,
                  "average-length": 4.5
                }
              }
            }
          },
          {
            "display_name": "Median GMV per user",
            "field_ref": [
              "field",
              "Median GMV per user",
              {
                "base-type": "type/Float"
              }
            ],
            "base_type": "type/Float",
            "effective_type": "type/Float",
            "name": "Median GMV per user",
            "semantic_type": null,
            "fingerprint": {
              "global": {
                "distinct-count": 6,
                "nil%": 0.0
              },
              "type": {
                "type/Number": {
                  "min": 1.1645033242878706,
                  "q1": 1.2705795656499983,
                  "q3": 2.1224162490352465,
                  "max": 2.3367877373792187,
                  "sd": 0.507421640121799,
                  "avg": 1.6822123543357215
                }
              }
            }
          }
        ],
        "initially_published_at": null,
        "can_write": true,
        "database_id": 2,
        "enable_embedding": false,
        "collection_id": 227,
        "query_type": "native",
        "name": "Median GMV per user - Duplicate",
        "last_used_at": "2025-06-18T14:48:01.646732Z",
        "type": "question",
        "query_average_duration": 221,
        "creator_id": 148,
        "moderation_reviews": [],
        "updated_at": "2025-06-18T14:48:01.646732Z",
        "made_public_by_id": null,
        "embedding_params": null,
        "cache_ttl": null,
        "dataset_query": {
          "database": 2,
          "type": "native",
          "native": {
            "template-tags": {
              "CREATED_AT": {
                "type": "dimension",
                "name": "CREATED_AT",
                "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
                "display-name": "Created At",
                "default": "past30days",
                "dimension": [
                  "field",
                  20835,
                  null
                ],
                "widget-type": "date/all-options",
                "required": true
              },
              "IS_FAST_TRACK_KYC": {
                "type": "dimension",
                "name": "IS_FAST_TRACK_KYC",
                "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
                "display-name": "Is Fast Track Kyc",
                "dimension": [
                  "field",
                  564369,
                  null
                ],
                "widget-type": "string/="
              },
              "fiat_currency": {
                "type": "dimension",
                "name": "fiat_currency",
                "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
                "display-name": "Fiat Currency",
                "dimension": [
                  "field",
                  20892,
                  null
                ],
                "widget-type": "string/="
              },
              "brand_card": {
                "type": "dimension",
                "name": "brand_card",
                "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
                "display-name": "Brand Card",
                "dimension": [
                  "field",
                  738,
                  null
                ],
                "widget-type": "string/="
              },
              "AUTH_TYPE": {
                "type": "dimension",
                "name": "AUTH_TYPE",
                "id": "83709647-089b-4390-b965-55393b391b75",
                "display-name": "Auth Type",
                "dimension": [
                  "field",
                  566012,
                  null
                ],
                "widget-type": "string/="
              },
              "vendor_name": {
                "type": "dimension",
                "name": "vendor_name",
                "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
                "display-name": "Vendor Name",
                "dimension": [
                  "field",
                  20868,
                  null
                ],
                "widget-type": "string/="
              },
              "is_aft": {
                "type": "dimension",
                "name": "is_aft",
                "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
                "display-name": "Is Aft",
                "default": null,
                "dimension": [
                  "field",
                  603702,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "LOCATION_GEO": {
                "type": "dimension",
                "name": "LOCATION_GEO",
                "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
                "display-name": "Location Geo",
                "dimension": [
                  "field",
                  876,
                  null
                ],
                "widget-type": "string/="
              },
              "country_card": {
                "type": "dimension",
                "name": "country_card",
                "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
                "display-name": "Country Card",
                "dimension": [
                  "field",
                  795,
                  null
                ],
                "widget-type": "string/="
              },
              "TRANSACTION_COLUMNS_GROUPBY": {
                "type": "dimension",
                "name": "TRANSACTION_COLUMNS_GROUPBY",
                "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
                "display-name": "Transaction Columns Groupby",
                "default": [
                  "Accepted Transaction"
                ],
                "dimension": [
                  "field",
                  23294,
                  null
                ],
                "widget-type": "string/=",
                "required": true
              },
              "top_n": {
                "type": "number",
                "name": "top_n",
                "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
                "display-name": "Top N",
                "default": "5",
                "required": true
              },
              "partner_name": {
                "type": "dimension",
                "name": "partner_name",
                "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
                "display-name": "Partner Name",
                "dimension": [
                  "field",
                  20834,
                  null
                ],
                "widget-type": "string/="
              },
              "crypto_currency": {
                "type": "dimension",
                "name": "crypto_currency",
                "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
                "display-name": "Crypto Currency",
                "dimension": [
                  "field",
                  20836,
                  null
                ],
                "widget-type": "string/="
              },
              "network": {
                "type": "dimension",
                "name": "network",
                "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
                "display-name": "Network",
                "dimension": [
                  "field",
                  34623,
                  null
                ],
                "widget-type": "string/="
              },
              "is_user_based_selective": {
                "type": "dimension",
                "name": "is_user_based_selective",
                "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
                "display-name": "Is User Based Selective",
                "dimension": [
                  "field",
                  561795,
                  null
                ],
                "widget-type": "string/="
              },
              "CARD_GEOSCHEME": {
                "type": "dimension",
                "name": "CARD_GEOSCHEME",
                "id": "82668fce-f949-4039-84c5-c4713fe48488",
                "display-name": "Card Geoscheme",
                "dimension": [
                  "field",
                  757,
                  null
                ],
                "widget-type": "string/="
              },
              "is_amount_based_selective": {
                "type": "dimension",
                "name": "is_amount_based_selective",
                "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
                "display-name": "Is Amount Based Selective",
                "default": null,
                "dimension": [
                  "field",
                  573892,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              },
              "pay_system": {
                "type": "dimension",
                "name": "pay_system",
                "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
                "display-name": "Pay System",
                "dimension": [
                  "field",
                  20885,
                  null
                ],
                "widget-type": "string/="
              },
              "flag_is_recurring": {
                "type": "dimension",
                "name": "flag_is_recurring",
                "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
                "display-name": "Flag Is Recurring",
                "dimension": [
                  "field",
                  550206,
                  null
                ],
                "widget-type": "string/="
              },
              "GRANULARITY": {
                "type": "text",
                "name": "GRANULARITY",
                "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
                "display-name": "Granularity"
              },
              "transaction_accepted": {
                "type": "dimension",
                "name": "transaction_accepted",
                "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
                "display-name": "Transaction Accepted",
                "dimension": [
                  "field",
                  20847,
                  null
                ],
                "widget-type": "string/="
              },
              "type_operation": {
                "type": "dimension",
                "name": "type_operation",
                "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
                "display-name": "Type Operation",
                "dimension": [
                  "field",
                  20880,
                  null
                ],
                "widget-type": "string/="
              },
              "LOCATION_COUNTRY": {
                "type": "dimension",
                "name": "LOCATION_COUNTRY",
                "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
                "display-name": "Location Country",
                "dimension": [
                  "field",
                  874,
                  null
                ],
                "widget-type": "string/="
              },
              "RETRY_EXCLUDE": {
                "type": "dimension",
                "name": "RETRY_EXCLUDE",
                "id": "80057293-bae9-4787-9c9e-515eda94fa29",
                "display-name": "Retry Exclude",
                "default": null,
                "dimension": [
                  "field",
                  569157,
                  null
                ],
                "widget-type": "string/=",
                "options": null
              }
            },
            "query": "WITH group_by_parameter as (\r\n    select TRANSACTION_COLUMNS_GROUPBY as parameter_group\r\n    from md.TRANSACTION_DASHBOARD_HELP_TABLE\r\n    where TRANSACTION_COLUMNS_GROUPBY is not null and {{TRANSACTION_COLUMNS_GROUPBY}}\r\n    ),\r\n     pre_top_n as (\r\n    select CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n        WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END AS GROUP_BY\r\n         , row_number() over (order by count(distinct(user_id)) desc) as rn\r\n    from MART.TRANSACTIONS\r\n    left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n    left join group_by_parameter on 1=1\r\n    where {{CREATED_AT}} and\r\n          TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}} and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n    group by 1\r\n    order by 2 desc),\r\n     top_n as (\r\n         select GROUP_BY\r\n                , CASE WHEN rn < {{top_n}}\r\n                    THEN GROUP_BY\r\n                    ELSE 'others' END AS top_n_parameter\r\n         from pre_top_n\r\n     ),\r\n  main_query as (select \r\n                        TRANSACTIONS.user_id\r\n                      , date_trunc({{GRANULARITY}},CREATED_AT) as DT \r\n                      , top_n.top_n_parameter\r\n                      , sum(GMV_EUR) as gmv\r\n      from mart.TRANSACTIONS \r\n      left join MD.COUNTRY_CODES\r\n                   on lower(TRANSACTIONS.LOCATION_COUNTRY) = lower(COUNTRY_CODES.COUNTRY_CODE_ALPHA_3)\r\n      left join group_by_parameter on 1=1\r\n          left join top_n on top_n.GROUP_BY = CASE \r\n        WHEN group_by_parameter.parameter_group = 'Partner Widget'\r\n            THEN TRANSACTIONS.WIDGET_PARTNER_NAME\r\n        WHEN group_by_parameter.parameter_group = 'Type operation'\r\n            THEN TRANSACTIONS.TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Accepted Transaction'\r\n            THEN to_char(TRANSACTIONS.CONFIRMED)\r\n        WHEN group_by_parameter.parameter_group = 'Crypto currency'\r\n            THEN TRANSACTIONS.currency\r\n        WHEN group_by_parameter.parameter_group = 'Fiat currency'\r\n            THEN TRANSACTIONS.fiat_currency\r\n        WHEN group_by_parameter.parameter_group = 'Country card'\r\n            THEN TRANSACTIONS.CARD_ISOCOUNTRY\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme card'\r\n            THEN TRANSACTIONS.CARD_GEOSCHEME\r\n        WHEN group_by_parameter.parameter_group = 'Brand card'\r\n            THEN TRANSACTIONS.CARD_BRAND\r\n        WHEN group_by_parameter.parameter_group = 'Pay System'\r\n            THEN TRANSACTIONS.PAY_SYSTEM\r\n        WHEN group_by_parameter.parameter_group = 'Country IP'\r\n            THEN COUNTRY_CODES.COUNTRY_NAME_EN\r\n        WHEN group_by_parameter.parameter_group = 'Geoscheme IP'\r\n            THEN COUNTRY_CODES.GEOSCHEME_BUSINESS\r\n        WHEN group_by_parameter.parameter_group = 'Acquirer'\r\n            THEN TRANSACTIONS.vendor_name\r\n       WHEN group_by_parameter.parameter_group = 'Network'\r\n            THEN TRANSACTIONS.Network\r\n        WHEN group_by_parameter.parameter_group = 'Auth type'\r\n            THEN TRANSACTIONS.AUTH_TYPE\r\n        WHEN group_by_parameter.parameter_group = 'Is Fast Track'\r\n            THEN TRANSACTIONS.IS_FAST_TRACK_KYC\r\n        WHEN group_by_parameter.parameter_group = 'Is AFT'\r\n            THEN TRANSACTIONS.IS_AFT\r\n            END\r\n                \r\n      where TRANSACTIONS.SOURCE_MAIN = 'widget' and {{type_operation}} and\r\n      {{CREATED_AT}} and {{transaction_accepted}} and {{partner_name}} and\r\n          {{crypto_currency}} and {{fiat_currency}} and {{country_card}} and {{brand_card}} and \r\n          {{pay_system}}  and {{CARD_GEOSCHEME}} and {{LOCATION_COUNTRY}} and {{LOCATION_GEO}} and\r\n          {{vendor_name}} and {{network}} and {{flag_is_recurring}} and {{is_user_based_selective}} and\r\n          {{IS_FAST_TRACK_KYC}} and {{AUTH_TYPE}} and {{RETRY_EXCLUDE}} and {{is_amount_based_selective}} and {{is_aft}} \r\n      group by 1, 2, 3\r\n      ) \r\nselect DT\r\n      , top_n_parameter AS Parameter_topN\r\n      , median(gmv) as 'Median GMV per user'\r\nfrom main_query\r\ngroup by dt, top_n_parameter"
          }
        },
        "id": 3793,
        "parameter_mappings": [],
        "display": "bar",
        "archived_directly": false,
        "entity_id": "jviVJiCmYohW3mQc7pMgo",
        "collection_preview": true,
        "visualization_settings": {
          "graph.show_values": true,
          "stackable.stack_type": null,
          "graph.y_axis.title_text": "Median GMV",
          "graph.dimensions": [
            "DT",
            "PARAMETER_TOPN"
          ],
          "column_settings": {
            "[\"name\",\"AVG_BILL\"]": {
              "number_style": "currency",
              "decimals": 0
            }
          },
          "graph.metrics": [
            "Median GMV per user"
          ]
        },
        "metabase_version": "v0.52.9 (f9fbbf8)",
        "parameters": [
          {
            "id": "f63085d5-80a1-47b8-8cdd-ab2d115a3d62",
            "type": "date/all-options",
            "target": [
              "dimension",
              [
                "template-tag",
                "CREATED_AT"
              ]
            ],
            "name": "Created At",
            "slug": "CREATED_AT",
            "default": "past30days",
            "required": true
          },
          {
            "id": "011bd2ed-bb81-49c4-bf4d-e880c9e449b6",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "IS_FAST_TRACK_KYC"
              ]
            ],
            "name": "Is Fast Track Kyc",
            "slug": "IS_FAST_TRACK_KYC"
          },
          {
            "id": "4b2a323f-0b0e-47fc-89b5-f8111c36be24",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "fiat_currency"
              ]
            ],
            "name": "Fiat Currency",
            "slug": "fiat_currency"
          },
          {
            "id": "8fa4d67e-5253-4b13-8735-bc3d7e7b6283",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "brand_card"
              ]
            ],
            "name": "Brand Card",
            "slug": "brand_card"
          },
          {
            "id": "83709647-089b-4390-b965-55393b391b75",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "AUTH_TYPE"
              ]
            ],
            "name": "Auth Type",
            "slug": "AUTH_TYPE"
          },
          {
            "id": "fd820311-9f47-4cab-8be7-6cf665a0b25c",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "vendor_name"
              ]
            ],
            "name": "Vendor Name",
            "slug": "vendor_name"
          },
          {
            "id": "5a3b2a17-1c8c-415e-adec-fd2cec4f12fd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_aft"
              ]
            ],
            "name": "Is Aft",
            "slug": "is_aft"
          },
          {
            "id": "7cea77e8-624e-4bc9-975e-c8ef4e858099",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_GEO"
              ]
            ],
            "name": "Location Geo",
            "slug": "LOCATION_GEO"
          },
          {
            "id": "3509d976-e3f1-4b0c-8a07-9758fba46c18",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "country_card"
              ]
            ],
            "name": "Country Card",
            "slug": "country_card"
          },
          {
            "id": "29e73c3c-95ae-495a-a273-250bd907e49e",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "TRANSACTION_COLUMNS_GROUPBY"
              ]
            ],
            "name": "Transaction Columns Groupby",
            "slug": "TRANSACTION_COLUMNS_GROUPBY",
            "default": [
              "Accepted Transaction"
            ],
            "required": true
          },
          {
            "id": "bf92f50c-2896-41d5-91cc-13012b0641a2",
            "type": "number/=",
            "target": [
              "variable",
              [
                "template-tag",
                "top_n"
              ]
            ],
            "name": "Top N",
            "slug": "top_n",
            "default": "5",
            "required": true
          },
          {
            "id": "6202dce5-7497-4026-bdf9-680d2ca99673",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "partner_name"
              ]
            ],
            "name": "Partner Name",
            "slug": "partner_name"
          },
          {
            "id": "cab11020-b724-4f0f-8e3f-c21c6284aaa9",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "crypto_currency"
              ]
            ],
            "name": "Crypto Currency",
            "slug": "crypto_currency"
          },
          {
            "id": "588874d0-63be-45f5-b02f-b6dd8bc711ef",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "network"
              ]
            ],
            "name": "Network",
            "slug": "network"
          },
          {
            "id": "79dc9aa9-b4cb-460c-bb82-331cf30cdda3",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_user_based_selective"
              ]
            ],
            "name": "Is User Based Selective",
            "slug": "is_user_based_selective"
          },
          {
            "id": "82668fce-f949-4039-84c5-c4713fe48488",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "CARD_GEOSCHEME"
              ]
            ],
            "name": "Card Geoscheme",
            "slug": "CARD_GEOSCHEME"
          },
          {
            "id": "04e1725e-55e5-44c8-a85e-e3be754b357a",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "is_amount_based_selective"
              ]
            ],
            "name": "Is Amount Based Selective",
            "slug": "is_amount_based_selective"
          },
          {
            "id": "db30bad2-db38-4527-afc7-09f9cb55212f",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "pay_system"
              ]
            ],
            "name": "Pay System",
            "slug": "pay_system"
          },
          {
            "id": "44dbe5fa-c2e0-4be8-8821-89f5853b9abd",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "flag_is_recurring"
              ]
            ],
            "name": "Flag Is Recurring",
            "slug": "flag_is_recurring"
          },
          {
            "id": "bfbb87ab-ce07-4330-b005-e40d71a20a0e",
            "type": "category",
            "target": [
              "variable",
              [
                "template-tag",
                "GRANULARITY"
              ]
            ],
            "name": "Granularity",
            "slug": "GRANULARITY"
          },
          {
            "id": "e7127a68-50d7-4b66-ac84-4f72b5c177da",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "transaction_accepted"
              ]
            ],
            "name": "Transaction Accepted",
            "slug": "transaction_accepted"
          },
          {
            "id": "c5b9f96d-3fed-416e-b980-2ea23082e564",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "type_operation"
              ]
            ],
            "name": "Type Operation",
            "slug": "type_operation"
          },
          {
            "id": "2ea51407-4b76-48c7-afd8-4b8183afccab",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "LOCATION_COUNTRY"
              ]
            ],
            "name": "Location Country",
            "slug": "LOCATION_COUNTRY"
          },
          {
            "id": "80057293-bae9-4787-9c9e-515eda94fa29",
            "type": "string/=",
            "target": [
              "dimension",
              [
                "template-tag",
                "RETRY_EXCLUDE"
              ]
            ],
            "name": "Retry Exclude",
            "slug": "RETRY_EXCLUDE"
          }
        ],
        "created_at": "2025-06-18T14:48:01.646732Z",
        "public_uuid": null
      },
      "updated_at": "2025-06-18T14:48:01.646732Z",
      "col": 12,
      "id": 2934,
      "parameter_mappings": [
        {
          "parameter_id": "27656f4c",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "CREATED_AT"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d1f2a4dd",
          "card_id": 3793,
          "target": [
            "variable",
            [
              "template-tag",
              "top_n"
            ]
          ]
        },
        {
          "parameter_id": "4fa9e9de",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "TRANSACTION_COLUMNS_GROUPBY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c432bf53",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "type_operation"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "157b2900",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "partner_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "ba8ec5fd",
          "card_id": 3793,
          "target": [
            "variable",
            [
              "template-tag",
              "GRANULARITY"
            ]
          ]
        },
        {
          "parameter_id": "4bca20b1",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "crypto_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "1cfdfdc4",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "fiat_currency"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "215f6aa",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "CARD_GEOSCHEME"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "568c8890",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "brand_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "7e1dbda1",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_GEO"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "2a85a813",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "LOCATION_COUNTRY"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "20e53fa3",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "vendor_name"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "f16006b5",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "country_card"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "65c17dea",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "pay_system"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "185abb8b",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "network"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "c272bc8c",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "transaction_accepted"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "717e26d6",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "flag_is_recurring"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "b48e0810",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_user_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "d0106a4d",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "IS_FAST_TRACK_KYC"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "cf0992f0",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "AUTH_TYPE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "10f875ce",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "RETRY_EXCLUDE"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "8c7d23a8",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_amount_based_selective"
            ],
            {
              "stage-number": 0
            }
          ]
        },
        {
          "parameter_id": "4af33822",
          "card_id": 3793,
          "target": [
            "dimension",
            [
              "template-tag",
              "is_aft"
            ],
            {
              "stage-number": 0
            }
          ]
        }
      ],
      "card_id": 3793,
      "entity_id": "c5hNDSTl2HOnaKWjagGbQ",
      "visualization_settings": {},
      "size_y": 6,
      "dashboard_id": 393,
      "created_at": "2025-06-18T14:48:01.646732Z",
      "row": 0
    }
  ],
  "param_values": {
    "1694": {
      "field_id": 1694,
      "human_readable_values": [],
      "values": [
        "buy",
        "recurring-buy",
        "sell",
        null
      ]
    },
    "561795": {
      "field_id": 561795,
      "human_readable_values": [],
      "values": [
        false,
        true
      ]
    },
    "569157": {
      "field_id": 569157,
      "human_readable_values": [],
      "values": [
        false,
        true
      ]
    },
    "587331": {
      "field_id": 587331,
      "human_readable_values": [],
      "values": [
        false,
        true,
        null
      ]
    },
    "20885": {
      "field_id": 20885,
      "human_readable_values": [],
      "values": [
        "AMERICAN EXPRESS",
        "Apple Pay",
        "Buy Acquirer",
        "Google Pay",
        "HUMOCARD",
        "LOCAL BRAND",
        "LOCAL_CARDS_BRANDS",
        "MASTERCARD",
        "No Data",
        "RUPAY",
        "Sell to an unknown card",
        "UNIONPAY",
        "UZCARD",
        "VISA"
      ]
    },
    "573892": {
      "field_id": 573892,
      "human_readable_values": [],
      "values": [
        false,
        true
      ]
    },
    "1703": {
      "field_id": 1703,
      "human_readable_values": [],
      "values": [
        "1INCH",
        "ADA",
        "ALGO",
        "ARB",
        "ATOM",
        "AVAX",
        "BAT",
        "BCH",
        "BNB",
        "BTC",
        "BUSD",
        "CATI",
        "CRV",
        "DAI",
        "DASH",
        "DOGE",
        "DOGS",
        "DOT",
        "DYDX",
        "ETH",
        "FTM",
        "HMSTR",
        "INJ",
        "JUP",
        "KSM",
        "LINK",
        "LTC",
        "MAJOR",
        "MANA",
        "MATIC",
        "NEAR",
        "NOT",
        "OKB",
        "PEPE",
        "POL",
        "SAND",
        "SHIB",
        "SOL",
        "SWEAT",
        "TIA",
        "TON",
        "TRUMP",
        "TRX",
        "TWT",
        "UNI",
        "USDC",
        "USDT",
        "WEMIX",
        "X",
        "XLM",
        "XRP",
        "XTZ"
      ]
    },
    "34623": {
      "field_id": 34623,
      "human_readable_values": [],
      "values": [
        "ALGORAND",
        "ARBITRUM",
        "AVALANCHE",
        "BASE",
        "BINANCESMARTCHAIN",
        "BITCOIN",
        "BITCOINCASH",
        "CARDANO",
        "CELESTIA",
        "COSMOS",
        "DASH",
        "DOGECOIN",
        "ETHEREUM",
        "FANTOM",
        "INJECTIVE",
        "KAVA",
        "KUSAMA",
        "LINEA",
        "LITECOIN",
        "NEAR_PROTOCOL",
        "NEWTON",
        "OPTIMISM",
        "POLKADOT",
        "POLYGON",
        "RIPPLE",
        "SOLANA",
        "STELLAR",
        "TEZOS",
        "TRON",
        "WEMIX",
        "ZKSYNC",
        null
      ]
    },
    "20836": {
      "field_id": 20836,
      "human_readable_values": [],
      "values": [
        "1INCH",
        "ADA",
        "ALGO",
        "ARB",
        "ATOM",
        "AVAX",
        "BAT",
        "BCH",
        "BNB",
        "BTC",
        "BUSD",
        "CATI",
        "CRV",
        "DAI",
        "DASH",
        "DOGE",
        "DOGS",
        "DOT",
        "DYDX",
        "EGLD",
        "ETH",
        "EUR",
        "FTM",
        "HMSTR",
        "INJ",
        "JUP",
        "KAVA",
        "KSM",
        "LINK",
        "LTC",
        "MAJOR",
        "MANA",
        "NEAR",
        "NOT",
        "OKB",
        "PEPE",
        "POL",
        "RUB",
        "SAND",
        "SHIB",
        "SOL",
        "SWEAT",
        "TIA",
        "TON",
        "TRUMP",
        "TRX",
        "TWT",
        "UNI",
        "USDC",
        "USDT",
        "WEMIX",
        "X",
        "XLM",
        "XRP",
        "XTZ"
      ]
    },
    "1686": {
      "field_id": 1686,
      "human_readable_values": [],
      "values": [
        "'",
        "EightBWorld_bni",
        "EightBWorld_bri",
        "EightBWorld_dana",
        "EightBWorld_instapay",
        "EightBWorld_mandiri",
        "EightBWorld_ovo",
        "EightBWorld_permata",
        "EightBWorld_qris",
        "EightBWorld_shopeepay",
        "NGNBankTransfer",
        "apple",
        "card",
        "fiat_balance",
        "fiat_balance_with_top_up",
        "fiat_card",
        "fiat_card_open",
        "fiat_card_topup",
        "google",
        "hyperion_blik",
        "instapay_qrph",
        "interac_gk",
        "mobile_pay",
        "mock",
        "new_card",
        "new_fiat_card",
        "not_authorized",
        "open_card",
        "open_fiat_balance",
        "pix",
        "revolut_pay",
        "topup",
        "u_pix",
        "unlimint_pix_brl",
        "v_sepa",
        "volt",
        "volt_banktransfer_eur",
        null
      ]
    },
    "20847": {
      "field_id": 20847,
      "human_readable_values": [],
      "values": [
        false,
        true,
        null
      ]
    },
    "20892": {
      "field_id": 20892,
      "human_readable_values": [],
      "values": [
        "AED",
        "AMD",
        "ARS",
        "AUD",
        "BGN",
        "BRL",
        "CAD",
        "CHF",
        "COP",
        "CZK",
        "DKK",
        "DOP",
        "EUR",
        "GBP",
        "GHS",
        "HKD",
        "HUF",
        "IDR",
        "ILS",
        "INR",
        "ISK",
        "JOD",
        "JPY",
        "KES",
        "KRW",
        "KZT",
        "LKR",
        "MXN",
        "NGN",
        "NOK",
        "NZD",
        "PEN",
        "PHP",
        "PLN",
        "QAR",
        "RON",
        "RUB",
        "SEK",
        "SGD",
        "THB",
        "TRY",
        "TWD",
        "TZS",
        "UAH",
        "UGX",
        "USD",
        "UYU",
        "VND",
        "ZAR",
        null
      ]
    },
    "20834": {
      "field_id": 20834,
      "human_readable_values": [],
      "values": [
        "1inch",
        "2btc.io",
        "3commas.io",
        "5bit.me",
        "AAX",
        "ADV cash",
        "AMLSafe",
        "AMarkets",
        "AWEX",
        "AXOM",
        "Abra",
        "Accumulus",
        "Actoz",
        "AfricaMoney",
        "Aifory LLC",
        "AlfaCash",
        "Alpha Exchange",
        "Amarkets",
        "Amber",
        "AmirCapital",
        "Api.Hamsterspay.com",
        "Aqru finance",
        "ArcticWallet",
        "Artozo",
        "Atlas Wallet",
        "B2B exchanger",
        "BKEX",
        "BTC-Alpha",
        "BTCC (task 8417)",
        "BYDFi",
        "Bancor",
        "Barclay Stone",
        "Best Change",
        "BetBoom",
        "Bibox",
        "Billance",
        "Binance.mercuryo.io",
        "BingX",
        "Biswap",
        "BitMEX",
        "Bitay",
        "Bitcoin TitanX",
        "Bitcoinbtc.club",
        "Bitfinex Widget",
        "Bitforex",
        "Bitget",
        "Bithumb",
        "Bitmax(Ascendex)",
        "Bitquidity",
        "Bitzing",
        "Blue Wallet",
        "Bonuz App",
        "BoxExchanger",
        "Bro Fintech LTD",
        "Btcshark",
        "Bybit",
        "CAEX",
        "Cabbagino",
        "Capitalist",
        "Cardex Exchange",
        "ChainApp",
        "ChangeNOW",
        "Changelly",
        "Citihexltd",
        "ClickToBuyBitcoin",
        "Coin to pay",
        "Coin98",
        "CoinCash",
        "CoinDisco",
        "CoinEx",
        "CoinPayments",
        "CoinStats",
        "CoinTiger",
        "CoinW",
        "Coinandcoin",
        "Coincola",
        "Coinlocally",
        "Coinplay",
        "Coinsbit",
        "Coinstore",
        "Coinzix",
        "CompanyDao",
        "Credefi",
        "Credits.com",
        "Cricle",
        "Cryptadium",
        "Cryptero_x_Mercuryo test partner",
        "Cryptix",
        "Crypto-news",
        "CryptoCash",
        "CryptoCash API",
        "CryptoFundsToday",
        "CryptoPal",
        "Cryptolines",
        "Cryptomus",
        "Custonomy",
        "Cuverse",
        "DA 5",
        "DA5 Mobile",
        "Darius Tech inc.",
        "DeCenter",
        "DefiBet",
        "Defirex",
        "DhanuX",
        "Digifinex",
        "Dok Wallet",
        "Doshi",
        "DreamSteam",
        "EMCD",
        "EasiHK.com",
        "EasyPortal2",
        "EasyPortal3",
        "Easyportal",
        "Ebankx",
        "Ecos",
        "Electrocoin",
        "Ellipal",
        "Eternl",
        "Everstake",
        "Exchange Demo",
        "Exchangers Monitor",
        "Exchangesumo",
        "Exmo",
        "Exness",
        "ExpressMinds",
        "Exworth",
        "FMFW(bitcoin.com)",
        "Fairdesk",
        "FastToken",
        "Fastex",
        "Fizen",
        "Flooz",
        "Fozeus",
        "Fundwallet",
        "GIE",
        "GKFX",
        "GMT",
        "Galaktika N.V.",
        "GamblingMercuryo",
        "Garantex",
        "Gem4Me",
        "Globiance",
        "Gokumarket",
        "Golden Way Payments LTD",
        "Grand Time",
        "Grapherex",
        "HOO",
        "Hackathon",
        "HamstersPay.com",
        "Haru",
        "Haven",
        "Hawex",
        "HereWallet",
        "Hitbtc",
        "Hiveon",
        "Hotcoin",
        "Hoyabit",
        "Huacool",
        "Huobi",
        "INJ Bridge",
        "IPerCash",
        "IXFI",
        "Indodax.com",
        "Infinito Solutions",
        "Insta.money",
        "InstaSwap",
        "IntellaX",
        "Irontrade",
        "JapanTest",
        "Jupiter",
        "Kauri",
        "Kauri2",
        "Kauri3",
        "Keystone",
        "Kickex",
        "Kirill_Blik_Test",
        "KryptoGo",
        "Kryptoknights.io",
        "KuCoin",
        "Kymis",
        "LA token",
        "LBank",
        "Ledger",
        "Ledger Spend",
        "Leon",
        "LeveX",
        "Livecoin",
        "LocalTrade",
        "Lucky Labs",
        "Lumi",
        "MEXC",
        "Magic wallet",
        "Magneticexchange",
        "Magnum",
        "Mandala",
        "Matrixport",
        "Mayex",
        "Meld",
        "Meld I",
        "Mercuryo",
        "Mercuryo CaaS Test",
        "Mercuryo.b2b.test",
        "MercuryoWidget",
        "Mercuryo_referral",
        "Metamask",
        "Metaspins",
        "Metavault",
        "Meteor Wallet",
        "Mexo",
        "Millionero",
        "Mining-Bitcoin",
        "Minswap",
        "Minto",
        "Mostbet",
        "Mycelium",
        "NFTGate",
        "NeoWallet",
        "Nft Checkout Brand",
        "Ninji wallet",
        "Nominex",
        "Nova",
        "OERO",
        "OKX",
        "Onederex",
        "Onramper2",
        "Onramper3",
        "OpenC",
        "PNGMarketing.com",
        "PU",
        "Pancakeswap",
        "Parallax",
        "Particle",
        "Paytech Pro LTD",
        "Phemex",
        "Pichains",
        "PointPay",
        "Poloniex",
        "PrimeFin Solutions inc.",
        "Probit",
        "Pyypl",
        "Q-Send",
        "Q-send_preprod",
        "Qiwi",
        "Quickex",
        "RON",
        "Rare",
        "Revuto",
        "Riv",
        "Roobee",
        "SDK Blik test",
        "STEX",
        "Santepay",
        "Sapien",
        "Sastanaqqam",
        "Savl",
        "Scrypton",
        "SendNomad",
        "Shido",
        "Simex",
        "SimpleSwap",
        "Simpledo",
        "SmartyAPI",
        "SmartyPay",
        "Smarty_PreProd",
        "Socoin",
        "SoftSwiss",
        "Spatium",
        "Speedybits",
        "Staging",
        "Stakecito",
        "Star Exchangealliance",
        "Status Wallet",
        "StealthEx",
        "StepApp",
        "Stepan_test_b2b",
        "SuperEX",
        "Swapspace",
        "Swapster",
        "Sweat",
        "Swoo",
        "TEST101",
        "TKEY",
        "TON",
        "TON Space",
        "Tangem",
        "Techroo",
        "Telegram Wallet",
        "Test",
        "Test_Mercuryo",
        "TheWOLF",
        "Tiger Trade",
        "ToTheMoon",
        "TokenPocket",
        "Tomo",
        "Tonkeeper",
        "Trade4coins (task 9345)",
        "TransferMole",
        "Trastera",
        "Trastra",
        "Trezor",
        "TrueFlip.io",
        "TrustWallet",
        "TrustWallet0%",
        "Trustee",
        "UTEX",
        "UUEX",
        "UWIM (task 9405)",
        "UllaPay",
        "Union BTC",
        "Uniramp",
        "Unistex",
        "VNSmart",
        "Vardex",
        "Vave",
        "Venga",
        "Venga preprod",
        "VeroWay",
        "WOO",
        "WalletBot",
        "Wallex",
        "Waveland",
        "Waves",
        "Waves2",
        "Waxpeer",
        "Wbb",
        "Web3Auth",
        "Wemix",
        "Weownomy Pay",
        "Westchange",
        "WhiteBit",
        "WhiteMarket",
        "Wigwam",
        "Wild",
        "Win.Wallet",
        "XENA",
        "XT.com",
        "Xive",
        "Xjet",
        "Xponential crypto",
        "Xzen",
        "YIBI",
        "Zerion",
        "Zink",
        "advantech",
        "allcoinswapper",
        "amber",
        "binance.org",
        "bitcastle",
        "bitcoin.com",
        "bitpapa",
        "bitx.land/merchantpay",
        "blackmoonfg.uk",
        "bspin",
        "buycoinnow",
        "c3 exchange",
        "changehero.io",
        "coin galaxy",
        "cryptofully",
        "cryptoxchangers",
        "cubaxchange",
        "daovc",
        "demo-wg-301019.mercuryo.io",
        "demo-widget-301019.mercuryo.io",
        "dropstab.com",
        "fastcoin",
        "gate",
        "goodbuycrypto",
        "hkbitex",
        "i-cex",
        "iToken",
        "iqex",
        "iquick.io",
        "kefa comm",
        "klever",
        "kryptonite",
        "letsexchange.io",
        "mercuryorabbit.com",
        "onramper",
        "onramper1",
        "open_C (task 9535)",
        "o\u0441tagonFX",
        "parabolus",
        "paytiz",
        "polysports",
        "quantfury",
        "quickx",
        "ready-steady.net",
        "rokkex.com",
        "sendcash.africa",
        "strikeX",
        "swallet",
        "swapy.app",
        "tbit",
        "threefold.io",
        "tokean.com",
        "tokens.net",
        "torus",
        "tozex",
        "vlafx.us",
        "x-meta",
        "xChange",
        "xp-trade.com",
        "\u0410thena Crypto Bank",
        null
      ]
    },
    "587330": {
      "field_id": 587330,
      "human_readable_values": [],
      "values": [
        false,
        true,
        null
      ]
    },
    "550206": {
      "field_id": 550206,
      "human_readable_values": [],
      "values": [
        false,
        true
      ]
    },
    "876": {
      "field_id": 876,
      "human_readable_values": [],
      "values": [
        "-",
        "Africa",
        "Asia",
        "CIS",
        "Europe EU",
        "Europe non-EU",
        "Latin America",
        "North America",
        "Oceania",
        "USA"
      ]
    },
    "757": {
      "field_id": 757,
      "human_readable_values": [],
      "values": [
        "Africa",
        "Asia",
        "CIS",
        "Europe EU",
        "Europe non-EU",
        "Latin America",
        "North America",
        "Oceania",
        "USA",
        null
      ]
    },
    "566012": {
      "field_id": 566012,
      "human_readable_values": [],
      "values": [
        "3DS",
        "3DS, No3DS",
        "No3DS",
        null
      ]
    },
    "587329": {
      "field_id": 587329,
      "human_readable_values": [],
      "values": [
        false,
        true,
        null
      ]
    },
    "536409": {
      "field_id": 536409,
      "human_readable_values": [],
      "values": [
        false,
        true,
        null
      ]
    },
    "603702": {
      "field_id": 603702,
      "human_readable_values": [],
      "values": [
        "No",
        "Yes",
        null
      ]
    },
    "795": {
      "field_id": 795,
      "human_readable_values": [],
      "values": [
        "Afghanistan",
        "Albania",
        "Algeria",
        "American Samoa",
        "Andorra",
        "Angola",
        "Anguilla",
        "Antigua and Barbuda",
        "Argentina",
        "Armenia",
        "Aruba",
        "Australia",
        "Austria",
        "Azerbaijan",
        "Bahamas",
        "Bahrain",
        "Bangladesh",
        "Barbados",
        "Belarus",
        "Belgium",
        "Belize",
        "Benin",
        "Bermuda",
        "Bhutan",
        "Bolivia (Plurinational State of)",
        "Bonaire, Sint Eustatius and Saba",
        "Bosnia and Herzegovina",
        "Botswana",
        "Brazil",
        "Brunei Darussalam",
        "Bulgaria",
        "Burkina Faso",
        "Burundi",
        "Cabo Verde",
        "Cambodia",
        "Cameroon",
        "Canada",
        "Cayman Islands",
        "Chad",
        "Chile",
        "China",
        "Colombia",
        "Comoros",
        "Congo",
        "Congo (Democratic Republic of the)",
        "Cook Islands",
        "Costa Rica",
        "Cote D'ivoire",
        "Croatia",
        "Curacao",
        "Cyprus",
        "Czechia",
        "Denmark",
        "Djibouti",
        "Dominica",
        "Dominican Republic",
        "Ecuador",
        "Egypt",
        "El Salvador",
        "Equatorial Guinea",
        "Estonia",
        "Eswatini",
        "Ethiopia",
        "Fiji",
        "Finland",
        "France",
        "French Polynesia",
        "Gabon",
        "Gambia",
        "Georgia",
        "Germany",
        "Ghana",
        "Gibraltar",
        "Greece",
        "Grenada",
        "Guam",
        "Guatemala",
        "Guernsey",
        "Guinea",
        "Guyana",
        "Haiti",
        "Holy See",
        "Honduras",
        "Hong Kong",
        "Hungary",
        "Iceland",
        "India",
        "Indonesia",
        "Iran (Islamic Republic of)",
        "Iraq",
        "Ireland",
        "Israel",
        "Italy",
        "Jamaica",
        "Japan",
        "Jersey",
        "Jordan",
        "Kazakhstan",
        "Kenya",
        "Kiribati",
        "Korea (Republic of)",
        "Kuwait",
        "Kyrgyzstan",
        "Lao People's Democratic Republic",
        "Latvia",
        "Lebanon",
        "Lesotho",
        "Liberia",
        "Libya",
        "Liechtenstein",
        "Lithuania",
        "Luxembourg",
        "Macao",
        "Madagascar",
        "Malawi",
        "Malaysia",
        "Maldives",
        "Mali",
        "Malta",
        "Mauritania",
        "Mauritius",
        "Mexico",
        "Micronesia (Federated States of)",
        "Moldova (Republic of)",
        "Monaco",
        "Mongolia",
        "Montenegro",
        "Morocco",
        "Mozambique",
        "Myanmar",
        "Namibia",
        "Nepal",
        "Netherlands",
        "New Caledonia",
        "New Zealand",
        "Nicaragua",
        "Niger",
        "Nigeria",
        "North Macedonia",
        "Northern Mariana Islands",
        "Norway",
        "Oman",
        "Pakistan",
        "Palestine, State of",
        "Panama",
        "Papua New Guinea",
        "Paraguay",
        "Peru",
        "Philippines",
        "Poland",
        "Portugal",
        "Puerto Rico",
        "Qatar",
        "Romania",
        "Russian Federation",
        "Rwanda",
        "Saint Kitts and Nevis",
        "Saint Lucia",
        "Saint Vincent and The Grenadines",
        "Samoa",
        "San Marino",
        "Saudi Arabia",
        "Senegal",
        "Serbia",
        "Seychelles",
        "Sierra Leone",
        "Singapore",
        "Sint Maarten (Dutch Part)",
        "Slovakia",
        "Slovenia",
        "Solomon Islands",
        "South Africa",
        "Spain",
        "Sri Lanka",
        "Suriname",
        "Sweden",
        "Switzerland",
        "Taiwan (Province of China)",
        "Tajikistan",
        "Tanzania, United Republic of",
        "Thailand",
        "Timor-Leste",
        "Togo",
        "Tonga",
        "Trinidad and Tobago",
        "Tunisia",
        "Turkey",
        "Turkmenistan",
        "Turks and Caicos Islands",
        "Uganda",
        "Ukraine",
        "United Arab Emirates",
        "United Kingdom of Great Britain and Northern Ireland",
        "United States of America",
        "Uruguay",
        "Uzbekistan",
        "Vanuatu",
        "Venezuela (Bolivarian Republic of)",
        "Viet Nam",
        "Virgin Islands (British)",
        "Virgin Islands (U.S.)",
        "Yemen",
        "Zambia",
        "Zimbabwe",
        null
      ]
    },
    "1692": {
      "field_id": 1692,
      "human_readable_values": [],
      "values": [
        "AED",
        "AMD",
        "AUD",
        "BGN",
        "BRL",
        "CAD",
        "CHF",
        "COP",
        "CZK",
        "DKK",
        "DOP",
        "EUR",
        "GBP",
        "GHS",
        "HKD",
        "HUF",
        "IDR",
        "ILS",
        "INR",
        "ISK",
        "JOD",
        "JPY",
        "KRW",
        "KZT",
        "LKR",
        "MXN",
        "NGN",
        "NOK",
        "NZD",
        "PEN",
        "PHP",
        "PLN",
        "QAR",
        "RON",
        "SEK",
        "SGD",
        "THB",
        "TRY",
        "TWD",
        "UAH",
        "USD",
        "UYU",
        "VND",
        "ZAR",
        null
      ]
    },
    "738": {
      "field_id": 738,
      "human_readable_values": [],
      "values": [
        "AMERICAN EXPRESS",
        "EBT",
        "GIROCARD",
        "HUMOCARD",
        "LOCAL BRAND",
        "LOCAL_CARDS_BRANDS",
        "MAESTRO",
        "MASTERCARD",
        "MASTERCARD/BANCONTACT",
        "RUPAY",
        "UNIONPAY",
        "UZCARD",
        "VISA",
        "VISA/BANCONTACT",
        "VISA/DANKORT",
        null
      ]
    },
    "564369": {
      "field_id": 564369,
      "human_readable_values": [],
      "values": [
        false,
        true
      ]
    },
    "20880": {
      "field_id": 20880,
      "human_readable_values": [],
      "values": [
        "buy",
        "buy_acquirer",
        "caas_buy",
        "caas_sell",
        "card2card",
        "deposit",
        "fiat_buy",
        "fiat_card_buy",
        "fiat_card_deposit",
        "fiat_card_sell",
        "fiat_deposit",
        "fiat_sell",
        "fiat_withdraw",
        "iban-payout",
        "iban_charge",
        "iban_refund",
        "invoice_refund",
        "issue",
        "mobile_pay",
        "receipt",
        "referral",
        "sell",
        "withdraw"
      ]
    },
    "23294": {
      "field_id": 23294,
      "human_readable_values": [],
      "values": [
        "Accepted Transaction",
        "Acquirer",
        "Auth type",
        "Brand card",
        "Country IP",
        "Country card",
        "Crypto currency",
        "Fiat currency",
        "Geoscheme IP",
        "Geoscheme card",
        "Is AFT",
        "Is Fast Track",
        "Network",
        "Partner Widget",
        "Pay System",
        "Type operation",
        null
      ]
    },
    "20868": {
      "field_id": 20868,
      "human_readable_values": [],
      "values": [
        "acquiring_card",
        "arius",
        "blik_hyperion_mobilum",
        "bni_8bworld_moneymaple",
        "bri_8bworld_moneymaple",
        "checkout_hyperion_moneysail",
        "checkout_hyperion_moneytea",
        "checkout_moneytea",
        "checkout_sbc_moneyswap",
        "connectum",
        "converter",
        "cup_unlimint_moneytea",
        "dana_8bworld_moneymaple",
        "decta_moneyswap",
        "decta_moneytea",
        "fenige_hyperion_winpay_moneytea",
        "fenige_sbc_moneytea",
        "fenige_sbc_winpay_moneytea",
        "flutterwave",
        "getkollo_moneymaple",
        "hyperion",
        "iban",
        "instapay_qrph_8bworld_moneymaple",
        "kraken",
        "mandiri_8bworld_moneymaple",
        "mpay",
        "mxn_unlimint_moneytea",
        "ngn_unlimint_moneytea",
        "nuvei_hyperion_moneyamber",
        "nuvei_hyperion_moneyamber_recurring",
        "nuvei_hyperion_moneysail",
        "nuvei_hyperion_moneysail_recurring",
        "nuvei_hyperion_winpay_moneysail",
        "nuvei_moneyamber",
        "nuvei_moneysail",
        "nuvei_sbc_moneyamber",
        "offchain",
        "ovo_8bworld_moneymaple",
        "payture",
        "permata_8bworld_moneymaple",
        "pix_unlimint_moneytea",
        "qris_8bworld_moneymaple",
        "quicko_hyperion_moneysail",
        "rails",
        "rapyd",
        "rapyd_moneyswap",
        "rbk",
        "revolut_pay_moneysail",
        "sber",
        "shopeepay_8bworld_moneymaple",
        "trustpayments_moneyswap",
        "trustpayments_moneytea",
        "trustpayments_sbc_moneytea",
        "unlimint",
        "unlimint_moneyamber",
        "unlimint_moneysail",
        "unlimint_moneyswap",
        "unlimint_moneytea",
        "unlimint_moneytea_new",
        "vnd_unlimint_moneyswap",
        "volt_moneytea",
        "walletto_moneytea",
        "walletto_payture_moneytea",
        null
      ]
    }
  },
  "initially_published_at": null,
  "can_write": true,
  "tabs": [
    {
      "id": 234,
      "dashboard_id": 393,
      "name": "General information",
      "position": 0,
      "entity_id": "DGghi_JmsuuBlzaSLgrib",
      "created_at": "2025-06-18T14:48:01.646732Z",
      "updated_at": "2025-06-18T14:48:01.646732Z"
    },
    {
      "id": 235,
      "dashboard_id": 393,
      "name": "Avg bills",
      "position": 1,
      "entity_id": "rq126a17A12hIHfwsHCBy",
      "created_at": "2025-06-18T14:48:01.646732Z",
      "updated_at": "2025-06-18T14:48:01.646732Z"
    },
    {
      "id": 236,
      "dashboard_id": 393,
      "name": "End-to-end Success Rate",
      "position": 2,
      "entity_id": "XyYnryzAIJ2gADKqwOu_G",
      "created_at": "2025-06-18T14:48:01.646732Z",
      "updated_at": "2025-06-18T14:48:01.646732Z"
    },
    {
      "id": 237,
      "dashboard_id": 393,
      "name": "Medians per user",
      "position": 3,
      "entity_id": "hEFK7gW0yhzqBcYYGNrPg",
      "created_at": "2025-06-18T14:48:01.646732Z",
      "updated_at": "2025-06-18T14:48:01.646732Z"
    }
  ],
  "enable_embedding": false,
  "collection_id": 227,
  "show_in_getting_started": false,
  "name": "OOR - Sum and Number of Transactions  - Starrocks",
  "width": "full",
  "caveats": null,
  "collection_authority_level": null,
  "creator_id": 148,
  "can_restore": false,
  "moderation_reviews": [],
  "updated_at": "2025-06-18T14:48:37.580806Z",
  "made_public_by_id": null,
  "embedding_params": null,
  "cache_ttl": null,
  "last_used_param_values": {
    "27656f4c": "past30days",
    "4fa9e9de": [
      "Partner Widget"
    ],
    "ba8ec5fd": [
      "day"
    ],
    "c272bc8c": [
      true
    ],
    "c432bf53": [
      "buy",
      "buy_acquirer",
      "mobile_pay",
      "sell",
      "fiat_card_sell",
      "fiat_buy",
      "fiat_sell",
      "card2card"
    ],
    "d1f2a4dd": [
      "5"
    ]
  },
  "id": 393,
  "last_viewed_at": "2025-06-18T14:48:25.732338Z",
  "position": null,
  "archived_directly": false,
  "entity_id": "3OaN1x5eXtwqrdVcoP0xj",
  "param_fields": {
    "1694": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "TYPE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1694,
      "target": null,
      "display_name": "TYPE",
      "name_field": null,
      "base_type": "type/Text"
    },
    "561795": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "USER_BASED_SELECTIVE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 561795,
      "target": null,
      "display_name": "USER_BASED_SELECTIVE",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "569157": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "RETRY_EXCLUDE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 569157,
      "target": null,
      "display_name": "RETRY_EXCLUDE",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "587331": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "USER_BASED_SELECTIVE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 587331,
      "target": null,
      "display_name": "USER_BASED_SELECTIVE",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "755": {
      "semantic_type": "type/Country",
      "table_id": 45,
      "name": "CARD_COUNTRY",
      "has_field_values": "search",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 755,
      "target": null,
      "display_name": "CARD_COUNTRY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "20885": {
      "semantic_type": null,
      "table_id": 45,
      "name": "PAY_SYSTEM",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20885,
      "target": null,
      "display_name": "PAY_SYSTEM",
      "name_field": null,
      "base_type": "type/Text"
    },
    "573892": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "AMOUNT_BASED_SELECTIVE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 573892,
      "target": null,
      "display_name": "AMOUNT_BASED_SELECTIVE",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "1703": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "CURRENCY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1703,
      "target": null,
      "display_name": "CURRENCY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "875": {
      "semantic_type": "type/Country",
      "table_id": 51,
      "name": "COUNTRY_NAME_RU",
      "has_field_values": "search",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 875,
      "target": null,
      "display_name": "COUNTRY_NAME_RU",
      "name_field": null,
      "base_type": "type/Text"
    },
    "34623": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "NETWORK",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 34623,
      "target": null,
      "display_name": "NETWORK",
      "name_field": null,
      "base_type": "type/Text"
    },
    "20836": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "CURRENCY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20836,
      "target": null,
      "display_name": "CURRENCY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "1699": {
      "semantic_type": null,
      "table_id": 98,
      "name": "PARTNER_NAME",
      "has_field_values": "search",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1699,
      "target": null,
      "display_name": "PARTNER_NAME",
      "name_field": null,
      "base_type": "type/Text"
    },
    "1686": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "PAYMENT_TYPE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1686,
      "target": null,
      "display_name": "PAYMENT_TYPE",
      "name_field": null,
      "base_type": "type/Text"
    },
    "20847": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "CONFIRMED",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20847,
      "target": null,
      "display_name": "CONFIRMED",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "20892": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "FIAT_CURRENCY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20892,
      "target": null,
      "display_name": "FIAT_CURRENCY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "1700": {
      "semantic_type": "type/CreationTimestamp",
      "table_id": 98,
      "name": "CREATED_AT",
      "has_field_values": "none",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1700,
      "target": null,
      "display_name": "CREATED_AT",
      "name_field": null,
      "base_type": "type/DateTime"
    },
    "20834": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "WIDGET_PARTNER_NAME",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20834,
      "target": null,
      "display_name": "WIDGET_PARTNER_NAME",
      "name_field": null,
      "base_type": "type/Text"
    },
    "587330": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "IS_FAST_TRACK_KYC",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 587330,
      "target": null,
      "display_name": "IS_FAST_TRACK_KYC",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "550206": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "FLAG_IS_RECURRING",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 550206,
      "target": null,
      "display_name": "FLAG_IS_RECURRING",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "876": {
      "semantic_type": "type/Category",
      "table_id": 51,
      "name": "GEOSCHEME_BUSINESS",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 876,
      "target": null,
      "display_name": "GEOSCHEME_BUSINESS",
      "name_field": null,
      "base_type": "type/Text"
    },
    "757": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "CARD_GEOSCHEME",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 757,
      "target": null,
      "display_name": "CARD_GEOSCHEME",
      "name_field": null,
      "base_type": "type/Text"
    },
    "566012": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "AUTH_TYPE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 566012,
      "target": null,
      "display_name": "AUTH_TYPE",
      "name_field": null,
      "base_type": "type/Text"
    },
    "587329": {
      "semantic_type": "type/Category",
      "table_id": 98,
      "name": "AMOUNT_BASED_SELECTIVE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 587329,
      "target": null,
      "display_name": "AMOUNT_BASED_SELECTIVE",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "536409": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "ANTIFRAUD_STATUS",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 536409,
      "target": null,
      "display_name": "ANTIFRAUD_STATUS",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "603702": {
      "semantic_type": null,
      "table_id": 45,
      "name": "IS_AFT",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 603702,
      "target": null,
      "display_name": "IS_AFT",
      "name_field": null,
      "base_type": "type/Text"
    },
    "795": {
      "semantic_type": "type/Country",
      "table_id": 45,
      "name": "CARD_ISOCOUNTRY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 795,
      "target": null,
      "display_name": "CARD_ISOCOUNTRY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "1692": {
      "semantic_type": null,
      "table_id": 98,
      "name": "FIAT_CURRENCY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 1692,
      "target": null,
      "display_name": "FIAT_CURRENCY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "738": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "CARD_BRAND",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 738,
      "target": null,
      "display_name": "CARD_BRAND",
      "name_field": null,
      "base_type": "type/Text"
    },
    "874": {
      "semantic_type": "type/Country",
      "table_id": 51,
      "name": "COUNTRY_NAME_EN",
      "has_field_values": "search",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 874,
      "target": null,
      "display_name": "COUNTRY_NAME_EN",
      "name_field": null,
      "base_type": "type/Text"
    },
    "550050": {
      "semantic_type": null,
      "table_id": 45,
      "name": "RECURRING_ID",
      "has_field_values": "search",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 550050,
      "target": null,
      "display_name": "RECURRING_ID",
      "name_field": null,
      "base_type": "type/Text"
    },
    "564369": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "IS_FAST_TRACK_KYC",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 564369,
      "target": null,
      "display_name": "IS_FAST_TRACK_KYC",
      "name_field": null,
      "base_type": "type/Boolean"
    },
    "20880": {
      "semantic_type": "type/Category",
      "table_id": 45,
      "name": "TYPE",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20880,
      "target": null,
      "display_name": "TYPE",
      "name_field": null,
      "base_type": "type/Text"
    },
    "23294": {
      "semantic_type": "type/Category",
      "table_id": 2841,
      "name": "TRANSACTION_COLUMNS_GROUPBY",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 23294,
      "target": null,
      "display_name": "TRANSACTION_COLUMNS_GROUPBY",
      "name_field": null,
      "base_type": "type/Text"
    },
    "20868": {
      "semantic_type": "type/Company",
      "table_id": 45,
      "name": "VENDOR_NAME",
      "has_field_values": "list",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20868,
      "target": null,
      "display_name": "VENDOR_NAME",
      "name_field": null,
      "base_type": "type/Text"
    },
    "20835": {
      "semantic_type": "type/CreationTimestamp",
      "table_id": 45,
      "name": "CREATED_AT",
      "has_field_values": "none",
      "fk_target_field_id": null,
      "dimensions": [],
      "id": 20835,
      "target": null,
      "display_name": "CREATED_AT",
      "name_field": null,
      "base_type": "type/DateTime"
    }
  },
  "last-edit-info": {
    "id": 148,
    "email": "t.tikhomirov@mercuryo.io",
    "first_name": "Timofei",
    "last_name": "Tikhomirov",
    "timestamp": "2025-06-18T14:48:03.379165Z"
  },
  "collection": {
    "authority_level": null,
    "description": null,
    "archived": false,
    "slug": "oor___sum_and_number_of_transactions_",
    "archive_operation_id": null,
    "name": "OOR - Sum and Number of Transactions ",
    "personal_owner_id": null,
    "type": null,
    "is_sample": false,
    "id": 227,
    "archived_directly": null,
    "entity_id": "hrClJWcx9meKSm2cp7Ema",
    "location": "/34/",
    "namespace": null,
    "is_personal": false,
    "created_at": "2023-09-18T10:07:50.122799Z"
  },
  "parameters": [
    {
      "name": "Transaction Date",
      "slug": "transaction_date",
      "id": "27656f4c",
      "type": "date/all-options",
      "sectionId": "date",
      "default": "past30days"
    },
    {
      "name": "Top N",
      "slug": "top_n",
      "id": "d1f2a4dd",
      "type": "number/=",
      "sectionId": "number",
      "default": "5"
    },
    {
      "slug": "group_by_parameter_(single_value)",
      "default": [
        "Partner Widget"
      ],
      "name": "Group by parameter (single value)",
      "isMultiSelect": false,
      "type": "string/=",
      "sectionId": "string",
      "values_source_type": "static-list",
      "id": "4fa9e9de",
      "values_source_config": {
        "values": [
          [
            "Type operation"
          ],
          [
            "Accepted Transaction"
          ],
          [
            "Acquirer"
          ],
          [
            "Network"
          ],
          [
            "Crypto currency"
          ],
          [
            "Fiat currency"
          ],
          [
            "Partner Widget"
          ],
          [
            "Geoscheme card"
          ],
          [
            "Country card"
          ],
          [
            "Geoscheme IP"
          ],
          [
            "Country IP"
          ],
          [
            "Pay System"
          ],
          [
            "Brand card"
          ],
          [
            "Auth type"
          ],
          [
            "Is AFT"
          ],
          [
            "Is Fast Track"
          ]
        ]
      }
    },
    {
      "name": "Type of operation",
      "slug": "type_of_operation",
      "id": "c432bf53",
      "type": "string/=",
      "sectionId": "string",
      "default": [
        "buy",
        "buy_acquirer",
        "mobile_pay",
        "sell",
        "fiat_card_sell",
        "fiat_buy",
        "fiat_sell",
        "card2card"
      ]
    },
    {
      "name": "Partner Widget",
      "slug": "partner_widget",
      "id": "157b2900",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "slug": "granularity",
      "values_query_type": "list",
      "default": "day",
      "name": "Granularity",
      "type": "string/=",
      "sectionId": "string",
      "values_source_type": "static-list",
      "id": "ba8ec5fd",
      "values_source_config": {
        "values": [
          [
            "hour"
          ],
          [
            "day"
          ],
          [
            "week"
          ],
          [
            "month"
          ],
          [
            "quarter"
          ],
          [
            "year"
          ]
        ]
      },
      "required": true
    },
    {
      "name": "Crypto currency",
      "slug": "crypto_currency",
      "id": "4bca20b1",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Fiat currency",
      "slug": "fiat_currency",
      "id": "1cfdfdc4",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Card Geoscheme",
      "slug": "card_geoscheme",
      "id": "215f6aa",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Brand Card",
      "slug": "brand_card",
      "id": "568c8890",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Geoscheme IP",
      "slug": "geoscheme_ip",
      "id": "7e1dbda1",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Country IP",
      "slug": "country_ip",
      "id": "2a85a813",
      "type": "string/=",
      "sectionId": "location"
    },
    {
      "name": "Acquirer",
      "slug": "acquirer",
      "id": "20e53fa3",
      "type": "string/=",
      "sectionId": "string",
      "values_query_type": "list"
    },
    {
      "name": "Country card",
      "slug": "country_card",
      "id": "f16006b5",
      "type": "string/=",
      "sectionId": "location"
    },
    {
      "name": "Pay system",
      "slug": "pay_system",
      "id": "65c17dea",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Network",
      "slug": "network",
      "id": "185abb8b",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Complete transaction (only for cnt transactions)",
      "slug": "complete_transaction_(only_for_cnt_transactions)",
      "id": "c272bc8c",
      "type": "string/=",
      "sectionId": "string",
      "default": [
        true
      ]
    },
    {
      "name": "Is recurring",
      "slug": "is_recurring",
      "id": "717e26d6",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Is user based selective",
      "slug": "is_user_based_selective",
      "id": "b48e0810",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Is Fast track KYC",
      "slug": "is_fast_track_kyc",
      "id": "d0106a4d",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Auth Type",
      "slug": "auth_type",
      "id": "cf0992f0",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Retry exclude",
      "slug": "retry_exclude",
      "id": "10f875ce",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Is amount based selective",
      "slug": "is_amount_based_selective",
      "id": "8c7d23a8",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Type calculation",
      "slug": "type_calculation",
      "id": "a73cf623",
      "type": "string/=",
      "sectionId": "string"
    },
    {
      "name": "Is AFT",
      "slug": "is_aft",
      "id": "4af33822",
      "type": "string/=",
      "sectionId": "string"
    }
  ],
  "auto_apply_filters": true,
  "created_at": "2025-06-18T14:48:01.646732Z",
  "public_uuid": null,
  "points_of_interest": null,
  "can_delete": false
}